!function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e){var t,n,i,r,s,o,a,l,c,u,p,h,d,f;i=e("backbone"),t=i.$=e("jquery"),l=e("./config.coffee"),f=e("./models/user"),n=e("./app.coffee"),s=e("./routers/main.coffee"),o=e("./collections/persons.coffee"),r=e("./collections/documents.coffee"),p=e("./helpers/load-edit-data"),u=e("./helpers/load-app-data").loadAll,h=e("./helpers/search").searchQuery,c=function(e){var n;return n=t(this).attr("href"),null!=n?(e.preventDefault(),n.match(/^https?:/)&&(n=n.replace(l.get("baseUrl"),"")),i.history.navigate(n,{trigger:!0})):void 0},a=function(){var e,t,n;return e=new RegExp(/(?:\?|&)hsid=([^&]+)(?:&.+)?$/),t=e.exec(window.location.href),t?(l.set({authToken:t[1]}),"function"==typeof(n=window.history).replaceState?n.replaceState({},"",window.location.href.replace(/\?.*$/,"")):void 0):void 0},d=function(){var e,t,i;return e=new n({el:"body"}),t=l.get("baseUrl").replace(/^https?:\/\/[^\/]+/,""),i=new s({controller:e,root:t}),i.on("route",function(){return function(t){return e.updateNavBar(t)}}(this)),l.set("router",i),i.start()},t(function(){return t(document).on("click","a:not([target])",c),a(),u().done(function(){return f.checkLoggedIn().always(function(){return f.isLoggedIn()&&f.isVerified()?p().done(function(){return d()}):d()})})})},{"./app.coffee":6,"./collections/documents.coffee":7,"./collections/persons.coffee":8,"./config.coffee":9,"./helpers/load-app-data":11,"./helpers/load-edit-data":12,"./helpers/search":14,"./models/user":17,"./routers/main.coffee":18,backbone:void 0,jquery:void 0}],2:[function(e,t){t.exports={isWorkCommentedOnIn:"is commented upon in",isPersonCommentedOnIn:"is commented upon in",containedInAnthology:"has been anthologized in",isAnthologyContaining:"",hasPreface:"is prefaced by",isPrefaceOf:"is a preface to",hasAnnotationsOn:"made handwritten comments in copy of",isAnnotatedIn:"was annotated (by hand) by",hasTranslation:"was translated in",isTranslationOf:"is a translation of",hasAdaptation:"was adapted into",isAdaptationOf:"is adaptation of",hasPlagiarismBy:"was plagiarized by",isPlagiarismOf:"plagiarized",hasSequel:"was continued by",isSequelOf:"is a sequel of",isParodiedBy:"is parodied by",isParodyOf:"parodied",hasBiography:'has been "biographed" in/by',isBiographyOf:"is a biography of",hasObituary:"features in obituary",isObituaryOf:"is an obituary of",hasEdition:"was reissued by/in",isEditionOf:"is/provided an edition of",isCopiedBy:"is (partly) copied by",isCopyOf:"copied (by hand, parts of)",isCensoredBy:"was censored by",isCensoringOf:"censors",isWorkAwarded:"received an award from",isAwardForWork:"awarded",isPersonAwarded:"received an award from",isAwardForPerson:"awarded",isDedicatedPersonOf:"received dedication by/in",isDedicatedTo:"is dedicated to",isPersonQuotedIn:"is quoted by/in",quotesPerson:"quotes",isWorkQuotedIn:"is quoted by/in",quotesWork:"quotes",isIntertextualOf:"has intertextual relations with",isIntertextualTo:"has intertextual relations with",isWorkMentionedIn:"is mentioned in/by",mentionsWork:"mentions",isPersonMentionedIn:"is mentioned in/by",mentionsPerson:"mentions",isWorkListedOn:"is listed on",listsWork:"lists",isPersonListedOn:"is listed on",listsPerson:"lists",isPersonReferencedIn:"referenced to in",referencesPerson:"references",isWorkReferencedIn:"referenced to in",referencesWork:"references",hasBibliography:"is in bibliography",isBibliographyOf:"is bibliography containing"}},{}],3:[function(e,t){t.exports={baseUrl:"http://localhost:9000",searchPath:"/api/v1/search",relationSearchPath:"/api/search/relations",facetedSearchBaseUrl:"http://localhost:9000/api",personsRootUrl:"/domain/wwpersons",documentsRootUrl:"/domain/wwdocuments",VRE_ID:"WomenWriters",relationTypeVariation:"wwrelation",educationPath:"/domain/wwkeywords?type=education",financialSituationPath:"/domain/wwkeywords?type=financialSituation",maritalStatusPath:"/domain/wwkeywords?type=maritalStatus",professionPath:"/domain/wwkeywords?type=profession",religionPath:"/domain/wwkeywords?type=religion",socialClassPath:"/domain/wwkeywords?type=socialClass",sourceCategoryPath:"/domain/keywords?type=docSourceType",genrePath:"/domain/wwkeywords?type=genre",personTypeString:"wwperson",documentTypeString:"wwdocument",userInfoPath:"/api/system/users/me",userLoginUrl:"https://secure.huygens.knaw.nl/saml2/login",resultRows:25,personFacetTitles:{dynamic_s_gender:"Gender",dynamic_s_birthDate:"Year of Birth",dynamic_s_residence:"Country",dynamic_s_language:"Language",dynamic_s_birthplace:"Place of Birth",dynamic_s_deathDate:"Year of Death",dynamic_s_deathplace:"Place of Death",dynamic_s_collective:"Memberships",dynamic_s_religion:"Religion",dynamic_s_types:"Type"},documentFacetTitles:{dynamic_s_date:"Year of first publication",dynamic_s_origin:"Origin",dynamic_s_document_type:"Document Type",dynamic_s_creator:"Creator",dynamic_s_language:"Language",dynamic_s_subject:"Subject",dynamic_s_genre:"Genre"}}},{}],4:[function(){},{}],5:[function(e,t,n){(function(i){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof i?r=i:"undefined"!=typeof self&&(r=self),r.jade=e()}}(function(){return function t(n,i,r){function s(a,l){if(!i[a]){if(!n[a]){var c="function"==typeof e&&e;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return s(t?t:e)},u,u.exports,t,n,i,r)}return i[a].exports}for(var o="function"==typeof e&&e,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,n){"use strict";function i(e){return null!=e&&""!==e}function r(e){return Array.isArray(e)?e.map(r).filter(i).join(" "):e}n.merge=function s(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=s(n,e[r]);return n}var o=e["class"],a=t["class"];(o||a)&&(o=o||[],a=a||[],Array.isArray(o)||(o=[o]),Array.isArray(a)||(a=[a]),e["class"]=o.concat(a).filter(i));for(var l in t)"class"!=l&&(e[l]=t[l]);return e},n.joinClasses=r,n.cls=function(e,t){for(var i=[],s=0;s<e.length;s++)i.push(t&&t[s]?n.escape(r([e[s]])):r(e[s]));var o=r(i);return o.length?' class="'+o+'"':""},n.attr=function(e,t,i,r){return"boolean"==typeof t||null==t?t?" "+(r?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof t?" "+e+"='"+JSON.stringify(t).replace(/'/g,"&apos;")+"'":i?" "+e+'="'+n.escape(t)+'"':" "+e+'="'+t+'"'},n.attrs=function(e,t){var i=[],s=Object.keys(e);if(s.length)for(var o=0;o<s.length;++o){var a=s[o],l=e[a];"class"==a?(l=r(l))&&i.push(" "+a+'="'+l+'"'):i.push(n.attr(a,l,!1,t))}return i.join("")},n.escape=function(e){var t=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return t===""+e?e:t},n.rethrow=function o(t,n,i,r){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&n||r))throw t.message+=" on line "+i,t;try{r=r||e("fs").readFileSync(n,"utf8")}catch(s){o(t,null,i)}var a=3,l=r.split("\n"),c=Math.max(i-a,0),u=Math.min(l.length,i+a),a=l.slice(c,u).map(function(e,t){var n=t+c+1;return(n==i?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+i+"\n"+a+"\n\n"+t.message,t}},{fs:2}],2:[function(){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t){var n,i,r,s,o,a,l,c,u,p,h,d,f,m,g,v,y,b,w,_,S={}.hasOwnProperty,x=function(e,t){function n(){this.constructor=e}for(var i in t)S.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},T=[].slice;r=e("backbone"),n=e("jquery"),_=e("underscore"),y=e("../templates/views/base.jade"),b=e("./config.coffee"),w=e("./models/user.coffee"),v=e("./views/user-status.coffee"),u=e("./models/person.coffee"),p=e("./views/person/edit.coffee"),f=e("./views/person/view.coffee"),h=e("./views/person/overview.coffee"),d=e("./views/person/search.coffee"),s=e("./models/document.coffee"),o=e("./views/document/edit.coffee"),c=e("./views/document/view.coffee"),a=e("./views/document/overview.coffee"),l=e("./views/document/search.coffee"),m=e("./views/reception/search.coffee"),g=e("./views/sources/view"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return x(t,e),t.prototype.template=y,t.prototype.initialize=function(){return _.extend(this,r.Events),this.render()},t.prototype.updateNavBar=function(e){var t,n;return n=e.match(/show([A-Z][a-z]+)/),n?(t=n[1].toLowerCase(),this.$(".navigation a").removeClass("active"),this.$(".navigation a."+t).addClass("active")):void 0},t.prototype.home=function(){},t.prototype.showPersonForm=function(e){var t;return t=new u({_id:e}),t.fetch().done(function(e){return function(){var n;return n=new p({model:t}),e.switchView(n)}}(this)),this.showView()},t.prototype.showDocumentForm=function(e){var t;return t=new s({_id:e}),t.fetch().done(function(e){return function(){var n;return n=new o({model:t}),e.switchView(n)}}(this)),this.showView()},t.prototype.showPersonSearch=function(){var e,t;return null==this.personSearch&&(this.personSearch=new d({el:"#search .persons"})),this.showSearch(),null!=(e=this.documentSearch)&&e.$el.fadeOut(75),null!=(t=this.receptionSearch)&&t.$el.fadeOut(75),this.personSearch.$el.fadeIn(75)},t.prototype.showDocumentSearch=function(){var e,t;return null==this.documentSearch&&(this.documentSearch=new l({el:"#search .documents"})),this.showSearch(),null!=(e=this.personSearch)&&e.$el.fadeOut(75),null!=(t=this.receptionSearch)&&t.$el.fadeOut(75),this.documentSearch.$el.fadeIn(75)},t.prototype.showReceptionSearch=function(){var e,t;return null==this.receptionSearch&&(this.receptionSearch=new m({el:"#search .receptions"})),this.showSearch(),null!=(e=this.personSearch)&&e.$el.fadeOut(75),null!=(t=this.documentSearch)&&t.$el.fadeOut(75),this.receptionSearch.$el.fadeIn(75)},t.prototype.showPersonView=function(e){var t;return t=new u({_id:e}),t.fetch().done(function(e){return function(){var n,i,s,o,a;return"hasPseudonym"in t.get("@relations")?(t.set({pseudonyms:{}}),s=function(){var e,r,s,o;for(s=t.get("@relations").hasPseudonym,o=[],e=0,r=s.length;r>e;e++)n=s[e],i=new u({_id:n.id}),o.push(i.fetch());return o}(),(a=r.$).when.apply(a,s).done(function(){var n,r,s,o,a,l,c;for(r=1<=arguments.length?T.call(arguments,0):[],o=0,a=r.length;a>o;o++)n=r[o],i=n[0],(null!=i&&null!=(l=i["@relations"])&&null!=(c=l.isCreatorOf)?c.length:void 0)&&(t.get("pseudonyms")[i._id]=i);return s=new f({model:t}),e.switchView(s),e.showView()})):(o=new f({model:t}),e.switchView(o),e.showView())}}(this))},t.prototype.showDocumentView=function(e,t){var n,i;return i={_id:e},null!=t&&(i["^rev"]=t),n=new s(i),n.fetch().done(function(e){return function(){var t;return t=new c({model:n}),e.switchView(t),e.showView()}}(this))},t.prototype.showSourceView=function(){return this.showDocumentView.apply(this,arguments)},t.prototype.showSourceList=function(){var e;return e=new g,this.switchView(e),this.showView()},t.prototype.showSearch=function(){return this.$("#search").show(),this.$("#view").hide()},t.prototype.showView=function(){return this.$("#search").hide(),this.$("#view").show(),this.$el.scrollTop(0)},t.prototype.switchView=function(e){var t;return null!=(t=this.currentView)&&t.remove(),this.$("#view").html(e.el),this.currentView=e},t.prototype.render=function(){var e,t;return t=n("<div/>").attr({"class":"body-wrap"}).append(this.$el.html()),e=n(this.template({config:b})),new v({el:e.find(".user-status"),model:w}),this.$el.html(t).append(e.hide()).find(".body-wrap").fadeOut(150,function(t){return function(){return t.$(".body-wrap").remove(),e.fadeIn(100)}}(this))},t}(r.View),t.exports=i},{"../templates/views/base.jade":46,"./config.coffee":9,"./models/document.coffee":15,"./models/person.coffee":16,"./models/user.coffee":17,"./views/document/edit.coffee":21,"./views/document/overview.coffee":22,"./views/document/search.coffee":23,"./views/document/view.coffee":24,"./views/person/edit.coffee":25,"./views/person/overview.coffee":26,"./views/person/search.coffee":27,"./views/person/view.coffee":28,"./views/reception/search.coffee":32,"./views/sources/view":34,"./views/user-status.coffee":36,backbone:void 0,jquery:void 0,underscore:void 0}],7:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=e("../models/document.coffee"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.model=i,t}(n.Collection),t.exports=r},{"../models/document.coffee":15,backbone:void 0}],8:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=e("../models/person.coffee"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.model=i,t}(n.Collection),t.exports=r},{"../models/person.coffee":16,backbone:void 0}],9:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config/reception-names.json"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.defaults=e("../../config/targets/development.json"),n.prototype.initialize=function(){var e;try{e=null!=window.localStorage}catch(t){e=!1}return e&&null==this.get("authToken")?(this.set({authToken:window.localStorage.getItem("authToken")}),this.on("change:authToken",function(e){return function(){return window.localStorage.setItem("authToken",e.get("authToken"))}}(this))):void 0},n.prototype.searchUrl=function(e){return this.get("baseUrl")+this.searchPath(e)},n.prototype.searchPath=function(e){return e?this.get("searchPath")+"/"+e:this.get("searchPath")},n.prototype.relationsUrl=function(){return this.get("baseUrl")+"/api/domain/wwrelations"},n.prototype.allPersonsUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("personsRootUrl")},n.prototype.personUrl=function(e){return this.allPersonsUrl()+"/"+e},n.prototype.personViewPath=function(e){return"/persons/"+e},n.prototype.personViewUrl=function(e){return this.get("baseUrl")+this.personViewPath(e)},n.prototype.personEditUrl=function(e){return this.personViewUrl(e)+"/edit"},n.prototype.allDocumentsUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("documentsRootUrl")},n.prototype.documentUrl=function(e){return this.allDocumentsUrl()+"/"+e},n.prototype.documentViewPath=function(e){return"/documents/"+e},n.prototype.documentViewUrl=function(e){return this.get("baseUrl")+this.documentViewPath(e)},n.prototype.documentEditUrl=function(e){return this.documentViewUrl(e)+"/edit"},n.prototype.sourceViewUrl=function(e){return this.get("baseUrl")+"/sources/"+e},n.prototype.viewUrl=function(e){return e.match(/^DOC/)?this.documentViewUrl(e):e.match(/^PERS/)?this.personViewUrl(e):void 0},n.prototype.editUrl=function(e){return e.match(/^DOC/)?this.documentEditUrl(e):e.match(/^PERS/)?this.personEditUrl(e):void 0},n.prototype.educationUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("educationPath")},n.prototype.financialSituationUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("financialSituationPath")},n.prototype.maritalStatusUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("maritalStatusPath")},n.prototype.professionUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("professionPath")},n.prototype.religionUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("religionPath")},n.prototype.socialClassUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("socialClassPath")},n.prototype.sourceCategoryUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("sourceCategoryPath")},n.prototype.genreUrl=function(){return this.get("facetedSearchBaseUrl")+this.get("genrePath")},n.prototype.userInfoUrl=function(){return this.get("baseUrl")+this.get("userInfoPath")},n.prototype.receptionsUrl=function(){return this.get("baseUrl")+"/api/system/vres/"+this.get("VRE_ID")},n.prototype.receptionsFor=function(e){var t,n,i,r,s;for(n=this.get("receptions"),s=[],i=0,r=n.length;r>i;i++)t=n[i],t.baseSourceType===e&&s.push(t);return s},n.prototype.personReceptions=function(){return this.receptionsFor("person")},n.prototype.documentReceptions=function(){return this.receptionsFor("document")},n.prototype.receptionTypeLabel=function(e){return r[e]},n.prototype.mapGenderOption=function(e){var t;return t={MALE:"Male",FEMALE:"Female",NOT_APPLICABLE:"Neutral",UNKNOWN:"Unknown"},t[e]},n.prototype.router=function(){return this.get("router")},n}(n.Model),t.exports=new i},{"../../config/reception-names.json":2,"../../config/targets/development.json":3,backbone:void 0}],10:[function(e,t){var n,i,r,s,o;n=e("../config"),r=e("../../templates/views/base-link.jade"),s=e("../../templates/views/person/name-component.jade"),o=e("../../templates/views/person/name.jade"),i={relationField:function(e,t,i){return null==i&&(i={}),{title:t,field:e,"in":"@relations",type:"Array",group:!0,map:function(e){var t,i;return t=function(){var t,s,o,a;for(o=e||[],a=[],t=0,s=o.length;s>t;t++)i=o[t],a.push(n.viewUrl(i.id)?r({link:{url:n.viewUrl(i.id),label:i.displayName}}):i.displayName);return a}()}}},namesMap:function(e){var t,n,i,r,a,l;for(r=[],a=0,l=e.length;l>a;a++)i=e[a],n=function(){var e,n,r,o;for(r=i.components,o=[],e=0,n=r.length;n>e;e++)t=r[e],null!=t.type&&o.push(s(t));return o}(),n.length&&r.push(o({components:n}));return r},linksMap:function(e){var t,n,i,s;for(s=[],n=0,i=e.length;i>n;n++)t=e[n],null!=t.url&&s.push(r({link:t}));return s},externalLinksMap:function(e){var t;return e=function(){var n,i,s;for(s=[],n=0,i=e.length;i>n;n++)t=e[n],null!=t.url&&(t.external=!0,s.push(r({link:t})));return s}()}},t.exports=i},{"../../templates/views/base-link.jade":45,"../../templates/views/person/name-component.jade":52,"../../templates/views/person/name.jade":53,"../config":9}],11:[function(e,t){var n,i,r,s,o,a,l,c,u;i=e("backbone"),n=i.$=e("jquery"),r=e("../config"),u=e("../models/user"),c=e("./search").searchQuery,o=function(){var e;return e=new n.Deferred,n.getJSON(r.receptionsUrl()).then(function(t){return r.set({receptions:t.receptions}),e.resolve()}),e},l=function(){var e;return e=new n.Deferred,c({query:{term:"*",facetValues:[{name:"dynamic_b_is_source",values:["true"]}]},options:{searchUrl:r.searchUrl("wwdocuments"),resultRows:5e3}}).then(function(t){var n,i;return n=_.groupBy(t.results,function(e){return e._id}),r.set({sources:function(){var e,r,s,o;for(s=t.refs,o=[],e=0,r=s.length;r>e;e++)i=s[e],o.push({id:i.id,title:i.displayName,notes:n[i.id][0].notes});return o}()}),e.resolve()}),e},s=function(e,t){var i;return i=new n.Deferred,n.getJSON(e).then(function(e){var n;return r.set(t,function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push({value:n._id,label:n.value});return r}()),i.resolve()}),i},a=function(){return s(r.sourceCategoryUrl(),"sourceCategories")},t.exports={loadSources:function(){return l()},loadAll:function(){return n.when(o(),a())}}},{"../config":9,"../models/user":17,"./search":14,backbone:void 0,jquery:void 0}],12:[function(e,t){var n,i,r,s,o;i=e("backbone"),n=i.$=e("jquery"),r=e("../config"),o=e("../models/user"),s=e("./search").searchQuery,t.exports=function(){var e,t,i,o,a,l,c,u,p,h,d,f,m;return d=new n.Deferred,n.getJSON(r.get("baseUrl")+"/api/system/relationtypes?iname=wwperson").then(function(e){var t,n,i,s;for(t={},i=0,s=e.length;s>i;i++)n=e[i],"person"===n.sourceTypeName&&(t[n.regularName]=n),"person"===n.targetTypeName&&(t[n.inverseName]=n);return r.set({personRelationTypes:t}),d.resolve()}),h=new n.Deferred,n.getJSON(r.get("baseUrl")+"/api/system/relationtypes?iname=wwdocument").then(function(e){var t,n,i,s;for(t={},i=0,s=e.length;s>i;i++)n=e[i],t[n.regularName]=n;return r.set({documentRelationTypes:t}),h.resolve()}),a=new n.Deferred,s({query:{term:"*"},options:{searchUrl:r.searchUrl("wwlanguages"),resultRows:1e3}}).then(function(e){var t,n;return n=function(){var n,i,r,s;for(r=e.refs,s=[],n=0,i=r.length;i>n;n++)t=r[n],s.push({value:t.id,label:t.displayName});return s}(),r.set({languages:n}),a.resolve()}),l=new n.Deferred,s({query:{term:"*"},options:{searchUrl:r.searchUrl("wwlocations"),resultRows:1e3}}).then(function(e){var t;return r.set({locations:function(){var n,i,r,s;for(r=e.refs,s=[],n=0,i=r.length;i>n;n++)t=r[n],s.push({value:t.id,label:t.displayName});return s}()}),l.resolve()}),u=new n.Deferred,s({query:{term:"*"},options:{searchUrl:r.searchUrl("wwpersons"),resultRows:100}}).then(function(e){var t;return r.set({persons:function(){var n,i,r,s;for(r=e.refs,s=[],n=0,i=r.length;i>n;n++)t=r[n],s.push({value:t.id,label:t.displayName});return s}()}),u.resolve()}),e=function(e,t){var i;return i=new n.Deferred,n.getJSON(e).then(function(e){var n;return r.set(t,function(){var t,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push({value:n._id,label:n.value});return r}()),i.resolve()}),i},t=e(r.educationUrl(),"educations"),i=e(r.financialSituationUrl(),"financialSituations"),c=e(r.maritalStatusUrl(),"maritalStatuses"),p=e(r.professionUrl(),"professions"),f=e(r.religionUrl(),"religions"),m=e(r.socialClassUrl(),"socialClasses"),o=e(r.genreUrl(),"genres"),n.when(d,h,a,l,u,t,i,c,p,f,m,o)}},{"../config":9,"../models/user":17,"./search":14,backbone:void 0,jquery:void 0}],13:[function(e,t){var n,i,r;n=e("backbone"),r=e("../config"),i=function(){function e(e){var t;null==e&&(e={}),this.searchUrl=null!=(t=e.url)?t:r.get("baseUrl")+r.get("relationSearchPath"),this.lastSearch=null}return e.prototype.search=function(e,t){var i,s;return null==e&&(e={}),null==t&&(t=100),s={url:this.searchUrl,headers:{VRE_ID:r.get("VRE_ID")},type:"POST",data:JSON.stringify(e),contentType:"application/json"},i=function(e){return function(i,r,s){return e.lastSearchUrl=s.getResponseHeader("Location"),n.$.getJSON(e.lastSearchUrl+"?rows="+t)}}(this),n.$.ajax(s).then(i)},e.prototype.setResultRows=function(e){return n.$.getJSON(this.lastSearchUrl+"?rows="+e)},e}(),t.exports=i},{"../config":9,backbone:void 0}],14:[function(e,t){var n,i,r,s,o,a,l,c,u;n=e("backbone"),i=e("huygens-faceted-search/src/coffee/main"),l=e("../../templates/faceted-search/main.jade"),r=e("../config"),a=function(e){var t,n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push("<div class='"+t+"-placeholder'></div>");return r},s=function(e){var t,n,s,o,a,c,u;return null==e&&(e={}),o=e.queryOptions,n=e.facetTitleMap,u=e.textSearchTitle,a=e.resultRows,t=e.collapsed,c=e.templates,null==t&&(t=!0),s={baseUrl:r.get("baseUrl"),searchPath:r.searchPath(e.type),requestOptions:{headers:{VRE_ID:r.get("VRE_ID")}},queryOptions:o,resultRows:null!=a?a:r.get("resultRows"),facetTitleMap:n,startCollapsed:t,textSearchTitle:u,autoSearch:!0,templates:{main:l}},null!=c&&_.extend(s.templates,c),new i(s)},c=function(e){var t,i,s,o;return s=e.query,i=e.options,t=n.$.Deferred(),o=n.$.ajax({type:"POST",url:i.searchUrl,data:JSON.stringify(s),dataType:"text",contentType:"application/json; charset=utf-8",headers:{VRE_ID:r.get("VRE_ID")}}),o.done(function(){return function(e,r,s){var o;return 201===s.status?(o=s.getResponseHeader("location"),i.resultRows&&(o+="?rows="+i.resultRows),n.$.getJSON(o).done(function(e){return t.resolve(e)})):void 0}}(this)),o.fail(function(){return function(e,n,i){return"undefined"!=typeof console&&null!==console&&console.error("Failed search",n,i),t.reject()}}(this)),t.promise()},u=function(e,t,n,i){var s;return null==n&&(n=500),null==i&&(i={}),s=o(e),_.defaults(i,{term:"*"+s+"*",typeString:t}),c({query:i,options:{searchUrl:r.searchPath(t+"s"),resultRows:n}})},o=function(e){var t,n,i,r,s;for(i='+ - & | ! ( ) { } [ ] ^ " ~ * ? :  '.split(/\s+/),n=e,r=0,s=i.length;s>r;r++)t=i[r],n=e.replace(/#{char}/g,"\\"+t);return n},t.exports={createFacetedSearch:s,searchQuery:c,simpleSearch:u,escapeTerm:o}},{"../../templates/faceted-search/main.jade":40,"../config":9,backbone:void 0,"huygens-faceted-search/src/coffee/main":75}],15:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../config.coffee"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.idAttribute="_id",t.prototype.urlRoot=r.allDocumentsUrl(),t}(n.Model),t.exports=i},{"../config.coffee":9,backbone:void 0}],16:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../config.coffee"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.idAttribute="_id",t.prototype.urlRoot=r.allPersonsUrl(),t}(n.Model),t.exports=i},{"../config.coffee":9,backbone:void 0}],17:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../config"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.defaults={loggedIn:!1},t.prototype.url=r.userInfoUrl(),t.prototype.loginUrl=r.get("userLoginUrl"),t.prototype.VRE_ID=r.get("VRE_ID"),t.prototype.login=function(e){return this.fetch({login:!0,returnUrl:e}).done(function(e){return function(){return e.set({loggedIn:!0})}}(this))},t.prototype.logout=function(){return this.clear(),this.set({loggedIn:!1})},t.prototype.isLoggedIn=function(){return this.get("loggedIn")},t.prototype.isVerified=function(){var e,t;return e=null!=(t=this.get("vreAuthorization"))?t.roles:void 0,(null!=e?e.length:void 0)?-1===e.indexOf("UNVERIFIED_USER"):!1},t.prototype.checkLoggedIn=function(){return this.fetch({login:!1})},t.prototype.fetch=function(e){var i;return null==e&&(e={}),null==e.headers&&(e.headers={}),null==e.returnUrl&&(e.returnUrl=r.get("baseUrl")),e.headers.VRE_ID=this.VRE_ID,e.headers.Authorization=r.get("authToken"),i=_.extend(e,{error:function(t){return function(i,r){var s;return e.login===!0&&401===r.status?(s=n.$("<form>").attr({method:"post",action:t.loginUrl}),s.append(n.$("<input>").attr({type:"hidden",name:"hsurl",value:e.returnUrl})),n.$("body").append(s),s.submit()):"undefined"!=typeof console&&null!==console?console.error("Not logged in",r):void 0}}(this)}),t.__super__.fetch.call(this,i).done(function(e){return function(t){return null!=t._id?e.set({loggedIn:!0}):void 0}}(this))},t}(n.Model),t.exports=new i},{"../config":9,backbone:void 0}],18:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("underscore"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.routes={"persons(/)":"showPersonSearch","persons/:id(/)":"showPersonView","persons/:id/edit":"showPersonForm","documents(/)":"showDocumentSearch","documents/:id(/)":"showDocumentView","sources/:id(/)":"showSourceView","documents/:id/edit":"showDocumentForm","sources(/)":"showSourceList","receptions(/)":"showReceptionSearch","":"home"},t.prototype.initialize=function(e){return t.__super__.initialize.apply(this,arguments),this.controller=e.controller,this.root=e.root,this.processRoutes()},t.prototype.start=function(){return n.history.start({root:this.root,pushState:!0})},t.prototype.processRoutes=function(){var e,t,n,i,s;i=this.routes,s=[];for(n in i)t=i[n],t in this.controller&&(e=r.bind(this.controller[t],this.controller),s.push(this.route(n,t,e)));return s},t}(n.Router),t.exports=i},{backbone:void 0,underscore:void 0}],19:[function(e,t){var n,i,r,s,o,a,l,c,u,p={}.hasOwnProperty,h=function(e,t){function n(){this.constructor=e}for(var i in t)p.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),u=e("underscore"),n=i.$,l=e("../../templates/views/search.jade"),a=e("../../templates/views/search-results.jade"),o=e("../helpers/search.coffee").createFacetedSearch,s=e("../config"),c=e("../models/user"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return h(t,e),t.prototype.template=l,t.prototype.resultsTemplate=a,t.prototype.events={"click .cursor .next":"nextResults","click .cursor .prev":"prevResults","change .order-by select":"sortResults"},t.prototype.initialize=function(e){var t,n,r,s,a,l,c,p,h;return this.options=null!=e?e:{},u.extend(this,i.Events),this.type=null!=(t=this.options.type)?t:this.type,this.textSearchTitle=null!=(n=this.options.textSearchTitle)?n:this.textSearchTitle,this.queryOptions=null!=(r=this.options.queryOptions)?r:this.queryOptions,this.facets=null!=(s=this.options.facets)?s:this.facets,this.facetTitleMap=null!=(a=this.options.facetTitleMap)?a:this.facetTitleMap,this.sortableFieldsMap=null!=(l=null!=(c=this.options.sortableFieldsMap)?c:this.sortableFieldsMap)?l:{},this.startCollapsed=null!=(p=this.options.startCollapsed)?p:this.startCollapsed,this.fsTemplates=null!=(h=this.options.templates)?h:this.fsTemplates,this.search=o({type:this.type,queryOptions:this.queryOptions,facets:this.facets,facetTitleMap:this.facetTitleMap,textSearchTitle:this.textSearchTitle,collapsed:this.startCollapsed,templates:this.fsTemplates}),this.listenTo(this.search,"change:results",function(e){return function(t){return console.log("RESP",t),e.renderResults(t)}}(this))},t.prototype.nextResults=function(){return this.showLoader(),this.search.next()},t.prototype.prevResults=function(){return this.showLoader(),this.search.prev()},t.prototype.sortResults=function(e){var t;return t=this.sortField,this.sortField=n(e.currentTarget).val(),this.sortField!==t?this.search.sortResultsBy(this.sortField):void 0},t.prototype.resetSearch=function(){return this.search.reset()},t.prototype.showLoader=function(){var e;return this.displayLoader=!0,e=function(e){return function(){return e.displayLoader?(e.$(".cursor .position").hide(),e.$(".cursor .loader").fadeIn(150)):void 0}}(this),u.delay(e,200)},t.prototype.renderResults=function(e){var t,n,i,r,o;for(t={},o=e.get("results"),i=0,r=o.length;r>i;i++)n=o[i],t[n._id]=n;return this.$(".results").html(this.resultsTemplate({response:e.attributes,sortableFieldsMap:this.sortableFieldsMap,objectUrl:this.objectUrl,config:s,sortedBy:this.sortField,showCurated:function(e){var n;return n="importer"!==t[e.id]["^modified"].userId,n&&c.get("loggedIn")===!0}})),this.$(".cursor .loader").hide(),this.$(".cursor .position").show(),this.displayLoader=!1,this.$(".cursor .next").toggle(this.search.hasNext()),this.$(".cursor .prev").toggle(this.search.hasPrev()),this.$(".results").css("counter-reset","li-result "+e.attributes.start)},t.prototype.render=function(){return this.$el.html(this.template()),this.$(".search").html(this.search.el),this.$(".results").text("No results"),this.search.search()},t}(i.View),t.exports=r},{"../../templates/views/search-results.jade":62,"../../templates/views/search.jade":63,"../config":9,"../helpers/search.coffee":14,"../models/user":17,backbone:void 0,underscore:void 0}],20:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e
}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},l=[].slice;n=e("backbone"),r=function(e){return String(e).replace(/([A-Z](?![A-Z]))/g," $1").replace(/^./,function(e){return e.toUpperCase()})},s=function(e){return null==e&&(e=""),String(e).replace(/([A-Z](?![A-Z]))/g,"-$1").toLowerCase()},i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.tagName="div",n.prototype.fieldsetTemplate=e("../../templates/views/base-fieldset.jade"),n.prototype.fieldTemplate=e("../../templates/views/base-field.jade"),n.prototype.events={"click .controls .delete":"deleteRecord"},n.prototype.initialize=function(t){return null==t&&(t={}),this.config=t.config,this.user=t.user,null==this.config&&(this.config=e("../config")),null==this.user&&(this.user=e("../models/user")),this.listenTo(this.user,"change:loggedIn",function(e){return function(){return e.showControls()}}(this)),this.render()},n.prototype.isReception=function(e){var t,n,i,r,s;for(t=this.config.get("receptions"),s=t||[],i=0,r=s.length;r>i;i++)if(n=s[i],e===n.regularName||e===n.inverseName)return!0},n.prototype.getReceptions=function(){var e,t,n,i,r,s;for(t=this.model.get("@relations"),n={},s=_.keys(t),i=0,r=s.length;r>i;i++)e=s[i],this.isReception(e)&&(n[e]=t[e]);return n},n.prototype.deleteRecord=function(){var e;return e=this.$(".controls .delete"),e.hasClass("confirm")?this.model.destroy({beforeSend:function(e){return function(t){return t.setRequestHeader("Authorization",e.config.get("authToken")),t.setRequestHeader("VRE_ID",e.config.get("VRE_ID"))}}(this)}).success(function(){return function(){return console.log("OMG")}}(this)).fail(function(){return function(){return alert("Could not delete record"),e.removeClass("confirm"),e.removeClass("red"),e.addClass("gray"),e.removeClass("alert")}}(this)):(e.toggleClass("confirm"),e.toggleClass("red"),e.toggleClass("gray"),e.addClass("alert"))},n.prototype.showControls=function(){var e,t;return e=this.user.get("loggedIn")&&this.user.isVerified(),null!=(t=this.$controls)?t.toggle(e):void 0},n.prototype._processField=function(e){return e.html=this._fieldHtml(e),e},n.prototype._processFieldset=function(e){var t,n,i,r,s,o,a,c,u,p,h,d,f,m,g,v,y,b;for(h={},v=e.fields,n=d=0,m=v.length;m>d;n=++d)if(t=v[n],r=null!=t.field?t.field:t,c=null!=t["in"]?this.model.get(t["in"]):this.model.attributes,o=function(e){return function(n){return null!=t.map?t.map(n,e.model):n}}(this),_.isRegExp(r))for(u in c)p=c[u],u.match(r)&&(h[u]=o(p));else h[r]=o(c[r]);for(y=e.fields,n=f=0,g=y.length;g>f;n=++f)t=y[n],r=_.isRegExp(t)?t:_.isRegExp(t.field)?t.field:void 0,r&&(s=function(){var e,n,s,o;for(s=_.keys(h),o=[],e=0,n=s.length;n>e;e++)i=s[e],i.match(r)&&(a=null!=t.field?_.clone(t):{},a.field=i,a.value=h[i],o.push(a));return o}(),(b=e.fields).splice.apply(b,[n,1].concat(l.call(s))));return h},n.prototype._fieldHtml=function(e){var t,n,i,o;return n="",o=e.value,t=_.extend(_.clone(e),{title:null!=e.title?r(e.title):e.field,value:o}),e.formatNewlines===!0&&(o=String(null!=o?o:"").replace(/\n/g,"<br>")),t.classes=["field-"+s(t.field)],t.newLine&&t.classes.push("new-line"),t.large&&t.classes.push("large"),i=""===t.value||void 0===t.value||_.isArray(t.value)&&0===t.value.length||null==t.value,i&&t.classes.push("no-value"),n=this.fieldTemplate({field:t})},n.prototype._fieldsetHtml=function(e){var t,n,i,r,s,o,a;for(t=this._processFieldset(e),r=0,a=e.fields,i=s=0,o=a.length;o>s;i=++s)n=a[i],_.isString(n)?n={title:n,field:n,type:"Text",value:t[n]}:(n.value=t[n.field],n.field.match("pseudo")&&console.log(n)),n.html=this._fieldHtml(n),e.fields[i]=n,n.html.match(/no-value/)&&r++;return r===e.fields.length&&(e.empty=!0),this.fieldsetTemplate({fieldset:e})},n.prototype.renderFieldsets=function(){var e,t,n,i,r,s,o;for(this.$fieldsets.empty(),s=null!=(r=this.fieldsets)?r:[],o=[],n=0,i=s.length;i>n;n++)e=s[n],(!e.showOnlyWhenLoggedIn||this.user.isLoggedIn())&&(t=this._fieldsetHtml(e),o.push(this.$fieldsets.append(t)));return o},n.prototype.render=function(){var e,t,n;return t=null!=this.model.get("^pid"),n=this.model.get("^deleted"),e=t&&!n,this.$el.html(this.template({data:this.model.attributes,modified:this.model.get("^modified"),canEdit:t,isDeleted:n,config:this.config,versions:[],revisions:[],receptions:this.getReceptions()})),this.$controls=this.$(".controls"),this.showControls(),this.$fieldsets=this.$(".fieldsets"),this.renderFieldsets()},n}(n.View),t.exports=i},{"../../templates/views/base-field.jade":43,"../../templates/views/base-fieldset.jade":44,"../config":9,"../models/user":17,backbone:void 0}],21:[function(e,t){var n,i,r,s,o,a,l,c,u,p,h={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var i in t)h.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),l=e("../../config.coffee"),u=e("../../../data/metadata/wwdocument.json"),o=e("timbuctoo-edit-forms/src/coffee/views/form.coffee"),a=e("../status"),p=e("../../helpers/search").simpleSearch,s=e("timbuctoo-edit-forms/src/coffee/helpers/dynamic-relation-type-helper"),r=e("timbuctoo-edit-forms/src/coffee/helpers/dynamic-inverse-relation-type-helper"),c=e("timbuctoo-edit-forms/src/coffee/helpers.coffee").createTimbuctooSchema,i=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return d(i,t),i.prototype.className="document-edit",i.prototype.template=e("../../../templates/views/document/edit.jade"),i.prototype.receptionOf="timbuctoo-relation.receptionOf",i.prototype.receivedIn="timbuctoo-relation.receivedIn",i.prototype.relationTypes=["hasDocumentSource","hasWorkLanguage","hasGenre","hasPublishLocation","hasSourceCategory","isCreatedBy"],i.prototype.events={"click .save":"save","click .cancel":"cancel"},i.prototype.save=function(){var e,t,i,r,s,o;return r=new a,o=this.form.save(),i=o.result,e=o.errors,null==e?(r.show().loading(),i.error(function(){return function(){return r.show().error()}}(this)),i.done(function(e){return function(){return e.model.fetch().done(function(){return r.show().success(function(){return l.router().navigate(l.documentViewPath(e.model.id),{trigger:!0})})})}}(this))):(t=100,s=this.$(".field.error").first().offset().top,n.$("html, body").animate({scrollTop:s-t}))},i.prototype.initialize=function(){return this.render(),this.model.on("sync",function(e){return function(){return e.render()}}(this))},i.prototype.render=function(){var e,t,n,i,a,h,d,f,m;for(this.$el.html(this.template({config:l,document:this.model.attributes})),a=c(u,{exclude:[/^[_@^]/,"DELETED","ID","PID","ROLES","VARIATIONS","names","topoi","resourceFormat","resourceType","rights","description"],readonly:[/^temp/]}),a.notes.type="TextArea",m=this.relationTypes,d=0,f=m.length;f>d;d++)h=m[d],i=l.get("documentRelationTypes")[h],a["timbuctoo-relation."+h]={type:"Relation",relationTypeDescription:{relationTypeVariation:l.get("relationTypeVariation"),baseSourceType:i.sourceTypeName,baseTargetType:i.targetTypeName,typeId:i._id}};return _.extend(a["timbuctoo-relation.hasWorkLanguage"],{title:"Language",options:l.get("languages"),onlyOne:!0,relationTypeHelper:new s}),_.extend(a["timbuctoo-relation.hasGenre"],{title:"Genre",options:l.get("genres")||["One","Two","Trhee"],onlyOne:!0,relationTypeHelper:new s}),_.extend(a["timbuctoo-relation.hasPublishLocation"],{title:"Publish location",options:l.get("locations"),onlyOne:!0,relationTypeHelper:new s}),_.extend(a["timbuctoo-relation.hasSourceCategory"],{title:"Has source categories",onlyOne:!1,options:l.get("sourceCategories"),relationTypeHelper:new s}),_.extend(a["timbuctoo-relation.hasDocumentSource"],{title:"Has sources",onlyOne:!1,autocomplete:function(e){return p(e,"wwdocument",5e3)},relationTypeHelper:new s,placeholderString:"Sources"}),_.extend(a["timbuctoo-relation.isCreatedBy"],{title:"Creator",options:l.get("persons"),onlyOne:!1,autocomplete:function(e){return p(e,"wwperson",5e3)},relationTypeHelper:new s,placeholderString:"Persons"}),t=_.filter(l.get("receptions"),function(e){return"document"===e.baseSourceType}),n=_.filter(l.get("receptions"),function(e){return"document"===e.baseTargetType}),e=function(e){var t;return t=function(t){return p(t,e,5e3)}},a[this.receptionOf]={type:"DynamicRelations",title:"Reception of",relationTypes:n,relationTypeVariation:l.get("relationTypeVariation"),relationName:"reception",relationTypeHelper:new r(e)},a[this.receivedIn]={type:"DynamicRelations",title:"Received in",relationTypes:t,relationTypeVariation:l.get("relationTypeVariation"),relationName:"reception",relationTypeHelper:new s(e)},a.date.validators=["datable"],this.form=new o({className:"timbuctoo-form",authToken:l.get("authToken"),VRE_ID:l.get("VRE_ID"),relationsUrl:l.relationsUrl(),model:this.model,schema:a,fieldsets:[{fields:["title","englishTitle","description","tempCreator","timbuctoo-relation.isCreatedBy","notes"]},{legend:"Secondary information",collapsed:!0,fields:["tempLanguage","timbuctoo-relation.hasWorkLanguage","timbuctoo-relation.hasGenre","tempOrigin","timbuctoo-relation.hasPublishLocation","edition","date","documentType","source","timbuctoo-relation.hasSourceCategory","timbuctoo-relation.hasDocumentSource","links","reference"]},{legend:"Receptions",collapsed:!0,fields:[this.receptionOf,this.receivedIn]}]}),this.$(".form").html(this.form.el)},i}(n.View),t.exports=i},{"../../../data/metadata/wwdocument.json":37,"../../../templates/views/document/edit.jade":49,"../../config.coffee":9,"../../helpers/search":14,"../status":35,backbone:void 0,"timbuctoo-edit-forms/src/coffee/helpers.coffee":109,"timbuctoo-edit-forms/src/coffee/helpers/dynamic-inverse-relation-type-helper":110,"timbuctoo-edit-forms/src/coffee/helpers/dynamic-relation-type-helper":111,"timbuctoo-edit-forms/src/coffee/views/form.coffee":115}],22:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config.coffee"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.template=e("../../../templates/views/document/document-overview.jade"),n.prototype.tagName="div",n.prototype.className="document-overview",n.prototype.initialize=function(){return this.listenTo(r,"change:allDocuments",function(e){return function(){return e.render()}}(this)),null!=r.get("allDocuments")?this.render():void 0},n.prototype.render=function(){var e;return e=r.get("allDocuments"),this.$el.html(this.template({documents:e.models}))},n}(n.View),t.exports=i},{"../../../templates/views/document/document-overview.jade":47,"../../config.coffee":9,backbone:void 0}],23:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=e("../base-search.coffee"),s=e("../../config.coffee"),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.resultsTemplate=e("../../../templates/views/document/document-search-results.jade"),n.prototype.type="wwdocuments",n.prototype.queryOptions={term:"*",facetValues:[{name:"dynamic_b_is_source",values:["false"]}],typeString:s.get("documentTypeString")},n.prototype.resultRows=25,n.prototype.facetTitleMap=s.get("documentFacetTitles"),n.prototype.sortableFieldsMap={dynamic_sort_creator:"Creator",dynamic_sort_title:"Title"},n.prototype.textSearchTitle="Search by title",n.prototype.fsTemplates={facets:e("../../../templates/faceted-search/document.jade")},n.prototype.initialize=function(e){return this.options=e,n.__super__.initialize.apply(this,arguments),this.render()},n}(i),t.exports=r},{"../../../templates/faceted-search/document.jade":39,"../../../templates/views/document/document-search-results.jade":48,"../../config.coffee":9,"../base-search.coffee":19,backbone:void 0}],24:[function(e,t){var n,i,r,s,o,a,l,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=e("../../config"),n=e("../base-view"),l=e("../../helpers/base-view-helper"),a=l.relationField,o=l.namesMap,s=l.externalLinksMap,i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return u(n,t),n.prototype.className="document view",n.prototype.template=e("../../../templates/views/document/view.jade"),n.prototype.fieldsets=[{fields:["title",a("isCreatedBy","Creator"),a("hasWorkLanguage","Language"),a("hasPublishLocation","Published in"),a("isPublishedBy","Published by"),a("isStoredAt","Stored at"),a("hasGenre","Genre"),a("hasSourceCategory","Source Category"),a("hasDocumentSource","Document Source"),a("isDocumentSourceOf","Source for"),"description","edition","date",{title:"Links",field:"links",type:"Array",large:!0,group:!0,map:s},"reference",{title:"Notes",field:"notes",large:!0,formatNewlines:!0},"topoi",{field:"^pid",title:"Persistent ID",newLine:!0}]},{title:"Temporary Fields",showOnlyWhenLoggedIn:!0,fields:[/^temp/]}],n}(n),t.exports=i},{"../../../templates/views/document/view.jade":50,"../../config":9,"../../helpers/base-view-helper":10,"../base-view":20}],25:[function(e,t){var n,i,r,s,o,a,l,c,u,p,h,d,f,m,g={}.hasOwnProperty,v=function(e,t){function n(){this.constructor=e}for(var i in t)g.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),f=e("underscore"),l=e("../../config.coffee"),p=e("../../../data/metadata/wwperson.json"),s=e("timbuctoo-edit-forms/src/coffee/views/form.coffee"),a=e("../status"),c=e("timbuctoo-edit-forms/src/coffee/helpers.coffee").createTimbuctooSchema,m=e("../../helpers/search"),h=m.searchQuery,d=m.simpleSearch,r=e("timbuctoo-edit-forms/src/coffee/helpers/dynamic-relation-type-helper"),i=e("timbuctoo-edit-forms/src/coffee/helpers/dynamic-inverse-relation-type-helper"),u=["AUTHOR","ARCHETYPE","(empty)"],o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return v(o,t),o.prototype.className="person-edit",o.prototype.template=e("../../../templates/views/person/edit.jade"),o.prototype.relationTypes=["hasBirthPlace","hasDeathPlace","hasEducation","hasFinancialSituation","hasMaritalStatus","hasPseudonym","hasProfession","hasReligion","hasSocialClass","isCreatorOf","isCollaboratorOf","isMemberOf","isPseudonymOf"],o.prototype.events={"click .save":"save"},o.prototype.initialize=function(){return null!=this.model&&this.render(),this.model.on("sync",function(e){return function(){return e.render()}}(this))},o.prototype.save=function(){var e,t,i,r,s,o;return r=new a,o=this.form.save(),i=o.result,e=o.errors,null==e?(r.show().loading(),i.error(function(){return function(){return r.show().error()}}(this)),i.done(function(e){return function(){return e.model.fetch().done(function(){return r.show().success(function(){return l.router().navigate(l.personViewPath(e.model.id),{trigger:!0})})})}}(this))):(t=100,s=this.$(".field.error").first().offset().top,n.$("html, body").animate({scrollTop:s-t}))},o.prototype.render=function(){var e,t,n,o,a,h;for(this.$el.html(this.template({config:l,person:this.model.attributes})),t=c(p,{exclude:[/^[_@^]/,"DELETED","ID","PID","ROLES","VARIATIONS"],readonly:[/^temp/]}),f.extend(t.gender,{options:t.gender.options.map(function(e){return{val:e,label:l.mapGenderOption(e)}})}),h=this.relationTypes,o=0,a=h.length;a>o;o++)n=h[o],e=l.get("personRelationTypes")[n],t["timbuctoo-relation."+n]={type:"Relation",relationTypeDescription:{relationTypeVariation:l.get("relationTypeVariation"),typeId:e._id,baseSourceType:e.sourceTypeName,baseTargetType:e.targetTypeName}};return f.extend(t["timbuctoo-relation.hasBirthPlace"],{title:"Birth place",options:l.get("locations"),autocomplete:function(e){return d(e,"wwlocation")},relationTypeHelper:new r,onlyOne:!0,placeholderString:"Location"}),f.extend(t["timbuctoo-relation.hasDeathPlace"],{title:"Death place",options:l.get("locations"),autocomplete:function(e){return d(e,"wwlocation")},relationTypeHelper:new r,onlyOne:!0,placeholderString:"Location"}),f.extend(t["timbuctoo-relation.hasEducation"],{title:"Education",options:l.get("educations"),relationTypeHelper:new r}),f.extend(t["timbuctoo-relation.hasFinancialSituation"],{title:"Financials",options:l.get("financialSituations"),relationTypeHelper:new r}),f.extend(t["timbuctoo-relation.hasMaritalStatus"],{title:"Marital status",options:l.get("maritalStatuses"),relationTypeHelper:new r}),f.extend(t["timbuctoo-relation.hasProfession"],{title:"Profession",options:l.get("professions"),relationTypeHelper:new r}),f.extend(t["timbuctoo-relation.hasReligion"],{title:"Religion",options:l.get("religions"),relationTypeHelper:new r}),f.extend(t["timbuctoo-relation.hasSocialClass"],{title:"Social class",options:l.get("socialClasses"),relationTypeHelper:new r}),f.extend(t["timbuctoo-relation.isMemberOf"],{title:"Memberships",options:l.get("collectives"),autocomplete:function(e){return d(e,"wwcollective")},relationTypeHelper:new r,placeholderString:"Collective"}),f.extend(t["timbuctoo-relation.isCollaboratorOf"],{title:"Collaborations",options:l.get("persons"),autocomplete:function(e){return d(e,"wwperson",500,{facetValues:[{name:"dynamic_s_types",values:u}]})},relationTypeHelper:new r,placeholderString:"Person"}),f.extend(t["timbuctoo-relation.isCreatorOf"],{title:"Is creator of",options:l.get("documents"),autocomplete:function(e){return d(e,"wwdocument")},relationTypeHelper:new i,placeholderString:"Work"}),f.extend(t["timbuctoo-relation.hasPseudonym"],{title:"Has pseudonym",options:l.get("persons"),autocomplete:function(e){return d(e,"wwperson",500,{facetValues:[{name:"dynamic_s_types",values:["PSEUDONYM"]}]})},relationTypeHelper:new i,placeholderString:"Pseudonym"}),f.extend(t["timbuctoo-relation.isPseudonymOf"],{title:"Is pseudonym of",options:l.get("persons"),autocomplete:function(e){return d(e,"wwperson",500,{facetValues:[{name:"dynamic_s_types",values:u}]})},relationTypeHelper:new r,placeholderString:"Person"}),t.notes.type="TextArea",t.personalSituation.type="TextArea",t.birthDate.validators=["datable"],t.deathDate.validators=["datable"],this.form=new s({className:"timbuctoo-form",authToken:l.get("authToken"),VRE_ID:l.get("VRE_ID"),relationsUrl:l.relationsUrl(),model:this.model,schema:t,fieldsets:[{fields:["tempOldId","tempName","tempSpouse","names","gender","types","tempPseudonyms","timbuctoo-relation.hasPseudonym","timbuctoo-relation.isPseudonymOf"]},{legend:"Notes",collapsed:!1,fields:["notes"]},{legend:"Personal situation",collapsed:!1,fields:["personalSituation"]},{legend:"Dates and Places",collapsed:!0,fields:["birthDate","deathDate","tempBirthPlace","tempPlaceOfBirth","timbuctoo-relation.hasBirthPlace","livedIn","tempDeathPlace","timbuctoo-relation.hasDeathPlace","nationality"]},{legend:"Personal",collapsed:!0,fields:["timbuctoo-relation.hasMaritalStatus","tempChildren","tempPsChildren","children","timbuctoo-relation.hasSocialClass","timbuctoo-relation.hasEducation","timbuctoo-relation.hasReligion","health"]},{legend:"Public",collapsed:!0,fields:["tempFinancialSituation","timbuctoo-relation.hasProfession","tempCollaborations","timbuctoo-relation.isCollaboratorOf","timbuctoo-relation.hasFinancialSituation","tempMemberships","timbuctoo-relation.isMemberOf"]},{legend:"Other",collapsed:!0,fields:["bibliography","links"]},{legend:"Works",collapsed:!0,fields:["timbuctoo-relation.isCreatorOf"]}]}),this.$(".form").html(this.form.el)},o}(n.View),t.exports=o},{"../../../data/metadata/wwperson.json":38,"../../../templates/views/person/edit.jade":51,"../../config.coffee":9,"../../helpers/search":14,"../status":35,backbone:void 0,"timbuctoo-edit-forms/src/coffee/helpers.coffee":109,"timbuctoo-edit-forms/src/coffee/helpers/dynamic-inverse-relation-type-helper":110,"timbuctoo-edit-forms/src/coffee/helpers/dynamic-relation-type-helper":111,"timbuctoo-edit-forms/src/coffee/views/form.coffee":115,underscore:void 0}],26:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config.coffee"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.template=e("../../../templates/views/person/person-overview.jade"),n.prototype.tagName="div",n.prototype.className="person-overview",n.prototype.initialize=function(){return this.listenTo(r,"change:allPersons",function(e){return function(){return e.render()}}(this)),null!=r.get("allPersons")?this.render():void 0},n.prototype.render=function(){var e;return e=r.get("allPersons"),this.$el.html(this.template({persons:e.models}))},n}(n.View),t.exports=i},{"../../../templates/views/person/person-overview.jade":54,"../../config.coffee":9,backbone:void 0}],27:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=e("../base-search.coffee"),s=e("../../config.coffee"),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.resultsTemplate=e("../../../templates/views/person/person-search-results.jade"),n.prototype.type="wwpersons",n.prototype.queryOptions={term:"*",typeString:s.get("personTypeString")},n.prototype.resultRows=25,n.prototype.facetTitleMap=s.get("personFacetTitles"),n.prototype.sortableFieldsMap={dynamic_k_deathDate:"Year of Death",dynamic_k_birthDate:"Year of Birth",dynamic_sort_name:"Name"},n.prototype.textSearchTitle="Search by name",n.prototype.fsTemplates={facets:e("../../../templates/faceted-search/person.jade")},n.prototype.initialize=function(e){return this.options=e,n.__super__.initialize.apply(this,arguments),this.render()},n}(i),t.exports=r},{"../../../templates/faceted-search/person.jade":41,"../../../templates/views/person/person-search-results.jade":55,"../../config.coffee":9,"../base-search.coffee":19,backbone:void 0}],28:[function(e,t){var n,i,r,s,o,a,l,c,u={}.hasOwnProperty,p=function(e,t){function n(){this.constructor=e}for(var i in t)u.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=e("../../config.coffee"),n=e("../base-view"),c=e("../../helpers/base-view-helper"),l=c.relationField,a=c.namesMap,s=c.externalLinksMap,o=e("../../../templates/views/base-link.jade"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.prototype.className="person view",n.prototype.template=e("../../../templates/views/person/view.jade"),n.prototype.fieldsets=[{fields:[{title:"Names",field:"names",type:"Array",map:a},{field:"gender",title:"Gender",map:function(e){return r.mapGenderOption(e)}},l("hasPseudonym","Pseudonyms"),l("isPseudonymOf","Is pseudonym of"),{title:"Date of birth",field:"birthDate"},l("hasBirthPlace","Place of birth"),{title:"Date of death",field:"deathDate"},l("hasDeathPlace","Place of death"),"nationality",l("hasPersonLanguage","Languages"),l("isCollaboratorOf","Collaborators"),l("isMemberOf","Collectives"),l("isRelatedTo","Related to"),l("isSpouseOf","Spouse"),l("hasEducation","Education"),l("hasFinancialSituation","Financials"),l("hasMaritalStatus","Marital Status"),l("hasProfession","Profession"),l("hasReligion","Religion"),l("hasSocialClass","Social class"),"children","livedIn",l("isCreatorOf","Created"),{title:"Created by Pseudonyms",field:"pseudonyms",type:"Array",group:!0,map:function(e,t){var n,i,s,a,l,c;i=function(e){var n,i;return n=t.get("@relations").hasPseudonym,i=_.find(n,function(t){return t.id===e}),i.displayName},c=[];for(n in e)s=e[n],l=function(){var e,t,n,i,l,c;for(l=null!=(n=null!=(i=s["@relations"])?i.isCreatorOf:void 0)?n:[],c=[],e=0,t=l.length;t>e;e++)a=l[e],c.push(o({link:{url:r.viewUrl(a.id),label:a.displayName}}));return c}(),c.push(l.length?"<h5>"+i(n)+"</h5>"+l.join("<br>"):void 0);return c}},{title:"Notes",field:"notes",large:!0},{title:"Links",field:"links",type:"Array",large:!0,group:!0,map:s},{title:"Bibliography",field:"bibliography",large:!0},{title:"Health",field:"health",large:!0},{field:"personalSituation",title:"Personal situation",large:!0},{field:"^pid",title:"Persistent ID"}]},{title:"Temporary Fields",showOnlyWhenLoggedIn:!0,fields:[/^temp/]}],n}(n),t.exports=i},{"../../../templates/views/base-link.jade":45,"../../../templates/views/person/view.jade":56,"../../config.coffee":9,"../../helpers/base-view-helper":10,"../base-view":20}],29:[function(e,t){var n,i,r,s,o,a,l,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config"),s=e("../../helpers/search").createFacetedSearch,a=e("../../../templates/faceted-search/reception-main.jade"),o=e("../../../templates/faceted-search/document.jade"),l=e("../../../templates/faceted-search/person.jade"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return u(n,t),n.prototype.template=e("../../../templates/views/reception/source-query-builder.jade"),n.prototype.className="query-builder",n.prototype.initialize=function(e){return null==e&&(e={}),this.facetValues=[],this.type=null},n.prototype.createSearch=function(e){var t,n;return null!=(n=this.search)&&n.destroy(),t={collapsed:!0,templates:{main:a}},"work"===e?(t.type="wwdocuments",t.templates.facets=o,t.facetTitleMap=r.get("documentFacetTitles"),t.queryOptions={facetValues:[{name:"dynamic_b_is_source",values:["false"]}],term:"*"}):"person"===this.type&&(t.type="wwpersons",t.templates.facets=l,t.facetTitleMap=r.get("personFacetTitles")),this.search=s(t),this.facetValues=[],this.listenTo(this.search,"change:queryoptions",function(e){return function(t){return e.setValues(t.get("facetValues")),e.trigger("change",t)}}(this)),this.search.search()},n.prototype.setValues=function(e){return this.facetValues=e},n.prototype.getValues=function(){var e,t,n,i,r;for(i=this.facetValues,r=[],t=0,n=i.length;n>t;t++)e=i[t],e.name.match(/is_source/)||r.push(e);return r},n.prototype.getQueryId=function(){return this.search.getSearchResultURL().split("/").pop()},n.prototype.render=function(){return this.$el.html(this.template()),null!=this.search?this.$(".search-container").append(this.search.el):void 0},n.prototype.setType=function(e){return e!==this.type?(this.type=e,this.createSearch(e),this.render()):void 0},n.prototype.hide=function(){return this.$el.addClass("hidden")},n.prototype.show=function(){return this.$el.removeClass("hidden")},n}(n.View),t.exports=i},{"../../../templates/faceted-search/document.jade":39,"../../../templates/faceted-search/person.jade":41,"../../../templates/faceted-search/reception-main.jade":42,"../../../templates/views/reception/source-query-builder.jade":60,"../../config":9,"../../helpers/search":14,backbone:void 0}],30:[function(e,t){var n,i,r,s,o,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var i in t)l.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config"),s=e("../../helpers/search").createFacetedSearch,a=e("../../../templates/faceted-search/reception-main.jade"),o=e("../../../templates/faceted-search/document.jade"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return c(n,t),n.prototype.template=e("../../../templates/views/reception/reception-selector.jade"),n.prototype.initialize=function(e){return null==e&&(e={}),this.search=s({type:"wwdocuments",collapsed:!0,facetTitleMap:r.get("documentFacetTitles"),templates:{main:a,facets:o}}),this.facetValues=[],this.listenTo(this.search,"change:queryoptions",function(e){return function(t){return e.setValues(t.get("facetValues")),console.log(t),e.trigger("change",t)}}(this)),this.search.search()},n.prototype.setValues=function(e){return this.facetValues=e},n.prototype.getValues=function(){return this.facetValues},n.prototype.getQueryId=function(){return this.search.getSearchResultURL().split("/").pop()},n.prototype.render=function(){return this.$el.html(this.template()),this.$(".search-container").html(this.search.el)},n.prototype.hide=function(){return this.$el.addClass("hidden")},n.prototype.show=function(){return this.$el.removeClass("hidden")},n.prototype.getSearchId=function(){return this.search.getSearchId()},n}(n.View),t.exports=i},{"../../../templates/faceted-search/document.jade":39,"../../../templates/faceted-search/reception-main.jade":42,"../../../templates/views/reception/reception-selector.jade":57,"../../config":9,"../../helpers/search":14,backbone:void 0}],31:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),n=e("jquery"),s=e("../../config"),r=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return a(r,t),r.prototype.template=e("../../../templates/views/reception/search-result.jade"),r.prototype.initialize=function(e){return null==e&&(e={}),_.extend(this,i.Events),this.listenTo(this.collection,"change:results",function(e){return function(){return e.render()}}(this)),this.render()},r.prototype.events={"click .next":"clickNext","click .prev":"clickPrev","click .num-rows li":"clickNumberOfResultRows"},r.prototype.clickNext=function(){return this.collection.moveCursor("_next")},r.prototype.clickPrev=function(){return this.collection.moveCursor("_prev")},r.prototype.clickNumberOfResultRows=function(e){var t;return t=n(e.currentTarget).attr("data-result-rows"),this.trigger("change:number-of-result-rows",t)},r.prototype.render=function(){var e,t,n,i,r,o;if(n=this.collection.current,null!=n){for(e={},o=n.attributes.results,i=0,r=o.length;r>i;i++)t=o[i],e[t._id]=t;return this.$el.html(this.template({response:n.attributes,config:s,relIds:e}))}},r}(i.View),t.exports=r},{"../../../templates/views/reception/search-result.jade":58,"../../config":9,backbone:void 0,jquery:void 0}],32:[function(e,t){var n,i,r,s,o,a,l,c,u,p,h={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var i in t)h.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),p=e("underscore"),c=e("huygens-faceted-search/src/coffee/collections/searchresults"),u=e("../../config"),l=e("./type-selector"),o=e("./reception-selector"),i=e("./receptee-selector"),r=e("./results"),a=e("../../helpers/reception-service"),s=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return d(s,t),s.prototype.template=e("../../../templates/views/reception/search.jade"),s.prototype.className="reception-search",s.prototype.numRows=100,s.prototype.events={"click .tab.type":function(){return this.selectTab("type")},"click .tab.reception":function(){return this.selectTab("reception")},"click .tab.receptee":function(){return this.selectTab("receptee")},"click .tab.search .search-receptions":"search"},s.prototype.initialize=function(){return p.extend(this,n.Events),this.model=new n.Model,this.receptionService=new a,this.query=null,this.tabs={},this.types=[],this.recepteeType=null,this.searchResults=new c({config:{resultRows:100,baseUrl:u.get("baseUrl"),searchPath:u.get("relationSearchPath")}}),this.receptionSearchId=null,this.recepteeSearchId=null,this.tabs.type=this.receptionTypeSelector=new l,this.tabs.reception=this.receptionSelector=new o,this.listenTo(this.receptionSelector,"change",function(e){return function(){return e.renderReceptionTab()}}(this)),this.tabs.receptee=this.recepteeSelector=new i,this.listenTo(this.recepteeSelector,"change",function(e){return function(){return e.renderRecepteeTab()
}}(this)),this.listenTo(this.receptionTypeSelector,"change",function(e){return function(t){return e.changeType(t),e.recepteeSelector.setType(t.category),e.renderRecepteeTab()}}(this)),this.render()},s.prototype.setTypeSelected=function(){return this.$(".tabs").addClass("type-selected")},s.prototype.changeType=function(e){return this.types=e.types,this.setRecepteeType(e.category),this.setTypeSelected(),this.renderTypeTab()},s.prototype.setRecepteeType=function(e){return this.recepteeType=e,this.renderRecepteeTab()},s.prototype.selectTab=function(e){var t,n,i;this.$(".tabs .tab.selected").removeClass("selected"),this.$(".tabs .tab."+e).addClass("selected"),i=this.tabs;for(t in i)n=i[t],t!==e&&n.hide();return this.$(".views").removeClass("slide-up"),this.tabs[e].show()},s.prototype.search=function(){var e,t,n,i;return this.$el.addClass("searching"),this.$(".views").addClass("slide-up"),e=this.recepteeSelector.getQueryId(),t=this.receptionSelector.getQueryId(),i=function(){var e,t,i,r;for(i=this.types,r=[],e=0,t=i.length;t>e;e++)n=i[e],r.push(n.id);return r}.call(this),console.log("Searching",t,e,i),this.query={sourceSearchId:e,targetSearchId:t,relationTypeIds:i,typeString:"wwrelation"},this.receptionService.search(this.query,this.numRows).done(function(e){return function(t){return e.searchResults.addModel(t,JSON.stringify(e.query))}}(this)).fail(function(){return"undefined"!=typeof console&&null!==console?console.error("Failed searching receptions",arguments):void 0})},s.prototype.renderTypeTab=function(){var e,t,n;return e=this.$(".tabs .tab.type .text"),n=function(e){return u.receptionTypeLabel(e.name)},this.types.length>3?(t=this.types.slice(0,3).map(n).join(", "),t+=" <span class=more>and "+(this.types.length-3)+" more</span>",e.html(t)):e.text(this.types.map(n).join(", ")),e.show()},s.prototype.renderReceptionTab=function(){var e,t,n,i,r,s,o,a,l,c;for(t=this.$(".tabs .tab.reception .text"),e=this.$(".tabs .tab.reception .link"),o=this.receptionSelector.getValues(),i=u.get("documentFacetTitles"),s="with ",a=0,l=o.length;l>a;a++)n=o[a],r=null!=(c=i[n.name])?c:n.name,s+=r.toLowerCase(),n.values.length>1&&(s+="s"),s+=" "+n.values.join(", "),s+="; ";return s=s.replace(/; $/,""),t.text(s).show(),e.hide()},s.prototype.renderRecepteeTab=function(){var e,t,n,i,r,s,o,a,l,c;if(t=this.$(".tabs .tab.receptee .text"),e=this.$(".tabs .tab.receptee .link"),i=u.get("work"===this.recepteeType?"documentFacetTitles":"personFacetTitles"),o=this.recepteeSelector.getValues(),s="on ",0===o.length&&(s+="all "),s+=this.recepteeType+"s",o.length)for(s+=" with ",a=0,l=o.length;l>a;a++)n=o[a],r=null!=(c=i[n.name])?c:n.name,s+=r.toLowerCase(),s+=" "+n.values.join(", "),s+="; ";return t.text(s),t.text(s).show(),e.hide()},s.prototype.render=function(){var e;return this.$el.html(this.template()),e=this.$(".query-editor"),this.receptionTypeSelector.setElement(this.$(".select-type")),this.receptionTypeSelector.render(),this.receptionSelector.setElement(this.$(".select-reception")),this.receptionSelector.render(),this.recepteeSelector.setElement(this.$(".select-receptee")),this.recepteeSelector.render(),this.resultsView=new r({collection:this.searchResults,el:this.$(".reception-results")}),this.listenTo(this.resultsView,"change:number-of-result-rows",function(e){return function(t){return e.receptionService.setResultRows(t).done(function(t){return e.searchResults.addModel(t,JSON.stringify(e.query))})}}(this))},s}(n.View),t.exports=s},{"../../../templates/views/reception/search.jade":59,"../../config":9,"../../helpers/reception-service":13,"./receptee-selector":29,"./reception-selector":30,"./results":31,"./type-selector":33,backbone:void 0,"huygens-faceted-search/src/coffee/collections/searchresults":73,underscore:void 0}],33:[function(e,t){var n,i,r,s,o,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var i in t)l.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),a=e("underscore"),n=i.$,s=e("../../config"),o={},r=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return c(r,t),r.prototype.template=e("../../../templates/views/reception/type-selector.jade"),r.prototype.selection={category:null,types:[]},r.prototype.events={"click li":"clickType"},r.prototype.clickType=function(e){var t,i,r,s,o;return i=n(e.currentTarget),o=i.attr("data-type"),t=i.closest(".category"),r=t.attr("data-category"),r!==this.selection.category&&(this.selection.types=[],t.siblings(".category").removeClass("active"),t.addClass("active"),this.$("li").removeClass("selected"),this.selection.category=r),i.toggleClass("selected"),s=t.find("li.selected"),this.selection.types=s.map(function(){return{name:this.getAttribute("data-type"),id:this.getAttribute("data-type-id")}}).get(),this.trigger("change",this.selection)},r.prototype.initialize=function(e){return this.options=null!=e?e:{},a.extend(this,i.Events),this.render()},r.prototype.hide=function(){return this.$el.addClass("hidden")},r.prototype.show=function(){return this.$el.removeClass("hidden")},r.prototype.render=function(){return this.$el.html(this.template({config:s,documentReceptions:s.documentReceptions(),personReceptions:s.personReceptions()}))},r}(i.View),t.exports=r},{"../../../templates/views/reception/type-selector.jade":61,"../../config":9,backbone:void 0,underscore:void 0}],34:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config"),s=e("../../helpers/load-app-data").loadSources,i=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return a(i,t),i.prototype.template=e("../../../templates/views/sources/list.jade"),i.prototype.className="sources",i.prototype.events={"click ul.index li":"clickLetter"},i.prototype.initialize=function(e){return null==e&&(e={}),r.get("sources")?this.render():(this.renderWaiting(),s().done(function(e){return function(){return e.render()}}(this)))},i.prototype.clickLetter=function(e){var t;return t=e.currentTarget.getAttribute("data-letter"),console.log("LET",t),this.scrollToLetter(t)},i.prototype.scrollToLetter=function(e){var t,i;return t=100,i=this.$(".letter[data-letter="+e+"]").offset().top,n.$("html, body").animate({scrollTop:i-t})},i.prototype.renderWaiting=function(){return this.$el.html("Waiting for sources to load, please stand by")},i.prototype.render=function(){var e,t,n;return n=r.get("sources"),null!=n?(t=function(e){return e.title.substr(0,1).toUpperCase()},e=_.groupBy(n,t),this.$el.html(this.template({sources:e,letters:_.keys(e).sort(),config:r}))):void 0},i}(n.View),t.exports=i},{"../../../templates/views/sources/list.jade":64,"../../config":9,"../../helpers/load-app-data":11,backbone:void 0}],35:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),o=e("underscore"),n=i.$,s=e("../../templates/views/status.jade"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.template=s,t.prototype.className="status-indicator",t.prototype.waitBeforeClose=500,t.prototype.events={"click button.btn":"done"},t.prototype.initialize=function(e){return this.options=null!=e?e:{},null!=this.options.template&&(this.template=this.options.template),null!=this.options.waitBeforeClose&&(this.waitBeforeClose=this.options.waitBeforeClose),this.render()},t.prototype.setStatus=function(e){var t,n,i,r;for(r=this.$el.attr("class").split(/\s+/),n=0,i=r.length;i>n;n++)t=r[n],t.match(/^status-(?!indicator)/)&&this.$el.removeClass(t);return this.$el.addClass("status-"+e)},t.prototype.error=function(){return this.setStatus("error"),this.show()},t.prototype.success=function(e){var t,n;return this.setStatus("success"),n=function(e){return function(){return e.show()}}(this),o.delay(n,250),t=function(t){return function(){return t.done(e)}}(this),o.delay(t,250+this.waitBeforeClose)},t.prototype.loading=function(){return this.setStatus("loading")},t.prototype.done=function(e){return this.$el.fadeOut(150,function(t){return function(){return t.$el.remove(),"function"==typeof e?e():void 0}}(this))},t.prototype.show=function(){return this.$el.fadeIn(150),this},t.prototype.hide=function(){return this.$el.fadeOut(150),this},t.prototype.render=function(){return this.$el.html(this.template()),this.$el.hide(),n("body").append(this.el)},t}(i.View),t.exports=r},{"../../templates/views/status.jade":65,backbone:void 0,underscore:void 0}],36:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=e("hibb-modal"),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.template=e("../../templates/views/user-status.jade"),n.prototype.events={"click a.login":"login"},n.prototype.initialize=function(){return this.listenTo(this.model,"change",function(e){return function(){return e.render()}}(this)),this.render()},n.prototype.login=function(){var e;e=new i({title:"My title!",html:$("<div />").html("lalala"),submitValue:"OK"})},n.prototype.showLoader=function(){return this.$(".login").fadeOut(150,function(e){return function(){return e.$(".loader").fadeIn(150)}}(this))},n.prototype.render=function(){return this.$el.html(this.template(this.model.attributes)).toggleClass("logged-in",null!=this.model.get("_id"))},n}(n.View),t.exports=r},{"../../templates/views/user-status.jade":66,backbone:void 0,"hibb-modal":67}],37:[function(e,t){t.exports={edition:{type:"String"},tempCreator:{type:"String"},documentType:{value:["UNKNOWN","ANTHOLOGY","ARTICLE","AWARD","CATALOGUE","COMPILATION","DIARY","LETTER","LIST","MONOGRAPH","PERIODICAL","PICTURE","PUBLICITY","SHEETMUSIC","THEATERSCRIPT","WORK"],type:"String"},englishTitle:{type:"String"},PID:{value:"^pid",type:"String"},"^deleted":{type:"boolean"},rights:{type:"String"},"^created":{type:"Change"},tempLanguage:{type:"String"},date:{type:"Datable"},"^modified":{type:"Change"},tempOrigin:{type:"String"},title:{type:"String"},_id:{type:"String"},description:{type:"String"},ID:{value:"_id",type:"String"},"@relations":{type:"Map of (String, List of (EntityRef))"},DELETED:{value:"^deleted",type:"String"},"^pid":{type:"String"},VARIATIONS:{value:"^variations",type:"String"},ROLES:{value:"^roles",type:"String"},links:{type:"List of (Link)"},topoi:{type:"List of (String)"},reference:{type:"String"},resourceType:{value:["UNKNOWN","IMAGE","SOUND","TEXT"],type:"String"},resourceFormat:{type:"String"},source:{type:"boolean"},"^rev":{type:"int"},"^variations":{type:"List of (String)"},"@relationCount":{type:"int"},tempOldId:{type:"String"},notes:{type:"String"},"^roles":{type:"List of (Role)"}}},{}],38:[function(e,t){t.exports={tempPsChildren:{type:"String"},PID:{value:"^pid",type:"String"},"^deleted":{type:"boolean"},tempName:{type:"String"},livedIn:{type:"String"},"^created":{type:"Change"},children:{value:["UNKNOWN","NO","YES"],type:"String"},deathDate:{type:"Datable"},bibliography:{type:"String"},"^modified":{type:"Change"},tempSpouse:{type:"String"},_id:{type:"String"},tempMemberships:{type:"String"},ID:{value:"_id",type:"String"},"@relations":{type:"Map of (String, List of (EntityRef))"},gender:{value:["UNKNOWN","MALE","FEMALE","NOT_APPLICABLE"],type:"String"},birthDate:{type:"Datable"},types:{value:["ARCHETYPE","AUTHOR","PSEUDONYM"],type:"List of (String)"},DELETED:{value:"^deleted",type:"String"},"^pid":{type:"String"},VARIATIONS:{value:"^variations",type:"String"},ROLES:{value:"^roles",type:"String"},tempPseudonyms:{type:"String"},tempCollaborations:{type:"String"},tempFinancialSituation:{type:"String"},links:{type:"List of (Link)"},tempChildren:{type:"String"},health:{type:"String"},fsPseudonyms:{type:"List of (String)"},tempDeath:{type:"String"},tempBirthPlace:{type:"String"},tempMotherTongue:{type:"String"},nationality:{type:"String"},"^rev":{type:"int"},names:{value:[],type:"WWPerson.Names"},"^variations":{type:"List of (String)"},tempDeathPlace:{type:"String"},"@relationCount":{type:"int"},tempOldId:{type:"String"},notes:{type:"String"},tempPlaceOfBirth:{type:"String"},"^roles":{type:"List of (Role)"},personalSituation:{type:"String"}}},{}],39:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="dynamic_s_creator-placeholder"></div><div class="dynamic_s_document_type-placeholder"></div><div class="dynamic_s_date-placeholder"></div><div class="dynamic_s_origin-placeholder"></div><div class="dynamic_s_language-placeholder"></div><div class="dynamic_s_genre-placeholder"></div><div class="dynamic_s_subject-placeholder"></div>'),e.join("")}},{"jade/runtime":5}],40:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="overlay"><div><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div class="faceted-search"><ul class="facets-menu"><li class="reset"><button><i class="fa fa-refresh"></i><span>Reset search</span></button></li><li class="switch"><button><i class="fa fa-angle-double-down"></i><span>Switch to</span></button></li><li class="collapse-expand"><button><i class="fa fa-compress"></i><span>Collapse facets</span></button></li></ul><div class="text-search-placeholder"></div><div class="facets-placeholder"></div></div>'),e.join("")}},{"jade/runtime":5}],41:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="dynamic_s_gender-placeholder"></div><div class="dynamic_s_birthDate-placeholder"></div><div class="dynamic_s_residence-placeholder"></div><div class="dynamic_s_language-placeholder"></div><div class="dynamic_s_birthplace-placeholder"></div><div class="dynamic_s_deathDate-placeholder"></div><div class="dynamic_s_deathplace-placeholder"></div><div class="dynamic_s_collective-placeholder"></div><div class="dynamic_s_religion-placeholder"></div><div class="dynamic_s_types-placeholder"></div>'),e.join("")}},{"jade/runtime":5}],42:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="overlay"><div><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div class="faceted-search"><ul class="facets-menu"><li class="reset"><button><i class="fa fa-refresh"></i><span>Clear selection</span></button></li></ul><div class="facets-placeholder"></div></div>'),e.join("")}},{"jade/runtime":5}],43:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push("<div"+n.cls(["field",e.classes.join(" ")],[null,!0])+"><label>"+n.escape(null==(t=e.title)?"":t)+"</label>"),"Array"==e.type?(i.push('<div class="value">'),function(){var n=e.value;if("number"==typeof n.length)for(var r=0,s=n.length;s>r;r++){var o=n[r];i.push("<p>"+(null==(t=o)?"":t)+"</p>")}else{var s=0;for(var r in n){s++;var o=n[r];i.push("<p>"+(null==(t=o)?"":t)+"</p>")}}}.call(this),i.push("</div>")):i.push('<div class="value">'+(null==(t=e.value)?"":t)+"</div>"),i.push("</div>")}.call(this,"field"in r?r.field:"undefined"!=typeof field?field:void 0),i.join("")}},{"jade/runtime":5}],44:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push("<div"+n.cls(["fieldset","gridHolder",e.empty?"empty":""],[null,null,!0])+">"),e.title&&i.push('<div class="c4_4"><h4 class="title">'+n.escape(null==(t=e.title)?"":t)+"</h4></div>"),function(){var n=e.fields;if("number"==typeof n.length)for(var r=0,s=n.length;s>r;r++){var o=n[r];i.push(null==(t=o.html)?"":t)}else{var s=0;for(var r in n){s++;var o=n[r];i.push(null==(t=o.html)?"":t)}}}.call(this),i.push('<div class="clear"></div></div>')}.call(this,"fieldset"in r?r.fieldset:"undefined"!=typeof fieldset?fieldset:void 0),i.join("")}},{"jade/runtime":5}],45:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push(e.external?"<a"+n.attr("href",e.url,!0,!1)+' target="_self" class="link">'+n.escape(null==(t=e.label)?"":t)+"</a>":"<a"+n.attr("href",e.url,!0,!1)+' class="link">'+n.escape(null==(t=e.label)?"":t)+"</a>")}.call(this,"link"in r?r.link:"undefined"!=typeof link?link:void 0),i.join("")}},{"jade/runtime":5}],46:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{};return function(e){t.push('<div class="container"><div class="header centered"><a'+n.attr("href",e.get("baseUrl"),!0,!1)+' class="home"><h1>Neww Women Writers</h1></a><a href="http://www.huygens.knaw.nl/" target="_self" class="huygens-ing"></a></div><div class="navigation"><div class="centered"><div class="links"><a href="/persons/" class="person">Persons</a><a href="/documents/" class="document">Documents</a><a href="/receptions/" class="reception">Receptions</a><a href="/sources/" class="source">Sources</a><div class="user-status"></div></div></div></div><div id="search"><div class="persons centered"></div><div class="documents centered"></div><div class="receptions"></div></div><div id="view" class="centered"></div></div>')}.call(this,"config"in i?i.config:"undefined"!=typeof config?config:void 0),t.join("")}},{"jade/runtime":5}],47:[function(e,t){e("jade/runtime");t.exports=function(e){var t=[],n=e||{};return function(e){}.call(this,"undefined"in n?n.undefined:void 0),t.join("")}},{"jade/runtime":5}],48:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s,o,a,l){i.push("<h4>"+n.escape(null==(t=e.numFound+(1!=e.numFound?" documents":" document")+" found")?"":t)+'<div class="order-by"><span>Order by</span>'),e.sortableFields&&(i.push("<select>"),i.push(r?'<option disabled="disabled"></option>':'<option disabled="disabled" selected="selected"></option>'),function(){var o=e.sortableFields;if("number"==typeof o.length)for(var a=0,l=o.length;l>a;a++){var c=o[a];i.push(r==c?"<option"+n.attr("value",c,!0,!1)+' selected="selected">'+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>":"<option"+n.attr("value",c,!0,!1)+">"+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>")}else{var l=0;for(var a in o){l++;var c=o[a];i.push(r==c?"<option"+n.attr("value",c,!0,!1)+' selected="selected">'+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>":"<option"+n.attr("value",c,!0,!1)+">"+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>")}}}.call(this),i.push("</select>")),i.push('</div></h4><div class="cursor"><span class="prev">&laquo; Previous</span><span class="position">Page&nbsp;<span class="current">'+n.escape(null==(t=1+e.start/o.get("resultRows"))?"":t)+'</span>&nbsp;of&nbsp;<span class="total">'+n.escape(null==(t=a.ceil(e.numFound/o.get("resultRows")))?"":t)+'</span></span><div class="loader"></div><span class="next">Next &raquo;</span></div><ol'+n.attr("start",e.start+1,!0,!1)+">"),function(){var r=e.refs;if("number"==typeof r.length)for(var s=0,a=r.length;a>s;s++){var c=r[s];i.push("<li"+n.cls([l(c)?"is-curated":""],[!0])+"><a"+n.attr("href",o.documentViewUrl(c.id),!0,!1)+">"+n.escape(null==(t=c.displayName)?"":t)+"</a></li>")}else{var a=0;for(var s in r){a++;var c=r[s];i.push("<li"+n.cls([l(c)?"is-curated":""],[!0])+"><a"+n.attr("href",o.documentViewUrl(c.id),!0,!1)+">"+n.escape(null==(t=c.displayName)?"":t)+"</a></li>")}}}.call(this),i.push("</ol>")}.call(this,"response"in r?r.response:"undefined"!=typeof response?response:void 0,"sortedBy"in r?r.sortedBy:"undefined"!=typeof sortedBy?sortedBy:void 0,"sortableFieldsMap"in r?r.sortableFieldsMap:"undefined"!=typeof sortableFieldsMap?sortableFieldsMap:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"Math"in r?r.Math:"undefined"!=typeof Math?Math:void 0,"showCurated"in r?r.showCurated:"undefined"!=typeof showCurated?showCurated:void 0),i.join("")}},{"jade/runtime":5}],49:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r){i.push('<div class="controls"><button class="btn save"><i class="fa fa-check"></i>Save</button><a'+n.attr("href",e.documentViewUrl(r._id),!0,!1)+' class="btn gray cancel"><i class="fa fa-times"></i>Cancel</a></div><h1>'+n.escape(null==(t=r.title)?"":t)+'</h1><div class="form"></div><div class="controls bottom"><button class="btn save"><i class="fa fa-check"></i>Save</button><a'+n.attr("href",e.documentViewUrl(r._id),!0,!1)+' class="btn gray cancel"><i class="fa fa-times"></i>Cancel</a></div>')}.call(this,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"document"in r?r.document:"undefined"!=typeof document?document:void 0),i.join("")}},{"jade/runtime":5}],50:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s,o,a,l,c,u){i.push('<div class="controls">'),i.push(e?'<div class="is-deleted"><i class="fa fa-warning"></i><span>This record has been deleted.</span></div>':r?"<a"+n.attr("href",s.editUrl(o._id),!0,!1)+' class="edit btn green"><i class="fa fa-pencil"></i>Edit</a><button class="delete btn gray right"><i class="fa fa-trash-o"></i><span class="default">Delete</span><span class="confirm">Confirm deletion</span></button>':'<button class="btn disabled"><i class="fa fa-ban"></i>Edit</button><span class="processing">This record is being processed and can not be edited right now.</span>'),i.push("</div><h2>"+n.escape(null==(t=o.title)?"":t)+'</h2><h4 class="author">'+n.escape(null==(t=o.tempCreator)?"":t)+'</h4><div class="fieldsets"></div><div class="c4_4">'),a&&l.keys(a).length&&(i.push('<h3>Receptions of this work<ul class="receptions">'),function(){var e=a;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var l=e[r];i.push("<li><h4>"+n.escape(null==(t=r)?"":t)+"</h4><ul>"),function(){var e=l;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}else{var o=0;for(var r in e){o++;var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}}}.call(this),i.push("</ul></li>")}else{var o=0;for(var r in e){o++;var l=e[r];i.push("<li><h4>"+n.escape(null==(t=r)?"":t)+"</h4><ul>"),function(){var e=l;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}else{var o=0;for(var r in e){o++;var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}}}.call(this),i.push("</ul></li>")}}}.call(this),i.push("</ul></h3>")),i.push("</div>"),r&&i.push('<div class="last-modified">Last modified by user&nbsp;<span class="user-id">'+n.escape(null==(t=c.userId.replace(/USER0+/g,""))?"":t)+'</span>&nbsp;on&nbsp;<span class="time">'+n.escape(null==(t=new u(c.timeStamp).toDateString())?"":t)+"</span></div>")}.call(this,"isDeleted"in r?r.isDeleted:"undefined"!=typeof isDeleted?isDeleted:void 0,"canEdit"in r?r.canEdit:"undefined"!=typeof canEdit?canEdit:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"data"in r?r.data:"undefined"!=typeof data?data:void 0,"receptions"in r?r.receptions:"undefined"!=typeof receptions?receptions:void 0,"_"in r?r._:"undefined"!=typeof _?_:void 0,"modified"in r?r.modified:"undefined"!=typeof modified?modified:void 0,"Date"in r?r.Date:"undefined"!=typeof Date?Date:void 0),i.join("")}},{"jade/runtime":5}],51:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r){i.push('<div class="controls"><button class="btn save"><i class="fa fa-check"></i>Save</button><a'+n.attr("href",e.personViewUrl(r._id),!0,!1)+' class="btn gray cancel"><i class="fa fa-times"></i>Cancel</a></div><h1>'+n.escape(null==(t=r.tempName)?"":t)+'</h1><div class="form"></div><div class="controls bottom"><button class="btn save"><i class="fa fa-check"></i>Save</button><a'+n.attr("href",e.personViewUrl(r._id),!0,!1)+' class="btn gray cancel"><i class="fa fa-times"></i>Cancel</a></div>')}.call(this,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"person"in r?r.person:"undefined"!=typeof person?person:void 0),i.join("")}},{"jade/runtime":5}],52:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push('<span class="value">'+n.escape(null==(t=e)?"":t)+"</span><!-- span.type= type-->")}.call(this,"value"in r?r.value:"undefined"!=typeof value?value:void 0),i.join("")}},{"jade/runtime":5}],53:[function(e,t){e("jade/runtime");t.exports=function(e){var t,n=[],i=e||{};return function(e){n.push('<div class="name">'),function(){var i=e;if("number"==typeof i.length)for(var r=0,s=i.length;s>r;r++){var o=i[r];n.push('<span class="component">'+(null==(t=o)?"":t)+"</span>")}else{var s=0;for(var r in i){s++;var o=i[r];n.push('<span class="component">'+(null==(t=o)?"":t)+"</span>")}}}.call(this),n.push("</div>")}.call(this,"components"in i?i.components:"undefined"!=typeof components?components:void 0),n.join("")}},{"jade/runtime":5}],54:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push('<h3>All persons</h3><ul class="persons">'),function(){var r=e;if("number"==typeof r.length)for(var s=0,o=r.length;o>s;s++){var a=r[s];i.push('<li class="person"><a'+n.attr("href","/person/"+a.attributes._id,!0,!1)+">"+n.escape(null==(t=a.attributes.tempName)?"":t)+"</a></li>")}else{var o=0;for(var s in r){o++;var a=r[s];i.push('<li class="person"><a'+n.attr("href","/person/"+a.attributes._id,!0,!1)+">"+n.escape(null==(t=a.attributes.tempName)?"":t)+"</a></li>")}}}.call(this),i.push("</ul>")}.call(this,"persons"in r?r.persons:"undefined"!=typeof persons?persons:void 0),i.join("")}},{"jade/runtime":5}],55:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s,o,a,l,c){i.push("<h4>"+n.escape(null==(t=e.numFound+(1!=e.numFound?" persons":" person")+" found")?"":t)+'<div class="order-by"><span>Order by</span>'),e.sortableFields&&(i.push("<select>"),i.push(r?'<option disabled="disabled"></option>':'<option disabled="disabled" selected="selected"></option>'),function(){var o=e.sortableFields;if("number"==typeof o.length)for(var a=0,l=o.length;l>a;a++){var c=o[a];i.push(r==c?"<option"+n.attr("value",c,!0,!1)+' selected="selected">'+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>":"<option"+n.attr("value",c,!0,!1)+">"+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>")}else{var l=0;for(var a in o){l++;var c=o[a];i.push(r==c?"<option"+n.attr("value",c,!0,!1)+' selected="selected">'+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>":"<option"+n.attr("value",c,!0,!1)+">"+n.escape(null==(t=s[c]?s[c]:c)?"":t)+"</option>")}}}.call(this),i.push("</select>")),i.push('</div></h4><div class="cursor"><span class="prev">&laquo; Previous</span><span class="position">Page&nbsp;<span class="current">'+n.escape(null==(t=1+e.start/o.get("resultRows"))?"":t)+'</span>&nbsp;of&nbsp;<span class="total">'+n.escape(null==(t=a.ceil(e.numFound/o.get("resultRows")))?"":t)+'</span></span><div class="loader"></div><span class="next">Next &raquo;</span></div><ol class="persons">');var u=l.object(l.map(e.results,function(e){return[e._id,e]}));(function(){var r=e.refs;if("number"==typeof r.length)for(var s=0,a=r.length;a>s;s++){var l=r[s];i.push("<li"+n.cls([c(l)?"is-curated":""],[!0])+"><a"+n.attr("href",o.personViewUrl(l.id),!0,!1)+">"),i.push(l.displayName?'<div class="name">'+n.escape(null==(t=l.displayName)?"":t)+"</div>":'<div class="name"><span class="empty-name">No name provided</span></div>'),i.push('<div class="alive"><span class="from">'+n.escape(null==(t=u[l.id]?u[l.id].birthDate||"unknown":"unknown")?"":t)+'</span>&nbsp;&ndash;&nbsp;<span class="to">'+n.escape(null==(t=u[l.id]?u[l.id].deathDate||"unknown":"unknown")?"":t)+"</span></div></a></li>")}else{var a=0;for(var s in r){a++;var l=r[s];i.push("<li"+n.cls([c(l)?"is-curated":""],[!0])+"><a"+n.attr("href",o.personViewUrl(l.id),!0,!1)+">"),i.push(l.displayName?'<div class="name">'+n.escape(null==(t=l.displayName)?"":t)+"</div>":'<div class="name"><span class="empty-name">No name provided</span></div>'),i.push('<div class="alive"><span class="from">'+n.escape(null==(t=u[l.id]?u[l.id].birthDate||"unknown":"unknown")?"":t)+'</span>&nbsp;&ndash;&nbsp;<span class="to">'+n.escape(null==(t=u[l.id]?u[l.id].deathDate||"unknown":"unknown")?"":t)+"</span></div></a></li>")}}}).call(this),i.push("</ol>")}.call(this,"response"in r?r.response:"undefined"!=typeof response?response:void 0,"sortedBy"in r?r.sortedBy:"undefined"!=typeof sortedBy?sortedBy:void 0,"sortableFieldsMap"in r?r.sortableFieldsMap:"undefined"!=typeof sortableFieldsMap?sortableFieldsMap:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"Math"in r?r.Math:"undefined"!=typeof Math?Math:void 0,"_"in r?r._:"undefined"!=typeof _?_:void 0,"showCurated"in r?r.showCurated:"undefined"!=typeof showCurated?showCurated:void 0),i.join("")}},{"jade/runtime":5}],56:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s,o,a,l,c,u){i.push('<div class="controls">'),i.push(e?'<div class="is-deleted"><i class="fa fa-warning"></i><span>This record has been deleted.</span></div>':r?"<a"+n.attr("href",s.editUrl(o._id),!0,!1)+' class="edit btn green"><i class="fa fa-pencil"></i>Edit</a><button class="delete btn gray right"><i class="fa fa-trash-o"></i><span class="default">Delete</span><span class="confirm">Confirm deletion</span></button>':'<button class="btn disabled"><i class="fa fa-ban"></i>Edit</button><span class="processing">This record is being processed and can not be edited right now.</span>'),i.push("</div><h2>"+n.escape(null==(t=o.tempName)?"":t)+'</h2><div class="fieldsets"></div><div class="c4_4">'),a&&l.keys(a).length&&(i.push('<h3>Receptions of this work<ul class="receptions">'),function(){var e=a;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var l=e[r];i.push("<li><h4>"+n.escape(null==(t=r)?"":t)+"</h4><ul>"),function(){var e=l;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}else{var o=0;for(var r in e){o++;var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}}}.call(this),i.push("</ul></li>")}else{var o=0;for(var r in e){o++;var l=e[r];i.push("<li><h4>"+n.escape(null==(t=r)?"":t)+"</h4><ul>"),function(){var e=l;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}else{var o=0;for(var r in e){o++;var a=e[r];i.push("<li><a"+n.attr("href",s.viewUrl(a.id),!0,!1)+">"+n.escape(null==(t=a.displayName)?"":t)+"</a></li>")}}}.call(this),i.push("</ul></li>")}}}.call(this),i.push("</ul></h3>")),i.push("</div>"),r&&i.push('<div class="last-modified">Last modified by user&nbsp;<span class="user-id">'+n.escape(null==(t=c.userId.replace(/USER0+/g,""))?"":t)+'</span>&nbsp;on&nbsp;<span class="time">'+n.escape(null==(t=new u(c.timeStamp).toDateString())?"":t)+"</span></div>")}.call(this,"isDeleted"in r?r.isDeleted:"undefined"!=typeof isDeleted?isDeleted:void 0,"canEdit"in r?r.canEdit:"undefined"!=typeof canEdit?canEdit:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"data"in r?r.data:"undefined"!=typeof data?data:void 0,"receptions"in r?r.receptions:"undefined"!=typeof receptions?receptions:void 0,"_"in r?r._:"undefined"!=typeof _?_:void 0,"modified"in r?r.modified:"undefined"!=typeof modified?modified:void 0,"Date"in r?r.Date:"undefined"!=typeof Date?Date:void 0),i.join("")}},{"jade/runtime":5}],57:[function(e,t){e("jade/runtime");
t.exports=function(){var e=[];return e.push('<h3>Reception criteria</h3><div class="search-container"></div>'),e.join("")}},{"jade/runtime":5}],58:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s){e&&(i.push('<span class="found">'+n.escape(null==(t=e.numFound+" receptions found")?"":t)+'</span><ul class="num-rows">'),function(){var e=[50,100,250,500];if("number"==typeof e.length)for(var r=0,s=e.length;s>r;r++){var o=e[r];i.push("<li"+n.attr("data-result-rows",o,!0,!1)+">"+n.escape(null==(t=o)?"":t)+"</li>")}else{var s=0;for(var r in e){s++;var o=e[r];i.push("<li"+n.attr("data-result-rows",o,!0,!1)+">"+n.escape(null==(t=o)?"":t)+"</li>")}}}.call(this),i.push("</ul>"),e._prev&&i.push("<p"+n.attr("href",e._prev,!0,!1)+' class="prev">« Previous</p>'),e._next&&i.push("<p"+n.attr("href",e._next,!0,!1)+' class="next">Next »</p>'),e.numFound>0?(i.push('<table class="results-table"><thead class="results-head"><tr><th></th><th>Type</th><th>Receptions</th></tr></thead><tbody'+n.attr("style","counter-reset: reception-counter "+e.start,!0,!1)+' class="results-body">'),function(){var o=e.refs;if("number"==typeof o.length)for(var a=0,l=o.length;l>a;a++){var c=o[a];i.push("<tr><td><a"+n.attr("href",r.viewUrl(s[c.id]["^sourceId"]),!0,!1)+">"+n.escape(null==(t=c.sourceName)?"":t)+"</a></td><td>"+n.escape(null==(t=r.receptionTypeLabel(c.relationName))?"":t)+"</td><td><a"+n.attr("href",r.viewUrl(s[c.id]["^targetId"]),!0,!1)+">"+n.escape(null==(t=c.targetName)?"":t)+"</a></td></tr>")}else{var l=0;for(var a in o){l++;var c=o[a];i.push("<tr><td><a"+n.attr("href",r.viewUrl(s[c.id]["^sourceId"]),!0,!1)+">"+n.escape(null==(t=c.sourceName)?"":t)+"</a></td><td>"+n.escape(null==(t=r.receptionTypeLabel(c.relationName))?"":t)+"</td><td><a"+n.attr("href",r.viewUrl(s[c.id]["^targetId"]),!0,!1)+">"+n.escape(null==(t=c.targetName)?"":t)+"</a></td></tr>")}}}.call(this),i.push("</tbody></table>")):i.push("<p>No results found</p>"))}.call(this,"response"in r?r.response:"undefined"!=typeof response?response:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"relIds"in r?r.relIds:"undefined"!=typeof relIds?relIds:void 0),i.join("")}},{"jade/runtime":5}],59:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="reception-search"><div class="centered query"><div class="tabs"><div class="tab type"><div class="text">All receptions</div><div class="link">All receptions</div></div><div class="tab reception"><div class="text">(all receptions)</div><div class="link">(all receptions)</div></div><div class="tab receptee"><div class="text">All persons/works</div><div class="link">All persons/works</div></div><div class="tab search"><button class="btn search-receptions"><i class="fa fa-search"></i>Search</button></div></div></div></div><div class="views"><div class="select-type centered"></div><div class="select-reception centered hidden"></div><div class="select-receptee centered hidden"></div></div><div class="reception-results centered"></div>'),e.join("")}},{"jade/runtime":5}],60:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<h3>Search criteria</h3><div class="search-container"></div>'),e.join("")}},{"jade/runtime":5}],61:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s){i.push('<div class="help-text">Select the type of reception you wish to search for\nby selecting one or more of the options in the list to right</div><div data-category="work" class="category work"><h3>Receptions on works</h3><ul>'),function(){var s=e;if("number"==typeof s.length)for(var o=0,a=s.length;a>o;o++){var l=s[o];i.push("<li"+n.attr("data-type",l.regularName,!0,!1)+n.attr("data-type-id",l.typeId,!0,!1)+'><span class="link">'+n.escape(null==(t=r.receptionTypeLabel(l.regularName))?"":t)+"</span></li>")}else{var a=0;for(var o in s){a++;var l=s[o];i.push("<li"+n.attr("data-type",l.regularName,!0,!1)+n.attr("data-type-id",l.typeId,!0,!1)+'><span class="link">'+n.escape(null==(t=r.receptionTypeLabel(l.regularName))?"":t)+"</span></li>")}}}.call(this),i.push('</ul></div><div data-category="person" class="category person"><h3>Receptions on persons</h3><ul>'),function(){var e=s;if("number"==typeof e.length)for(var o=0,a=e.length;a>o;o++){var l=e[o];i.push("<li"+n.attr("data-type",l.regularName,!0,!1)+n.attr("data-type-id",l.typeId,!0,!1)+'><span class="link">'+n.escape(null==(t=r.receptionTypeLabel(l.regularName))?"":t)+"</span></li>")}else{var a=0;for(var o in e){a++;var l=e[o];i.push("<li"+n.attr("data-type",l.regularName,!0,!1)+n.attr("data-type-id",l.typeId,!0,!1)+'><span class="link">'+n.escape(null==(t=r.receptionTypeLabel(l.regularName))?"":t)+"</span></li>")}}}.call(this),i.push("</ul></div>")}.call(this,"documentReceptions"in r?r.documentReceptions:"undefined"!=typeof documentReceptions?documentReceptions:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0,"personReceptions"in r?r.personReceptions:"undefined"!=typeof personReceptions?personReceptions:void 0),i.join("")}},{"jade/runtime":5}],62:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push("<h4>"+n.escape(null==(t=e.numFound+" results")?"":t)+"</h4><ul>"),function(){var r=e.results;if("number"==typeof r.length)for(var s=0,o=r.length;o>s;s++){var a=r[s];i.push("<li>"+n.escape(null==(t=a.tempName)?"":t)+"</li>")}else{var o=0;for(var s in r){o++;var a=r[s];i.push("<li>"+n.escape(null==(t=a.tempName)?"":t)+"</li>")}}}.call(this),i.push("</ul>")}.call(this,"response"in r?r.response:"undefined"!=typeof response?response:void 0),i.join("")}},{"jade/runtime":5}],63:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="search"></div><div class="results"><h1>Hey there</h1></div>'),e.join("")}},{"jade/runtime":5}],64:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s){i.push('<ul class="index">'),function(){var r=e;if("number"==typeof r.length)for(var s=0,o=r.length;o>s;s++){var a=r[s];i.push("<li"+n.attr("data-letter",a,!0,!1)+">"+n.escape(null==(t=a)?"":t)+"</li>")}else{var o=0;for(var s in r){o++;var a=r[s];i.push("<li"+n.attr("data-letter",a,!0,!1)+">"+n.escape(null==(t=a)?"":t)+"</li>")}}}.call(this),i.push("</ul><h1>Source Index</h1>"),function(){var o=e;if("number"==typeof o.length)for(var a=0,l=o.length;l>a;a++){var c=o[a];i.push("<div"+n.attr("data-letter",c,!0,!1)+' class="letter"><h2>'+n.escape(null==(t=c)?"":t)+"</h2><ul>"),function(){var e=r[c];if("number"==typeof e.length)for(var o=0,a=e.length;a>o;o++){var l=e[o];i.push("<li><a"+n.attr("href",s.sourceViewUrl(l.id),!0,!1)+">"+n.escape(null==(t=l.title)?"":t)+"</a></li>")}else{var a=0;for(var o in e){a++;var l=e[o];i.push("<li><a"+n.attr("href",s.sourceViewUrl(l.id),!0,!1)+">"+n.escape(null==(t=l.title)?"":t)+"</a></li>")}}}.call(this),i.push("</ul></div>")}else{var l=0;for(var a in o){l++;var c=o[a];i.push("<div"+n.attr("data-letter",c,!0,!1)+' class="letter"><h2>'+n.escape(null==(t=c)?"":t)+"</h2><ul>"),function(){var e=r[c];if("number"==typeof e.length)for(var o=0,a=e.length;a>o;o++){var l=e[o];i.push("<li><a"+n.attr("href",s.sourceViewUrl(l.id),!0,!1)+">"+n.escape(null==(t=l.title)?"":t)+"</a></li>")}else{var a=0;for(var o in e){a++;var l=e[o];i.push("<li><a"+n.attr("href",s.sourceViewUrl(l.id),!0,!1)+">"+n.escape(null==(t=l.title)?"":t)+"</a></li>")}}}.call(this),i.push("</ul></div>")}}}.call(this)}.call(this,"letters"in r?r.letters:"undefined"!=typeof letters?letters:void 0,"sources"in r?r.sources:"undefined"!=typeof sources?sources:void 0,"config"in r?r.config:"undefined"!=typeof config?config:void 0),i.join("")}},{"jade/runtime":5}],65:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="loading box"><h1>Please wait...</h1></div><div class="error box"><h1><i class="fa fa-warning"></i><span class="title">Error</span></h1><div class="message">I\'m very sorry, but it seems an error has occurred.</div><button type="button" class="btn ok">OK</button></div><div class="success box"><h1><i class="fa fa-check"></i><span class="title">Success!</span></h1></div>'),e.join("")}},{"jade/runtime":5}],66:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push('<a href="#" class="login">Login</a><div class="loader">Logging in</div><span><span class="label">Logged in as&nbsp;</span><span class="user-name">'+n.escape(null==(t=e?e:"unknown")?"":t)+"</span></span>")}.call(this,"commonName"in r?r.commonName:"undefined"!=typeof commonName?commonName:void 0),i.join("")}},{"jade/runtime":5}],67:[function(e,t,n){(function(i){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof i?r=i:"undefined"!=typeof self&&(r=self),r.Pagination=e()}}(function(){var t;return function n(t,i,r){function s(a,l){if(!i[a]){if(!t[a]){var c="function"==typeof e&&e;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return s(n?n:e)},u,u.exports,n,t,i,r)}return i[a].exports}for(var o="function"==typeof e&&e,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,n,i){(function(r){!function(e){if("object"==typeof i)n.exports=e();else if("function"==typeof t&&t.amd)t(e);else{var s;"undefined"!=typeof window?s=window:"undefined"!=typeof r?s=r:"undefined"!=typeof self&&(s=self),s.jade=e()}}(function(){return function t(n,i,r){function s(a,l){if(!i[a]){if(!n[a]){var c="function"==typeof e&&e;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return s(t?t:e)},u,u.exports,t,n,i,r)}return i[a].exports}for(var o="function"==typeof e&&e,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,n){"use strict";function i(e){return null!=e&&""!==e}function r(e){return Array.isArray(e)?e.map(r).filter(i).join(" "):e}n.merge=function s(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=s(n,e[r]);return n}var o=e["class"],a=t["class"];(o||a)&&(o=o||[],a=a||[],Array.isArray(o)||(o=[o]),Array.isArray(a)||(a=[a]),e["class"]=o.concat(a).filter(i));for(var l in t)"class"!=l&&(e[l]=t[l]);return e},n.joinClasses=r,n.cls=function(e,t){for(var i=[],s=0;s<e.length;s++)i.push(t&&t[s]?n.escape(r([e[s]])):r(e[s]));var o=r(i);return o.length?' class="'+o+'"':""},n.attr=function(e,t,i,r){return"boolean"==typeof t||null==t?t?" "+(r?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof t?" "+e+"='"+JSON.stringify(t).replace(/'/g,"&apos;")+"'":i?" "+e+'="'+n.escape(t)+'"':" "+e+'="'+t+'"'},n.attrs=function(e,t){var i=[],s=Object.keys(e);if(s.length)for(var o=0;o<s.length;++o){var a=s[o],l=e[a];"class"==a?(l=r(l))&&i.push(" "+a+'="'+l+'"'):i.push(n.attr(a,l,!1,t))}return i.join("")},n.escape=function(e){var t=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return t===""+e?e:t},n.rethrow=function o(t,n,i,r){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&n||r))throw t.message+=" on line "+i,t;try{r=r||e("fs").readFileSync(n,"utf8")}catch(s){o(t,null,i)}var a=3,l=r.split("\n"),c=Math.max(i-a,0),u=Math.min(l.length,i+a),a=l.slice(c,u).map(function(e,t){var n=t+c+1;return(n==i?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+i+"\n"+a+"\n\n"+t.message,t}},{fs:2}],2:[function(){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t){var n,i,r,s,o,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var i in t)l.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),a=e("underscore"),n=e("jquery"),o=e("./main.jade"),s=e("./manager"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.className="hibb-modal",t.prototype.defaultOptions=function(){return{title:"",titleClass:"",cancelAndSubmit:!0,cancelValue:"Cancel",submitValue:"Submit",customClassName:"",focusOnFirstInput:!0,clickOverlay:!0}},t.prototype.initialize=function(e){return this.options=null!=e?e:{},t.__super__.initialize.apply(this,arguments),this.options=a.extend(this.defaultOptions(),this.options),this.options.customClassName.length>0&&this.$el.addClass(this.options.customClassName),this.render()},t.prototype.render=function(){var e,t,n,i,r,a,l;return a=o(this.options),this.$el.html(a),e=this.$(".body"),null!=this.options.html?e.html(this.options.html):e.hide(),this.$(".body").scroll(function(){return function(e){return e.stopPropagation()}}(this)),s.add(this),null!=this.options.width&&(this.$(".modalbody").css("width",this.options.width),i=-1*parseInt(this.options.width,10)/2,"%"===this.options.width.slice(-1)&&(i+="%"),"vw"===this.options.width.slice(-2)&&(i+="vw"),"auto"===this.options.width&&(i=this.$(".modalbody").width()/-2),this.$(".modalbody").css("margin-left",i)),null!=this.options.height&&this.$(".modalbody").css("height",this.options.height),l=document.documentElement.clientHeight,r=this.$(".modalbody").outerHeight()/2,t=this.$(".modalbody").offset().top,r>t&&(r=t-20),this.$(".modalbody").css("margin-top",-1*r),this.$(".modalbody .body").css("max-height",l-175),this.options.focusOnFirstInput&&(n=this.$('input[type="text"]').first(),n.length>0&&n.focus()),this},t.prototype.events={"click button.submit":"submit","click button.cancel":"cancel","click .overlay":function(){return this.options.clickOverlay?this.cancel():void 0},"keydown input":function(e){return 13===e.keyCode?(e.preventDefault(),this.submit(e)):void 0}},t.prototype.submit=function(e){var t;return t=n(e.currentTarget),t.hasClass("loader")?void 0:(t.addClass("loader"),this.$("button.cancel").hide(),this.trigger("submit"))},t.prototype.cancel=function(e){return null!=e&&e.preventDefault(),this.trigger("cancel"),this.close()},t.prototype.close=function(){return this.trigger("close"),s.remove(this)},t.prototype.destroy=function(){return this.close()},t.prototype.fadeOut=function(e){var t;return null==e&&(e=1e3),t=0===e?0:500,this.$(".modalbody").delay(e).fadeOut(t),setTimeout(function(e){return function(){return e.close()}}(this),e+t-100)},t.prototype.message=function(e,t){return-1===["success","warning","error"].indexOf(e)?console.error("Unknown message type!"):(this.$("p.message").show(),this.$("p.message").html(t).addClass(e))},t.prototype.messageAndFade=function(e,t,n){return this.$(".modalbody .body").hide(),this.$("footer").hide(),this.message(e,t),this.fadeOut(n)},t}(i.View),t.exports=r},{"./main.jade":3,"./manager":4}],3:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s,o,a){i.push('<div class="overlay"></div><div class="modalbody"><header>'),""!==e&&i.push("<h2"+n.cls([r],[!0])+">"+(null==(t=e)?"":t)+"</h2>"),i.push('<p class="message"></p></header><div class="body"></div>'),s&&i.push('<footer><button class="cancel">'+n.escape(null==(t=o)?"":t)+'</button><button class="submit">'+n.escape(null==(t=a)?"":t)+"</button></footer>"),i.push("</div>")}.call(this,"title"in r?r.title:"undefined"!=typeof title?title:void 0,"titleClass"in r?r.titleClass:"undefined"!=typeof titleClass?titleClass:void 0,"cancelAndSubmit"in r?r.cancelAndSubmit:"undefined"!=typeof cancelAndSubmit?cancelAndSubmit:void 0,"cancelValue"in r?r.cancelValue:"undefined"!=typeof cancelValue?cancelValue:void 0,"submitValue"in r?r.submitValue:"undefined"!=typeof submitValue?submitValue:void 0),i.join("")}},{"jade/runtime":1}],4:[function(e,t){var n,i;n=e("jquery"),i=function(){function e(){this.modals=[]}return e.prototype.add=function(e){var t,i,r,s,o;for(o=this.modals,r=0,s=o.length;s>r;r++)i=o[r],i.$(".overlay").css("opacity","0.2");return t=this.modals.push(e),e.$(".overlay").css("z-index",1e4+2*t-1),e.$(".modalbody").css("z-index",1e4+2*t),n("body").prepend(e.$el)},e.prototype.remove=function(e){var t;return t=this.modals.indexOf(e),this.modals.splice(t,1),this.modals.length>0&&this.modals[this.modals.length-1].$(".overlay").css("opacity","0.7"),e.trigger("removed"),e.off(),e.remove()},e}(),t.exports=new i},{}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],68:[function(e,t){(function(){t.exports={el:function(e){return{closest:function(t){var n,i,r;for(n=function(e){return e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector};e;){if(r=n(e),null!=r&&(i=r.bind(e)(t)))return e;e=e.parentNode}},position:function(t){var n,i,r;for(null==t&&(t=document.body),n=0,r=0,i=e;null!=i&&i!==t&&!this.hasDescendant(t);)n+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;return{left:n,top:r}},boundingBox:function(){var t;return t=this.position(),t.width=e.clientWidth,t.height=e.clientHeight,t.right=t.left+t.width,t.bottom=t.top+t.height,t},hasDescendant:function(t){var n;for(n=t.parentNode;null!=n;){if(n===e)return!0;n=n.parentNode}return!1},insertAfter:function(t){return t.parentNode.insertBefore(e,t.nextSibling)},hasScrollBar:function(e){return hasScrollBarX(e)||hasScrollBarY(e)},hasScrollBarX:function(e){return e.scrollWidth>e.clientWidth},hasScrollBarY:function(e){return e.scrollHeight>e.clientHeight},inViewport:function(t){var n,i,r;return r=null!=t?t:window,n=null!=t?t:document.documentElement,i=e.getBoundingClientRect(),i.top>=0&&i.left>=0&&i.bottom<=(r.innerHeight||n.clientHeight)&&i.right<=(r.innerWidth||n.clientWidth)}}}}}).call(this)},{}],69:[function(e,t){(function(){var e={}.hasOwnProperty;t.exports={get:function(e,t){return null==t&&(t={}),this._sendRequest("GET",e,t)},post:function(e,t){return null==t&&(t={}),this._sendRequest("POST",e,t)},put:function(e,t){return null==t&&(t={}),this._sendRequest("PUT",e,t)},_promise:function(){return{done:function(e){return this.callDone=e},callDone:null,fail:function(e){return this.callFail=e},callFail:null,always:function(e){return this.callAlways=e},callAlways:null}},_sendRequest:function(t,n,i){var r,s,o,a,l;null==i&&(i={}),s=this._promise(),null==i.data&&(i.data={}),null==i.headers&&(i.headers={}),a=new XMLHttpRequest,a.onreadystatechange=function(){var e;if(a.readyState===XMLHttpRequest.DONE)if(null!=s.callAlways&&s.callAlways(a),200<=(e=a.status)&&206>=e){if(null!=s.callDone)return s.callDone(a)}else if(null!=s.callFail)return s.callFail(a)},a.open(t,n,!0),a.setRequestHeader("Content-type","application/json"),l=i.headers;for(r in l)e.call(l,r)&&(o=l[r],a.setRequestHeader(r,o));return a.send(i.data),s}}}).call(this)},{}],70:[function(e,t){(function(){t.exports={generateID:function(e){var t,n;for(e=null!=e&&e>0?e-1:7,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.charAt(Math.floor(52*Math.random()));e--;)n+=t.charAt(Math.floor(Math.random()*t.length));return n},setResetTimeout:function(){var e;return e=null,function(t,n,i){return null!=e&&(null!=i&&i(),clearTimeout(e)),e=setTimeout(function(){return e=null,n()},t)}}()}}).call(this)},{}],71:[function(e,t,n){(function(i){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof i?r=i:"undefined"!=typeof self&&(r=self),r.jade=e()}}(function(){return function t(n,i,r){function s(a,l){if(!i[a]){if(!n[a]){var c="function"==typeof e&&e;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return s(t?t:e)},u,u.exports,t,n,i,r)}return i[a].exports}for(var o="function"==typeof e&&e,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,n){"use strict";function i(e){return null!=e&&""!==e}function r(e){return Array.isArray(e)?e.map(r).filter(i).join(" "):e}n.merge=function s(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=s(n,e[r]);return n}var o=e["class"],a=t["class"];(o||a)&&(o=o||[],a=a||[],Array.isArray(o)||(o=[o]),Array.isArray(a)||(a=[a]),e["class"]=o.concat(a).filter(i));for(var l in t)"class"!=l&&(e[l]=t[l]);return e},n.joinClasses=r,n.cls=function(e,t){for(var i=[],s=0;s<e.length;s++)i.push(t&&t[s]?n.escape(r([e[s]])):r(e[s]));var o=r(i);return o.length?' class="'+o+'"':""},n.attr=function(e,t,i,r){return"boolean"==typeof t||null==t?t?" "+(r?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof t?" "+e+"='"+JSON.stringify(t).replace(/'/g,"&apos;")+"'":i?" "+e+'="'+n.escape(t)+'"':" "+e+'="'+t+'"'},n.attrs=function(e,t){var i=[],s=Object.keys(e);if(s.length)for(var o=0;o<s.length;++o){var a=s[o],l=e[a];"class"==a?(l=r(l))&&i.push(" "+a+'="'+l+'"'):i.push(n.attr(a,l,!1,t))}return i.join("")},n.escape=function(e){var t=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return t===""+e?e:t},n.rethrow=function o(t,n,i,r){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&n||r))throw t.message+=" on line "+i,t;try{r=r||e("fs").readFileSync(n,"utf8")}catch(s){o(t,null,i)}var a=3,l=r.split("\n"),c=Math.max(i-a,0),u=Math.min(l.length,i+a),a=l.slice(c,u).map(function(e,t){var n=t+c+1;return(n==i?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+i+"\n"+a+"\n\n"+t.message,t}},{fs:2}],2:[function(){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],72:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),s=e("underscore"),r={Option:e("../models/facets/list.option.coffee")},i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.model=r.Option,t.prototype.initialize=function(){return this.comparator=this.strategies.amount_desc},t.prototype.revert=function(){return this.comparator=this.strategies.amount_desc,this.each(function(){return function(e){return e.set("checked",!1,{silent:!0})}}(this))},t.prototype.updateOptions=function(e){return null==e&&(e=[]),this.each(function(){return function(e){return e.set("count",0,{silent:!0})}}(this)),s.each(e,function(e){return function(t){var n;return n=e.get(t.name),null!=n?n.set("count",t.count,{silent:!0}):(n=new r.Option(t),e.add(n))}}(this)),this.sort()},t.prototype.strategies={alpha_asc:function(e){return+!e.get("visible")+(+!e.get("count")+e.get("name"))},alpha_desc:function(e){var t;return t=String.fromCharCode.apply(String,s.map(e.get("name").split(""),function(e){return 65535-e.charCodeAt()})),+!e.get("visible")+(+!e.get("count")+t)},amount_asc:function(e){var t,n;return n=e.get("visible")?0:10,n+=+!e.get("count"),t=e.get(0===e.get("count")?"total":"count"),n-=1/t},amount_desc:function(e){var t,n;return n=e.get("visible")?0:10,n+=+!e.get("count"),t=e.get(0===e.get("count")?"total":"count"),n+=1/t}},t.prototype.orderBy=function(e){return this.comparator=this.strategies[e],this.sort()},t.prototype.setAllVisible=function(){return this.each(function(e){return e.set("visible",!0)}),this.sort()},t}(n.Collection),t.exports=i},{"../models/facets/list.option.coffee":79,backbone:void 0,underscore:void 0}],73:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),o=e("underscore"),i=e("../models/searchresult"),s=e("funcky.req"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.model=i,t.prototype.initialize=function(e){return this.config=e.config,this.cachedModels={},this.queryAmount=0,this.on("add",this.setCurrent,this)},t.prototype.clearCache=function(){return this.cachedModels={}},t.prototype.setCurrent=function(e){var t,n;return this.current=e,t=null!=(null!=(n=this.current.options)?n.url:void 0)?"change:cursor":"change:results",this.trigger(t,this.current)},t.prototype.runQuery=function(e,t){var n,i;return null==t&&(t={}),null==t.cache&&(t.cache=!0),this.queryAmount=this.queryAmount+1,e.hasOwnProperty("resultRows")&&(i=e.resultRows,delete e.resultRows),n=JSON.stringify(e),t.cache&&this.cachedModels.hasOwnProperty(n)?this.setCurrent(this.cachedModels[n]):this.postQuery(e,function(e){return function(t){return e.getResults(t,function(t){return e.addModel(t,n)})}}(this))},t.prototype.addModel=function(e,t){return this.cachedModels[t]=new this.model(e),this.add(this.cachedModels[t])},t.prototype.moveCursor=function(e){var t;return t="_prev"===e||"_next"===e?this.current.get(e):e,null!=t?this.cachedModels.hasOwnProperty(t)?this.setCurrent(this.cachedModels[t]):this.getResults(t,function(e){return function(n){return e.addModel(n,t)}}(this)):void 0},t.prototype.page=function(e,t){var n,i;return n=this.config.get("resultRows")*(e-1),i=this.postURL+("?rows="+this.config.get("resultRows")+"&start="+n),null!=t&&(i+="&database="+t),this.getResults(i,function(e){return function(n){return e.trigger("change:page",new e.model(n),t)}}(this))},t.prototype.postQuery=function(e,t){var n,i;return this.trigger("request"),n={data:JSON.stringify(e)},this.config.has("requestOptions")&&o.extend(n,this.config.get("requestOptions")),i=s.post(this.config.get("baseUrl")+this.config.get("searchPath"),n),i.done(function(e){return function(n){var i;return 201===n.status?(e.postURL=n.getResponseHeader("Location"),i=e.config.has("resultRows")?e.postURL+"?rows="+e.config.get("resultRows"):e.postURL,t(i)):void 0}}(this)),i.fail(function(e){return function(t){if(401===t.status)return e.trigger("unauthorized");throw e.trigger("request:failed",t),new Error("Failed posting FacetedSearch queryOptions to the server!",t)}}(this))},t.prototype.getResults=function(e,t){var n;return this.trigger("request"),n=s.get(e),n.done(function(e){return function(n){return t(JSON.parse(n.responseText)),e.trigger("sync")}}(this)),n.fail(function(e){return function(t){if(401===t.status)return e.trigger("unauthorized");throw e.trigger("request:failed",t),new Error("Failed getting FacetedSearch results from the server!",t)}}(this))},t}(n.Collection),t.exports=r},{"../models/searchresult":84,backbone:void 0,"funcky.req":69,underscore:void 0}],74:[function(e,t){var n,i,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.defaults=function(){return{resultRows:null,baseUrl:"",searchPath:"",textSearch:"advanced",token:null,queryOptions:{},facetTitleMap:{},templates:{},autoSearch:!0}},t}(n.Model),t.exports=i},{backbone:void 0}],75:[function(e,t){var n,i,r,s,o,a,l,c,u,p,h={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var i in t)h.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),n=e("jquery"),i.$=n,p=e("underscore"),c=e("funcky.el").el,r=e("./config"),o=e("./models/query-options"),a=e("./collections/searchresults"),l={TextSearch:e("./views/text-search"),Facets:e("./views/facets")},u=e("../jade/main.jade"),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype.initialize=function(e){return null==e&&(e={}),null!=e.facetViewMap&&(this.facetViewMap=p.clone(e.facetViewMap),delete e.facetViewMap),this.extendConfig(e),this.initQueryOptions(),this.initSearchResults(),this.render(),this.config.get("development")?(this.searchResults.add(JSON.parse(localStorage.getItem("faceted-search-dev-model"))),this.searchResults.cachedModels['{"facetValues":[],"sortParameters":[]}']=this.searchResults.first(),setTimeout(function(e){return function(){return e.$(".overlay").hide()}}(this),100)):void 0},t.prototype.render=function(){return this.config.get("templates").hasOwnProperty("main")&&(u=this.config.get("templates").main),this.el.innerHTML=u(),this.$(".faceted-search").addClass("search-type-"+this.config.get("textSearch")),this.initFacets(this.facetViewMap),this},t.prototype.renderTextSearch=function(){var e;return this.textSearch=new l.TextSearch({config:this.config,fields:this.searchResults.current.get("fullTextSearchFields")}),e=this.el.querySelector(".text-search-placeholder"),null!=e&&e.parentNode.replaceChild(this.textSearch.el,e),this.listenTo(this.textSearch,"change",function(e){return function(t){return e.queryOptions.set(t,{silent:!0})}}(this)),this.listenTo(this.textSearch,"search",function(e){return function(){return e.search()}}(this))},t.prototype.events=function(){return{"click ul.facets-menu li.collapse-expand":function(e){return this.facets.toggle(e)},"click ul.facets-menu li.reset":"onReset","click ul.facets-menu li.switch button":"onSwitchType"}},t.prototype.onSwitchType=function(e){var t;return e.preventDefault(),t="advanced"===this.config.get("textSearch")?"simple":"advanced",this.config.set({textSearch:t}),this.$(".faceted-search").toggleClass("search-type-simple"),this.$(".faceted-search").toggleClass("search-type-advanced"),1===this.searchResults.queryAmount?this.search():this.searchResults.queryAmount>1?this.update():void 0},t.prototype.onReset=function(e){return e.preventDefault(),this.reset()},t.prototype.destroy=function(){return null!=this.facets&&this.facets.destroy(),null!=this.textSearch&&this.textSearch.destroy(),this.remove()},t.prototype.extendConfig=function(e){var t;return t=e.facetTitleMap,delete e.facetTitleMap,this.config=new r(e),this.config.set({facetTitleMap:p.extend(this.config.get("facetTitleMap"),t)}),-1===["none","simple","advanced"].indexOf(this.config.get("textSearch"))?this.config.set({textSearch:"advanced"}):void 0},t.prototype.initQueryOptions=function(){var e;return e=p.extend(this.config.get("queryOptions"),this.config.get("textSearchOptions")),this.queryOptions=new o(e),this.listenTo(this.queryOptions,"change",function(e){return function(){return e.trigger("change:queryoptions",e.queryOptions)}}(this)),this.config.get("autoSearch")?this.listenTo(this.queryOptions,"change",function(e){return function(){return e.search()}}(this)):void 0},t.prototype.initSearchResults=function(){return this.searchResults=new a({config:this.config}),this.listenTo(this.searchResults,"change:results",function(e){return function(t){return"simple"!==e.config.get("textSearch")&&e.update(),e.trigger("change:results",t)}}(this)),this.listenTo(this.searchResults,"change:cursor",function(e){return function(t){return e.trigger("change:results",t)}}(this)),this.listenTo(this.searchResults,"change:page",function(e){return function(t,n){return e.trigger("change:page",t,n)}}(this)),this.listenTo(this.searchResults,"request",function(e){return function(){return e.showLoader()}}(this)),this.listenTo(this.searchResults,"sync",function(e){return function(){return e.hideLoader()}}(this)),this.listenTo(this.searchResults,"unauthorized",function(e){return function(){return e.trigger("unauthorized")}}(this)),this.listenTo(this.searchResults,"request:failed",function(e){return function(t){return e.trigger("request:failed",t)}}(this))},t.prototype.initFacets=function(e){var t;return null==e&&(e={}),this.facets=new l.Facets({viewMap:e,config:this.config}),t=this.el.querySelector(".facets-placeholder"),t.parentNode.replaceChild(this.facets.el,t),this.listenTo(this.facets,"change",function(e){return function(t,n){return e.queryOptions.set(t,n)}}(this))},t.prototype.showLoader=function(){var e,t,n,i,r,s;return r=this.el.querySelector(".overlay"),"block"===r.style.display?!1:(i=r.children[0],e=this.el.querySelector(".faceted-search"),t=c(e).boundingBox(),r.style.width=t.width+"px",r.style.height=t.height+"px",r.style.display="block",n=t.left+t.width/2-12,i.style.left=n+"px",s=t.top+t.height/2-12,t.height>window.innerHeight&&(s="50vh"),i.style.top=s+"px")
},t.prototype.hideLoader=function(){return this.el.querySelector(".overlay").style.display="none"},t.prototype.update=function(){var e;return e=this.searchResults.current.get("facets"),1===this.searchResults.queryAmount?(this.renderTextSearch(),this.facets.renderFacets(e)):this.searchResults.queryAmount>1?this.facets.update(e):void 0},t.prototype.page=function(e,t){return this.searchResults.page(e,t)},t.prototype.next=function(){return this.searchResults.moveCursor("_next")},t.prototype.prev=function(){return this.searchResults.moveCursor("_prev")},t.prototype.hasNext=function(){return this.searchResults.current.has("_next")},t.prototype.hasPrev=function(){return this.searchResults.current.has("_prev")},t.prototype.sortResultsBy=function(e){return this.queryOptions.set({sortParameters:[{fieldname:e,direction:"asc"}]})},t.prototype.reset=function(e){return null==e&&(e=!1),null!=this.textSearch&&this.textSearch.reset(),this.facets.reset(),this.queryOptions.reset(),e||this.searchResults.clearCache(),this.search({cache:e})},t.prototype.getSearchResultURL=function(){return this.searchResults.postURL},t.prototype.xlsUrl=function(){return this.getSearchResultURL()+"/xls"},t.prototype.csvUrl=function(){return this.getSearchResultURL()+"/csv"},t.prototype.search=function(){return this.searchResults.runQuery(this.queryOptions.attributes)},t}(i.View),t.exports=s},{"../jade/main.jade":100,"./collections/searchresults":73,"./config":74,"./models/query-options":82,"./views/facets":85,"./views/text-search":92,backbone:void 0,"funcky.el":68,jquery:void 0,underscore:void 0}],76:[function(e,t){var n,i,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i={Facet:e("./main")},n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.set=function(e,n){return"options"===e?n=this.parseOptions(n):e.hasOwnProperty("options")&&(e.options=this.parseOptions(e.options)),t.__super__.set.call(this,e,n)},t.prototype.parseOptions=function(e){var t;return e=null!=(t=this.get("options"))?t:e,1===e.length&&e.push({name:(!JSON.parse(e[0].name)).toString(),count:0}),e},t}(i.Facet),t.exports=n},{"./main":80}],77:[function(){},{}],78:[function(e,t){var n,i,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i={Facet:e("./main")},n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t}(i.Facet),t.exports=n},{"./main":80}],79:[function(e,t){var n,i,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.idAttribute="name",t.prototype.defaults=function(){return{name:"",count:0,total:0,checked:!1,visible:!1}},t.prototype.parse=function(e){return e.total=e.count,e},t}(n.Model),t.exports=i},{backbone:void 0}],80:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("../../config"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.idAttribute="name",t.prototype.defaults=function(){return{name:null,title:null,type:null,options:null}},t}(n.Model),t.exports=i},{"../../config":74,backbone:void 0}],81:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("./main"),r=e("underscore"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.defaults=function(){return r.extend({},t.__super__.defaults.apply(this,arguments),{min:null,max:null,currentMin:null,currentMax:null})},t.prototype.set=function(e){return e.hasOwnProperty("currentMin")&&e.currentMin>this.get("currentMax")&&(e.currentMax=+e.currentMin,e.currentMin=this.get("currentMax")),e.hasOwnProperty("currentMax")&&e.currentMax<this.get("currentMin")&&(e.currentMin=+e.currentMax,e.currentMax=this.get("currentMin")),e.hasOwnProperty("currentMin")&&e.currentMin<this.get("min")&&(e.currentMin=this.get("min")),e.hasOwnProperty("currentMax")&&e.currentMax>this.get("max")&&(e.currentMax=this.get("max")),t.__super__.set.apply(this,arguments)},t.prototype.parse=function(e){return t.__super__.parse.apply(this,arguments),e.options={lowerLimit:+(e.options[0].lowerLimit+"").substr(0,4),upperLimit:+(e.options[0].upperLimit+"").substr(0,4)},e.min=e.currentMin=e.options.lowerLimit,e.max=e.currentMax=e.options.upperLimit,e},t}(n),t.exports=i},{"./main":80,underscore:void 0}],82:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),s=e("underscore"),r=e("../config"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.defaults=function(){return{facetValues:[],sortParameters:[]}},t.prototype.initialize=function(e){this.initialAttributes=e},t.prototype.set=function(e,n){var i;return null!=e.facetValue&&(i=s.reject(this.get("facetValues"),function(t){return t.name===e.facetValue.name}),null!=e.facetValue.values?e.facetValue.values.length>0&&i.push(e.facetValue):i.push(e.facetValue),e.facetValues=i,delete e.facetValue),t.__super__.set.call(this,e,n)},t.prototype.reset=function(){return this.clear({silent:!0}),this.set(this.defaults(),{silent:!0}),this.set(this.initialAttributes,{silent:!0})},t}(n.Model),t.exports=i},{"../config":74,backbone:void 0,underscore:void 0}],83:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),s=e("underscore"),r=function(e){var t,n,i,r,s,o;for(r='\\ + - & | ! ( ) { } [ ] ^ " ~ * ? :'.split(/\s+/),n=e,s=0,o=r.length;o>s;s++)t=r[s],t&&(i="\\"+t,console.log("Replacing "+t,RegExp(""+i,"g")),n=n.replace(RegExp(""+i,"g"),"\\"+t));return console.log(n),n},i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.defaults=function(){return{}},t.prototype.queryData=function(){var e,t,n,i;return e=s.extend({},this.attributes),t=function(){var t;t=[];for(n in e)i=e[n],t.push({name:n,term:"*"+r(i)+"*"});return t}(),{fullTextSearchParameters:t}},t}(n.Model),t.exports=i},{backbone:void 0,underscore:void 0}],84:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),s=e("underscore"),r=e("../config"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.defaults=function(){return{_next:null,_prev:null,ids:[],numFound:null,results:[],rows:null,solrquery:"",sortableFields:[],start:null,term:""}},t}(n.Model),t.exports=i},{"../config":74,backbone:void 0,underscore:void 0}],85:[function(e,t){var n,i,r,s=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("underscore"),i=function(t){function i(){return this.renderFacet=s(this.renderFacet,this),i.__super__.constructor.apply(this,arguments)}return a(i,t),i.prototype.className="facets",i.prototype.viewMap={BOOLEAN:e("./facets/boolean"),DATE:e("./facets/date"),RANGE:e("./facets/range"),LIST:e("./facets/list")},i.prototype.initialize=function(e){return r.extend(this.viewMap,e.viewMap),this.config=e.config,this.views={},this.render()},i.prototype.render=function(){return this.config.get("templates").hasOwnProperty("facets")&&(this.el.innerHTML=this.config.get("templates").facets()),this},i.prototype.renderFacets=function(e){var t,n,i,r,s,a;if(this.destroyFacets(),this.config.get("templates").hasOwnProperty("facets"))for(i=s=0,a=e.length;a>s;i=++s)t=e[i],this.viewMap.hasOwnProperty(t.type)&&(r=this.el.querySelector("."+t.name+"-placeholder"),null==r&&(r=this.el.querySelector("[data-name="+t.name+"]")),null!=r&&r.parentNode.replaceChild(this.renderFacet(t).el,r));else{n=document.createDocumentFragment();for(i in e)o.call(e,i)&&(t=e[i],this.viewMap.hasOwnProperty(t.type)?(n.appendChild(this.renderFacet(t).el),n.appendChild(document.createElement("hr"))):console.error("Unknown facetView",t.type));this.el.innerHTML="",this.el.appendChild(n)}return this},i.prototype.renderFacet=function(e){var t,n;return r.isString(e)&&(e=r.findWhere(this.searchResults.first().get("facets"),{name:e})),null!=(null!=(n=this.config.facetTitleMap)?n[e.name]:void 0)&&(e.title=this.config.facetTitleMap[e.name]),this.config.get("startCollapsed")&&(e.collapsed=!0),t=this.viewMap[e.type],this.views[e.name]=new t({attrs:e,config:this.config}),this.listenTo(this.views[e.name],"change",function(e){return function(t,n){return null==n&&(n={}),e.trigger("change",t,n)}}(this)),this.views[e.name]},i.prototype.update=function(e){var t,n,i,s,a,l;a=this.views,l=[];for(s in a)o.call(a,s)&&(i=a[s],t=r.findWhere(e,{name:s}),n=null!=t?t.options:[],l.push(i.update(n)));return l},i.prototype.reset=function(){var e,t,n,i;n=this.views,i=[];for(t in n)o.call(n,t)&&(e=n[t],i.push("function"==typeof e.reset?e.reset():void 0));return i},i.prototype.destroyFacets=function(){var e,t,n;this.stopListening(),n=this.views;for(t in n)o.call(n,t)&&(e=n[t],e.destroy(),delete this.views[t]);return this.render()},i.prototype.destroy=function(){return this.destroyFacets(),this.remove()},i.prototype.toggle=function(e){var t,i,s,o,a,l,c,u,p;return e.preventDefault(),t=n.$,s=t(e.currentTarget).find("i.fa"),c=t(e.currentTarget).find("span"),a=s.hasClass("fa-expand"),s.toggleClass("fa-compress"),s.toggleClass("fa-expand"),u=a?"Collapse":"Expand",c.text(""+u+" facets"),i=null!=(p=this.config.facets)?p:r.keys(this.views),o=0,(l=function(e){return function(){var t,n;return n=i[o++],t=e.views[n],null!=t?a?t.showBody(function(){return l()}):t.hideBody(function(){return l()}):void 0}}(this))()},i}(n.View),t.exports=i},{"./facets/boolean":86,"./facets/date":87,"./facets/list":88,"./facets/range":91,backbone:void 0,underscore:void 0}],86:[function(e,t){var n,i,r,s,o,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var i in t)l.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("jquery"),a=e("underscore"),r={Boolean:e("../../models/facets/boolean")},s={Facet:e("./main")},o=e("../../../jade/facets/boolean.body.jade"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.className="facet boolean",t.prototype.initialize=function(e){return t.__super__.initialize.apply(this,arguments),this.model=new r.Boolean(e.attrs,{parse:!0}),this.listenTo(this.model,"change:options",this.render),this.render()},t.prototype.render=function(){var e;return t.__super__.render.apply(this,arguments),e=o(a.extend(this.model.attributes,{ucfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}})),this.$(".body").html(e),this.$("header i.fa").remove(),this},t.prototype.events=function(){return a.extend({},t.__super__.events.apply(this,arguments),{"click i":"checkChanged","click label":"checkChanged"})},t.prototype.checkChanged=function(e){var t,i,r,s,o,l;for(t="LABEL"===e.currentTarget.tagName?this.$('i[data-value="'+e.currentTarget.getAttribute("data-value")+'"]'):n(e.currentTarget),t.toggleClass("fa-square-o"),t.toggleClass("fa-check-square-o"),r=t.attr("data-value"),l=this.model.get("options"),s=0,o=l.length;o>s;s++)i=l[s],i.name===r&&(i.checked=t.hasClass("fa-check-square-o"));return this.trigger("change",{facetValue:{name:this.model.get("name"),values:a.map(this.$("i.fa-check-square-o"),function(e){return e.getAttribute("data-value")})}})},t.prototype.update=function(e){return this.model.set("options",e)},t.prototype.reset=function(){return this.render()},t}(s.Facet),t.exports=i},{"../../../jade/facets/boolean.body.jade":93,"../../models/facets/boolean":76,"./main":90,jquery:void 0,underscore:void 0}],87:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i={Date:e("../../models/facets/date")},r={Facet:e("./main")},s=e("../../../jade/facets/date.jade"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.className="facet date",t.prototype.initialize=function(e){return t.__super__.initialize.apply(this,arguments),this.model=new i.Date(e.attrs,{parse:!0}),this.listenTo(this.model,"change:options",this.render),this.render()},t.prototype.render=function(){var e;return t.__super__.render.apply(this,arguments),e=s(_.extend(this.model.attributes,{ucfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}})),this.$(".placeholder").html(e),this},t.prototype.update=function(){},t.prototype.reset=function(){},t}(r.Facet),t.exports=n},{"../../../jade/facets/date.jade":94,"../../models/facets/date":77,"./main":90}],88:[function(e,t){var n,i,r,s,o,a,l,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("jquery"),l=e("underscore"),s={List:e("../../models/facets/list")},i={Options:e("../../collections/list.options")},o={Facet:e("./main"),Options:e("./list.options")},a=e("../../../jade/facets/list.menu.jade"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.className="facet list",t.prototype.initialize=function(e){return t.__super__.initialize.apply(this,arguments),this.config=e.config,this.model=new s.List(e.attrs,{parse:!0}),this.collection=new i.Options(e.attrs.options,{parse:!0}),this.render()},t.prototype.render=function(){var e;return t.__super__.render.apply(this,arguments),this.$("header .options").length>0&&(this.config.get("templates").hasOwnProperty("list.menu")&&(a=this.config.get("templates")["list.menu"]),e=a({model:this.model.attributes}),this.$("header .options").html(e)),this.optionsView=new o.Options({collection:this.collection,facetName:this.model.get("name"),config:this.config}),this.$(".body").html(this.optionsView.el),this.listenTo(this.optionsView,"filter:finished",this.renderFilteredOptionCount),this.listenTo(this.optionsView,"change",function(e){return function(t){return e.trigger("change",t)}}(this)),this.collection.length<=3&&this.$("header i.openclose").hide(),this},t.prototype.renderFilteredOptionCount=function(){var e,t,n,i;return n=this.collection.filter(function(e){return e.get("visible")}),t=0<(i=n.length)&&21>i?"visible":"hidden",this.$('input[type="checkbox"][name="all"]').css("visibility",t),e=this.collection.filter(function(e){return e.get("visible")}),0===e.length||e.length===this.collection.length?this.$('header .options input[name="filter"]').addClass("nonefound"):this.$('header .options input[name="filter"]').removeClass("nonefound"),this.$("header small.optioncount").html(e.length+" of "+this.collection.length),this},t.prototype.events=function(){return l.extend({},t.__super__.events.apply(this,arguments),{'keyup input[name="filter"]':function(e){return this.optionsView.filterOptions(e.currentTarget.value)},'change header .options input[type="checkbox"][name="all"]':function(e){return this.optionsView.setCheckboxes(e)},"click header .menu i.filter":"toggleFilterMenu","click header .menu i.alpha":"changeOrder","click header .menu i.amount":"changeOrder"})},t.prototype.toggleFilterMenu=function(){var e,t;return t=this.$("header .options"),e=this.$("i.filter"),e.toggleClass("active"),t.slideToggle(150,function(n){return function(){var i;return i=t.find('input[name="filter"]'),e.hasClass("active")?(i.focus(),n.optionsView.appendOptions(!0),n.renderFilteredOptionCount()):(i.val(""),n.collection.setAllVisible())}}(this))},t.prototype.changeOrder=function(e){var t,n,i;return t=Backbone.$(e.currentTarget),t.hasClass("active")?t.hasClass("alpha")?(t.toggleClass("fa-sort-alpha-desc"),t.toggleClass("fa-sort-alpha-asc")):t.hasClass("amount")&&(t.toggleClass("fa-sort-amount-desc"),t.toggleClass("fa-sort-amount-asc")):(this.$(".active").removeClass("active"),t.addClass("active")),i=t.hasClass("alpha")?"alpha":"amount",n=t.hasClass("fa-sort-"+i+"-desc")?"desc":"asc",this.collection.orderBy(i+"_"+n)},t.prototype.update=function(e){return this.collection.updateOptions(e)},t.prototype.reset=function(){return this.collection.revert()},t}(o.Facet),t.exports=r},{"../../../jade/facets/list.menu.jade":96,"../../collections/list.options":72,"../../models/facets/list":78,"./list.options":89,"./main":90,jquery:void 0,underscore:void 0}],89:[function(e,t){var n,i,r,s,o,a,l,c,u=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty,h=function(e,t){function n(){this.constructor=e}for(var i in t)p.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),n=e("jquery"),c=e("underscore"),a=e("funcky.util"),s={List:e("../../models/facets/list")},o=e("../../../jade/facets/list.body.jade"),l=e("../../../jade/facets/list.option.jade"),r=function(e){function t(){return this.triggerChange=u(this.triggerChange,this),t.__super__.constructor.apply(this,arguments)}return h(t,e),t.prototype.className="container",t.prototype.initialize=function(e){return this.config=e.config,this.facetName=e.facetName,this.showingCursor=0,this.showingIncrement=50,this.listenTo(this.collection,"sort",function(e){return function(){return e.rerender()}}(this)),this.config.get("templates").hasOwnProperty("list.option")&&(l=this.config.get("templates")["list.option"]),this.render()},t.prototype.render=function(){return this.config.get("templates").hasOwnProperty("list.body")&&(o=this.config.get("templates")["list.body"]),this.$el.html(o({facetName:this.facetName})),this.appendOptions(),this},t.prototype.rerender=function(){var e,t,n,i;for(n="",e=0,t=this.collection.at(e),i=null!=t?t.get("visible"):void 0;i;)n+=l({option:t}),e+=1,t=this.collection.at(e),i=null!=t&&t.get("visible")?!0:!1;return this.el.querySelector("ul").innerHTML=n},t.prototype.appendOptions=function(e){var t,n;for(null==e&&(e=!1),e&&(this.showingIncrement=this.collection.length),n="";this.showingCursor<this.showingIncrement&&this.showingCursor<this.collection.length;)t=this.collection.at(this.showingCursor),t.set("visible",!0),n+=l({option:t}),this.showingCursor=this.showingCursor+1;return this.$("ul").append(n)},t.prototype.renderAll=function(){return this.collection.setAllVisible()},t.prototype.events=function(){return{"click li":"checkChanged",scroll:"onScroll"}},t.prototype.onScroll=function(e){var t,n;return this.showingCursor<this.collection.length&&(t=e.currentTarget,n=t.scrollTop/t.scrollHeight,n>this.showingCursor/2/this.collection.length)?(this.showingIncrement+=this.showingIncrement,this.appendOptions()):void 0},t.prototype.checkChanged=function(e){var t,i,r;return t=n(e.currentTarget),i=t.attr("data-value"),r="checked"===t.attr("data-state"),t.attr("data-state",r?"unchecked":"checked"),r="checked"===t.attr("data-state"),this.collection.get(i).set("checked",r),"unchecked"!==t.attr("data-state")&&this.config.get("autoSearch")?a.setResetTimeout(1e3,function(e){return function(){return e.triggerChange()}}(this)):this.triggerChange()},t.prototype.triggerChange=function(e){var t;return null==e&&(t=this.collection.filter(function(e){return e.get("checked")}),e=c.map(t,function(e){return e.get("name")})),this.trigger("change",{facetValue:{name:this.facetName,values:e}})},t.prototype.filterOptions=function(e){return this.collection.map(function(t){var n;return n=new RegExp(e,"i"),t.set("visible",n.test(t.id))}),this.collection.sort(),this.trigger("filter:finished")},t.prototype.setCheckboxes=function(e){var t,n,i,r,s;for(i=this.collection.filter(function(e){return e.get("visible")}),r=0,s=i.length;s>r;r++)t=i[r],t.set("checked",e.currentTarget.checked);return e.currentTarget.checked?(n=c.map(i,function(e){return e.get("name")}),this.triggerChange(n)):this.triggerChange()},t}(i.View),t.exports=r},{"../../../jade/facets/list.body.jade":95,"../../../jade/facets/list.option.jade":97,"../../models/facets/list":78,backbone:void 0,"funcky.util":70,jquery:void 0,underscore:void 0}],90:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),n=e("jquery"),o=e("underscore"),s=e("../../../jade/facets/main.jade"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.renderedBefore=!1,t.prototype.initialize=function(e){return this.config=e.config,this.config.get("facetTitleMap").hasOwnProperty(e.attrs.name)?e.attrs.title=this.config.get("facetTitleMap")[e.attrs.name]:void 0},t.prototype.render=function(){return this.config.get("templates").hasOwnProperty("facets.main")&&(s=this.config.get("templates")["facets.main"]),this.$el.html(s(this.model.attributes)),this.model.get("collapsed")&&!this.renderedBefore&&this.hideBody(),this.renderedBefore=!0,this.$el.attr("data-name",this.model.get("name")),this},t.prototype.events=function(){return{"click h3":"toggleBody"}},t.prototype.toggleBody=function(e){var t;return t=this.$el.hasClass("collapsed")?this.showBody:this.hideBody,o.isFunction(e)?t.call(this,e):t.call(this)},t.prototype.hideMenu=function(){var e;return e=this.$("header i.openclose"),e.addClass("fa-plus-square-o"),e.removeClass("fa-minus-square-o"),this.$("header .options").slideUp(150)},t.prototype.hideBody=function(e){return this.hideMenu(),this.$(".body").one("transitionend",function(){return null!=e?e():void 0}),this.$el.addClass("collapsed")},t.prototype.showBody=function(e){return this.$el.removeClass("collapsed"),this.$(".body").one("transitionend",function(){return null!=e?e():void 0})},t.prototype.destroy=function(){return this.remove()},t.prototype.update=function(){},t.prototype.reset=function(){},t}(i.View),t.exports=r},{"../../../jade/facets/main.jade":98,backbone:void 0,jquery:void 0,underscore:void 0}],91:[function(e,t){var n,i,r,s,o,a,l,c,u={}.hasOwnProperty,p=function(e,t){function n(){this.constructor=e}for(var i in t)u.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("jquery"),c=e("underscore"),i={Range:e("../../models/facets/range")},s={Facet:e("./main")},o=e("../../../jade/facets/range.body.jade"),a=null,l=null,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.className="facet range",t.prototype.initialize=function(e){return t.__super__.initialize.apply(this,arguments),this.config=e.config,this.draggingMin=!1,this.draggingMax=!1,this.model=new i.Range(e.attrs,{parse:!0}),this.listenTo(this.model,"change:options",this.render),this.listenTo(this.model,"change",function(e){return function(t){return t.changed.hasOwnProperty("currentMin")||t.changed.hasOwnProperty("currentMax")?e.checkInputOverlap():void 0}}(this)),this.listenTo(this.model,"change:currentMin",this.updateMinHandle),this.listenTo(this.model,"change:currentMax",this.updateMaxHandle),this.render()},t.prototype.render=function(){var e;return t.__super__.render.apply(this,arguments),this.config.get("templates").hasOwnProperty("range.body")&&(o=this.config.get("templates")["range.body"]),e=o(this.model.attributes),this.$(".body").html(e),this.$("header .menu").hide(),a=this.stopDragging.bind(this),this.$el.on("mouseleave",a),l=this.onResize.bind(this),window.addEventListener("resize",l),setTimeout(function(e){return function(){return e.postRender()}}(this),0),this},t.prototype.postRender=function(){return this.slider=this.$(".slider"),this.sliderWidth=this.slider.width(),this.sliderLeft=this.slider.offset().left,this.handleMin=this.$(".handle-min"),this.handleMax=this.$(".handle-max"),this.handleWidth=this.handleMin.width(),this.handleMinLeft=this.handleMin.position().left,this.handleMaxLeft=this.handleMax.position().left,this.inputMin=this.$("input.min"),this.inputMax=this.$("input.max"),this.bar=this.$(".bar"),this.button=this.el.querySelector("button")},t.prototype.events=function(){return c.extend({},t.__super__.events.apply(this,arguments),{"mousedown .handle":"startDragging","mousedown .bar":"startDragging",mouseup:"stopDragging",mousemove:"drag","blur input":"setYear","keyup input":"setYear","click button":"doSearch"})},t.prototype.setYear=function(e){if("focusout"===e.type||"blur"===e.type||"keyup"===e.type&&13===e.keyCode){if(e.currentTarget.className.indexOf("min")>-1)return this.model.set({currentMin:+e.currentTarget.value}),this.disableInputEditable(this.inputMin);if(e.currentTarget.className.indexOf("max")>-1)return this.model.set({currentMax:+e.currentTarget.value}),this.disableInputEditable(this.inputMax)}},t.prototype.doSearch=function(e){return e.preventDefault(),this.triggerChange()},t.prototype.startDragging=function(e){var t,i;return i=n(e.currentTarget),t=i.find("input"),t.length>0&&null==t.attr("disabled")?void 0:i.hasClass("handle-min")?(this.draggingMin=!0,this.handleMax.css("z-index",10),i.css("z-index",11)):i.hasClass("handle-max")?(this.draggingMax=!0,this.handleMin.css("z-index",10),i.css("z-index",11)):i.hasClass("bar")?this.draggingBar={offsetLeft:e.clientX-this.sliderLeft-this.handleMinLeft,barWidth:this.bar.width()}:void 0},t.prototype.drag=function(e){var t,n,i;return i=e.clientX-this.sliderLeft,(this.draggingMin||this.draggingMax)&&this.disableInputOverlap(),n=function(e){return function(t){return t>-1&&t<=e.handleMaxLeft?(e.handleMinLeft=t,e.handleMin.css("left",t),e.bar.css("left",t),e.updateDash(),e.updateHandleLabel("min",t)):void 0}}(this),t=function(e){return function(t){return e.handleMinLeft<t&&t<=e.sliderWidth?(e.handleMaxLeft=t,e.handleMax.css("left",t),e.bar.css("right",e.sliderWidth-t),e.updateHandleLabel("max",t)):void 0}}(this),null!=this.draggingBar&&this.handleMinLeft+this.draggingBar.barWidth<=this.sliderWidth&&(n(i-this.draggingBar.offsetLeft),t(this.handleMinLeft+this.draggingBar.barWidth)),this.draggingMin&&n(i-this.handleWidth/2),this.draggingMax?t(i-this.handleWidth/2):void 0},t.prototype.enableInputEditable=function(e){return e.attr("disabled",null),e.focus()},t.prototype.disableInputEditable=function(e){return e.attr("disabled",!0)},t.prototype.enableInputOverlap=function(e){return this.inputMin.css("left",-20-e/2),this.inputMax.css("right",-20-e/2),this.updateDash(),this.$(".dash").show(),this.inputMin.addClass("overlap"),this.inputMax.addClass("overlap")},t.prototype.updateDash=function(){return this.$(".dash").css("left",this.handleMinLeft+(this.handleMaxLeft-this.handleMinLeft)/2+3)},t.prototype.disableInputOverlap=function(){return this.inputMin.css("left",-20),this.inputMax.css("right",-20),this.$(".dash").hide(),this.inputMin.removeClass("overlap"),this.inputMax.removeClass("overlap")},t.prototype.stopDragging=function(){return!this.draggingMin&&!this.draggingMax&&null==this.draggingBar||(this.draggingMin&&(this.model.get("currentMin")!==+this.inputMin.val()?this.model.set({currentMin:+this.inputMin.val()}):this.enableInputEditable(this.inputMin)),this.draggingMax&&(this.model.get("currentMax")!==+this.inputMax.val()?this.model.set({currentMax:+this.inputMax.val()}):this.enableInputEditable(this.inputMax)),this.draggingMin=!1,this.draggingMax=!1,this.draggingBar=null,this.config.get("autoSearch"))?void 0:this.triggerChange({silent:!0})},t.prototype.destroy=function(){return this.$el.off("mouseleave",a),window.removeEventListener("resize",l),this.remove()},t.prototype.triggerChange=function(e){var t;return null==e&&(e={}),t={facetValue:{name:this.model.get("name"),lowerLimit:this.model.get("currentMin")+"0101",upperLimit:this.model.get("currentMax")+"1231"}},this.trigger("change",t,e)},t.prototype.onResize=function(){return this.postRender(),this.update({lowerLimit:this.model.get("currentMin"),upperLimit:this.model.get("currentMax")}),this.checkInputOverlap()},t.prototype.checkInputOverlap=function(){var e,t,n;return n=this.inputMin[0].getBoundingClientRect(),t=this.inputMax[0].getBoundingClientRect(),n.right<t.left||n.left>t.right||n.bottom<t.top||n.top>t.bottom?this.disableInputOverlap():(e=n.right-t.left,this.enableInputOverlap(e))},t.prototype.updateHandleLabel=function(e,t){var n;return null!=this.button&&this.config.get("autoSearch")&&(this.button.style.display="block"),n="min"===e?this.inputMin:this.inputMax,n.val(this.getYearFromLeftPos(t))},t.prototype.getYearFromLeftPos=function(e){var t,n;return t=this.model.get("options").lowerLimit,n=this.model.get("options").upperLimit,Math.floor(t+e/this.sliderWidth*(n-t))},t.prototype.getLeftPosFromYear=function(e){var t,n,i;return n=this.model.get("options").lowerLimit,i=this.model.get("options").upperLimit,t=(e-n)/(i-n)*this.sliderWidth,Math.floor(t)},t.prototype.update=function(e){return c.isArray(e)&&(e=null!=e[0]?e[0]:{lowerLimit:this.model.get("options").lowerLimit,upperLimit:this.model.get("options").upperLimit}),this.model.set({currentMin:+(e.lowerLimit+"").substr(0,4),currentMax:+(e.upperLimit+"").substr(0,4)}),null!=this.button?this.button.style.display="none":void 0},t.prototype.updateMaxHandle=function(e){var t,n;return n=e.get("currentMax"),this.inputMax.val(n),t=this.getLeftPosFromYear(n),this.handleMax.css("left",t-this.handleWidth/2),this.bar.css("right",this.sliderWidth-t),this.handleMaxLeft=t-this.handleWidth/2},t.prototype.updateMinHandle=function(e){var t,n;return n=e.get("currentMin"),this.inputMin.val(n),t=this.getLeftPosFromYear(n),this.handleMin.css("left",t-this.handleWidth/2),this.bar.css("left",t),this.handleMinLeft=t-this.handleWidth/2},t}(s.Facet),t.exports=r},{"../../../jade/facets/range.body.jade":99,"../../models/facets/range":81,"./main":90,jquery:void 0,underscore:void 0}],92:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),o=e("underscore"),i={Search:e("../models/search")},s=e("../../jade/text-search.jade"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.className="text-search",t.prototype.initialize=function(e){return this.config=e.config,this.fields=e.fields,this.reset()},t.prototype.setModel=function(){return null!=this.model&&this.stopListening(this.model),this.model=new i.Search(this.config.get("textSearchOptions"))},t.prototype.render=function(){return this.config.has("templates").hasOwnProperty("text-search")&&(s=this.config.get("templates")["text-search"]),this.$el.html(s({model:this.model,fields:this.fields,textSearchTitles:this.config.get("textSearchTitleMap")||{}})),this},t.prototype.events=function(){return{"click i.fa-search":"search",'keyup input[name="search"]':"onKeyUp",'focus input[name="search"]':function(){return this.$(".body .menu").slideDown(150)},"click .menu .fa-times":function(){return this.$(".body .menu").slideUp(150)
},'change input[type="checkbox"]':"checkboxChanged"}},t.prototype.onKeyUp=function(e){var t,n;return 13===e.keyCode?(e.preventDefault(),this.search(e)):(n=e.currentTarget.getAttribute("data-field"),t=this.model.get(n)!==e.currentTarget.value,t&&this.model.set(n,e.currentTarget.value),this.updateQueryModel(),this.$("button.search").toggleClass("changed",t))},t.prototype.search=function(e){return e.preventDefault(),this.trigger("search")},t.prototype.updateQueryModel=function(){return this.trigger("change",this.model.queryData())},t.prototype.reset=function(){return this.setModel(),this.render()},t.prototype.destroy=function(){return this.remove()},t}(n.View),t.exports=r},{"../../jade/text-search.jade":101,"../models/search":83,backbone:void 0,underscore:void 0}],93:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r){i.push("<ul>"),function(){var s=e;if("number"==typeof s.length)for(var o=0,a=s.length;a>o;o++){var l=s[o];i.push('<li><div class="row span6"><div class="cell span5"><i'+n.attr("data-value",l.name,!0,!1)+n.cls([l.checked?"fa fa-check-square-o":"fa fa-square-o"],[!0])+"></i><label"+n.attr("data-value",l.name,!0,!1)+">"+n.escape(null==(t=r(l.name))?"":t)+'</label></div><div class="cell span1 alignright"><div class="count">'+n.escape(null==(t=l.count)?"":t)+"</div></div></div></li>")}else{var a=0;for(var o in s){a++;var l=s[o];i.push('<li><div class="row span6"><div class="cell span5"><i'+n.attr("data-value",l.name,!0,!1)+n.cls([l.checked?"fa fa-check-square-o":"fa fa-square-o"],[!0])+"></i><label"+n.attr("data-value",l.name,!0,!1)+">"+n.escape(null==(t=r(l.name))?"":t)+'</label></div><div class="cell span1 alignright"><div class="count">'+n.escape(null==(t=l.count)?"":t)+"</div></div></div></li>")}}}.call(this),i.push("</ul>")}("options"in r?r.options:"undefined"!=typeof options?options:void 0,"ucfirst"in r?r.ucfirst:"undefined"!=typeof ucfirst?ucfirst:void 0),i.join("")}},{"jade/runtime":71}],94:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r,s){i.push("<header><h3"+n.attr("data-name",e,!0,!1)+">"+n.escape(null==(t=r)?"":t)+'</h3></header><div class="body"><label>From:</label><select>'),function(){var e=s;if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var a=e[r];i.push("<option>"+n.escape(null==(t=a)?"":t)+"</option>")}else{var o=0;for(var r in e){o++;var a=e[r];i.push("<option>"+n.escape(null==(t=a)?"":t)+"</option>")}}}.call(this),i.push("</select><label>To:</label><select>"),function(){var e=s.reverse();if("number"==typeof e.length)for(var r=0,o=e.length;o>r;r++){var a=e[r];i.push("<option>"+n.escape(null==(t=a)?"":t)+"</option>")}else{var o=0;for(var r in e){o++;var a=e[r];i.push("<option>"+n.escape(null==(t=a)?"":t)+"</option>")}}}.call(this),i.push("</select></div>")}("name"in r?r.name:"undefined"!=typeof name?name:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0,"options"in r?r.options:"undefined"!=typeof options?options:void 0),i.join("")}},{"jade/runtime":71}],95:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push("<ul></ul>"),e.join("")}},{"jade/runtime":71}],96:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<input type="checkbox" name="all"/><input type="text" name="filter" placeholder="Filter options..."/><small class="optioncount"></small>'),e.join("")}},{"jade/runtime":71}],97:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push("<li"+n.attr("data-count",e.get("count"),!0,!1)+n.attr("data-value",e.id,!0,!1)+n.attr("data-state",e.get("checked")?"checked":"unchecked",!0,!1)+"><i"+n.attr("data-value",e.id,!0,!1)+n.cls(["unchecked","fa","fa-square-o",e.get("checked")?"hidden":"visible"],[null,null,null,!0])+"></i><i"+n.attr("data-value",e.id,!0,!1)+n.cls(["checked","fa","fa-check-square-o",e.get("checked")?"visible":"hidden"],[null,null,null,!0])+"></i><label"+n.attr("data-value",e.id,!0,!1)+">"+(null==(t=":empty"===e.id?"<em>(empty)</em>":e.id)?"":t)+'</label><div class="count">'+n.escape(null==(t=e.get(0===e.get("count")?"total":"count"))?"":t)+"</div></li>")}("option"in r?r.option:"undefined"!=typeof option?option:void 0),i.join("")}},{"jade/runtime":71}],98:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e){i.push("<header><h3>"+n.escape(null==(t=e)?"":t)+'</h3><div class="menu"><i title="Filter options" class="filter fa fa-filter"></i><i title="Sort alphabetically" class="alpha fa fa-sort-alpha-asc"></i><i title="Sort numerically" class="amount active fa fa-sort-amount-desc"></i></div><div class="options"></div></header><div class="body"></div>')}("title"in r?r.title:"undefined"!=typeof title?title:void 0),i.join("")}},{"jade/runtime":71}],99:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{};return function(e){t.push('<div class="slider"><span class="dash">-</span><div class="handle-min handle"><input'+n.attr("value",e.lowerLimit,!0,!1)+' disabled="disabled" class="min"/></div><div class="handle-max handle"><input'+n.attr("value",e.upperLimit,!0,!1)+' disabled="disabled" class="max"/></div><div class="bar">&nbsp;</div><button>Search?</button></div>')}("options"in i?i.options:"undefined"!=typeof options?options:void 0),t.join("")}},{"jade/runtime":71}],100:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="overlay"><div><i class="fa fa-spinner fa-spin fa-2x"></i></div></div><div class="faceted-search"><div class="text-search-placeholder"></div><ul class="facets-menu"><li class="reset"><button><i class="fa fa-refresh"></i><span>Reset search</span></button></li><li class="switch"><button><i class="fa fa-angle-double-down"></i><span>Switch to</span></button></li><li class="collapse-expand"><button><i class="fa fa-compress"></i><span>Collapse facets</span></button></li></ul><div class="facets-placeholder"></div></div>'),e.join("")}},{"jade/runtime":71}],101:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t,i=[],r=e||{};return function(e,r){i.push('<div class="placeholder"><header><h3>Text search</h3><button class="search"><i class="fa fa-search"></i></button></header>'),function(){var s=e;if("number"==typeof s.length)for(var o=0,a=s.length;a>o;o++){var l=s[o];i.push("<div"+n.attr("data-name",l,!0,!1)+' class="search-input"><h4>'+n.escape(null==(t=r[l])?"":t)+'</h4><input type="text" name="search"'+n.attr("data-field",l,!0,!1)+"/></div>")}else{var a=0;for(var o in s){a++;var l=s[o];i.push("<div"+n.attr("data-name",l,!0,!1)+' class="search-input"><h4>'+n.escape(null==(t=r[l])?"":t)+'</h4><input type="text" name="search"'+n.attr("data-field",l,!0,!1)+"/></div>")}}}.call(this),i.push("</div>")}("fields"in r?r.fields:"undefined"!=typeof fields?fields:void 0,"textSearchTitles"in r?r.textSearchTitles:"undefined"!=typeof textSearchTitles?textSearchTitles:void 0),i.join("")}},{"jade/runtime":71}],102:[function(e,t,n){!function(i,r,s){var o=r.templateSettings;r.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g};var a=r.template('    <% if (title) { %>      <div class="modal-header">        <% if (allowCancel) { %>          <a class="close">×</a>        <% } %>        <h3>{{title}}</h3>      </div>    <% } %>    <div class="modal-body">{{content}}</div>    <div class="modal-footer">      <% if (allowCancel) { %>        <% if (cancelText) { %>          <a href="#" class="btn cancel">{{cancelText}}</a>        <% } %>      <% } %>      <a href="#" class="btn ok btn-primary">{{okText}}</a>    </div>  ');r.templateSettings=o;var l=s.View.extend({className:"modal",events:{"click .close":function(e){e.preventDefault(),this.trigger("cancel")},"click .cancel":function(e){e.preventDefault(),this.trigger("cancel")},"click .ok":function(e){e.preventDefault(),this.trigger("ok"),this.close()}},initialize:function(e){this.options=r.extend({title:null,okText:"OK",cancelText:"Cancel",allowCancel:!0,escape:!0,animate:!1,template:a},e)},render:function(){var e=this.$el,t=this.options,n=t.content;e.html(t.template(t));this.$content=e.find(".modal-body");return n.$el&&e.find(".modal-body").html(n.render().$el),t.animate&&e.addClass("fade"),this.isRendered=!0,this},open:function(e){this.isRendered||this.render();var t=this,n=this.$el;n.modal({keyboard:this.options.allowCancel,backdrop:this.options.allowCancel?!0:"static"}),n.one("shown",function(){n.find(".btn.ok").focus(),t.trigger("shown")});var r=l.count,s=i(".modal-backdrop:eq("+r+")"),o=s.css("z-index"),a=s.css("z-index");return s.css("z-index",o+r),this.$el.css("z-index",a+r),this.options.allowCancel&&(s.one("click",function(){t.trigger("cancel")}),i(document).one("keyup.dismiss.modal",function(e){27==e.which&&t.trigger("cancel")})),this.on("cancel",function(){t.close()}),l.count++,e&&t.on("ok",e),this},close:function(){var e=this,t=this.$el;return this._preventClose?void(this._preventClose=!1):(t.modal("hide"),t.one("hidden",function(){e.remove(),e.trigger("hidden")}),void l.count--)},preventClose:function(){this._preventClose=!0}},{count:0});return"function"==typeof e&&"undefined"!=typeof t&&n&&(t.exports=l),"function"==typeof define&&define.amd?define(function(){s.BootstrapModal=l}):void(s.BootstrapModal=l)}(jQuery,_,Backbone)},{}],103:[function(e,t,n){(function(i){!function(i){if("undefined"!=typeof n&&"undefined"!=typeof e){var r=i.jQuery||i.Zepto||i.ender||e("jquery"),s=i._||e("underscore"),o=i.Backbone||e("backbone");o.$=r}else var r=i.jQuery,s=i._,o=i.Backbone;var a=o.View.extend({events:{submit:function(e){this.trigger("submit",e)}},initialize:function(e){var t=this;e=e||{};var n=this.schema=function(){if(e.schema)return s.result(e,"schema");var n=e.model;return n&&n.schema?s.result(n,"schema"):t.schema?s.result(t,"schema"):{}}();s.extend(this,s.pick(e,"model","data","idPrefix","templateData"));var i=this.constructor;this.template=e.template||this.template||i.template,this.Fieldset=e.Fieldset||this.Fieldset||i.Fieldset,this.Field=e.Field||this.Field||i.Field,this.NestedField=e.NestedField||this.NestedField||i.NestedField;var r=this.selectedFields=e.fields||s.keys(n),o=this.fields={};s.each(r,function(e){var t=n[e];o[e]=this.createField(e,t)},this);{var a=e.fieldsets||s.result(this,"fieldsets")||[r];this.fieldsets=[]}s.each(a,function(e){this.fieldsets.push(this.createFieldset(e))},this)},createFieldset:function(e){var t={schema:e,fields:this.fields};return new this.Fieldset(t)},createField:function(e,t){var n={form:this,key:e,schema:t,idPrefix:this.idPrefix};this.model?n.model=this.model:n.value=this.data?this.data[e]:null;var i=new this.Field(n);return this.listenTo(i.editor,"all",this.handleEditorEvent),i},handleEditorEvent:function(e,t){var n=t.key+":"+e;switch(this.trigger.call(this,n,this,t,Array.prototype.slice.call(arguments,2)),e){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":if(this.hasFocus){var i=this;setTimeout(function(){var e=s.find(i.fields,function(e){return e.editor.hasFocus});e||i.trigger("blur",i)},0)}}},render:function(){var e=this,t=this.fields,n=r(r.trim(this.template(s.result(this,"templateData"))));return n.find("[data-editors]").add(n).each(function(n,i){var o=r(i),a=o.attr("data-editors");if(!s.isUndefined(a)){var l="*"==a?e.selectedFields||s.keys(t):a.split(",");s.each(l,function(e){var n=t[e];o.append(n.editor.render().el)})}}),n.find("[data-fields]").add(n).each(function(n,i){var o=r(i),a=o.attr("data-fields");if(!s.isUndefined(a)){var l="*"==a?e.selectedFields||s.keys(t):a.split(",");s.each(l,function(e){var n=t[e];o.append(n.render().el)})}}),n.find("[data-fieldsets]").add(n).each(function(t,n){var i=r(n),o=i.attr("data-fieldsets");s.isUndefined(o)||s.each(e.fieldsets,function(e){i.append(e.render().el)})}),this.setElement(n),n.addClass(this.className),this},validate:function(e){var t=this.fields,n=this.model,i={};if(e=e||{},s.each(t,function(e){var t=e.validate();t&&(i[e.key]=t)}),!e.skipModelValidate&&n&&n.validate){var r=n.validate(this.getValue());if(r){var o=s.isObject(r)&&!s.isArray(r);o||(i._others=i._others||[],i._others.push(r)),o&&s.each(r,function(e,n){if(t[n]&&!i[n])t[n].setError(e),i[n]=e;else{i._others=i._others||[];var r={};r[n]=e,i._others.push(r)}})}}return s.isEmpty(i)?null:i},commit:function(e){e=e||{};var t={skipModelValidate:!e.validate},n=this.validate(t);if(n)return n;var i,r=s.extend({error:function(e,t){i=t}},e);return this.model.set(this.getValue(),r),i?i:void 0},getValue:function(e){if(e)return this.fields[e].getValue();var t={};return s.each(this.fields,function(e){t[e.key]=e.getValue()}),t},setValue:function(e,t){var n={};"string"==typeof e?n[e]=t:n=e;var i;for(i in this.schema)void 0!==n[i]&&this.fields[i].setValue(n[i])},getEditor:function(e){var t=this.fields[e];if(!t)throw new Error("Field not found: "+e);return t.editor},focus:function(){if(!this.hasFocus){var e=this.fieldsets[0],t=e.getFieldAt(0);t&&t.editor.focus()}},blur:function(){if(this.hasFocus){var e=s.find(this.fields,function(e){return e.editor.hasFocus});e&&e.editor.blur()}},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),o.View.prototype.trigger.apply(this,arguments)},remove:function(){return s.each(this.fieldsets,function(e){e.remove()}),s.each(this.fields,function(e){e.remove()}),o.View.prototype.remove.apply(this,arguments)}},{template:s.template("    <form data-fieldsets></form>  ",null,this.templateSettings),templateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},editors:{}});a.validators=function(){var e={};return e.errMessages={required:"Required",regexp:"Invalid",number:"Must be a number",email:"Invalid email address",url:"Invalid URL",match:s.template('Must match field "<%= field %>"',null,a.templateSettings)},e.required=function(e){return e=s.extend({type:"required",message:this.errMessages.required},e),function(t){e.value=t;var n={type:e.type,message:s.isFunction(e.message)?e.message(e):e.message};return null===t||void 0===t||t===!1||""===t?n:void 0}},e.regexp=function(e){if(!e.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return e=s.extend({type:"regexp",match:!0,message:this.errMessages.regexp},e),function(t){e.value=t;var n={type:e.type,message:s.isFunction(e.message)?e.message(e):e.message};if(null!==t&&void 0!==t&&""!==t)return"string"==typeof e.regexp&&(e.regexp=new RegExp(e.regexp,e.flags)),(e.match?!e.regexp.test(t):e.regexp.test(t))?n:void 0}},e.number=function(t){return t=s.extend({type:"number",message:this.errMessages.number,regexp:/^[0-9]*\.?[0-9]*?$/},t),e.regexp(t)},e.email=function(t){return t=s.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},t),e.regexp(t)},e.url=function(t){return t=s.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},t),e.regexp(t)},e.match=function(e){if(!e.field)throw new Error('Missing required "field" options for "match" validator');return e=s.extend({type:"match",message:this.errMessages.match},e),function(t,n){e.value=t;var i={type:e.type,message:s.isFunction(e.message)?e.message(e):e.message};if(null!==t&&void 0!==t&&""!==t)return t!==n[e.field]?i:void 0}},e}(),a.Fieldset=o.View.extend({initialize:function(e){e=e||{};var t=this.schema=this.createSchema(e.schema);this.fields=s.pick(e.fields,t.fields),this.template=e.template||t.template||this.template||this.constructor.template},createSchema:function(e){return s.isArray(e)&&(e={fields:e}),e.legend=e.legend||null,e},getFieldAt:function(e){var t=this.schema.fields[e];return this.fields[t]},templateData:function(){return this.schema},render:function(){var e=(this.schema,this.fields),t=r(r.trim(this.template(s.result(this,"templateData"))));return t.find("[data-fields]").add(t).each(function(t,n){var i=r(n),o=i.attr("data-fields");s.isUndefined(o)||s.each(e,function(e){i.append(e.render().el)})}),this.setElement(t),this},remove:function(){s.each(this.fields,function(e){e.remove()}),o.View.prototype.remove.call(this)}},{template:s.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,a.templateSettings)}),a.Field=o.View.extend({initialize:function(e){e=e||{},s.extend(this,s.pick(e,"form","key","model","value","idPrefix"));var t=this.schema=this.createSchema(e.schema);this.template=e.template||t.template||this.template||this.constructor.template,this.errorClassName=e.errorClassName||this.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(e){return s.isString(e)&&(e={type:e}),e=s.extend({type:"Text",title:this.createTitle()},e),e.type=s.isString(e.type)?a.editors[e.type]:e.type,e},createEditor:function(){var e=s.extend(s.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()}),t=this.schema.type;return new t(e)},createEditorId:function(){var e=this.idPrefix,t=this.key;return t=t.replace(/\./g,"_"),s.isString(e)||s.isNumber(e)?e+t:s.isNull(e)?t:this.model?this.model.cid+"_"+t:t},createTitle:function(){var e=this.key;return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()})},templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var e=this.schema,t=this.editor;if(e.type==a.editors.Hidden)return this.setElement(t.render().el);var n=r(r.trim(this.template(s.result(this,"templateData"))));return e.fieldClass&&n.addClass(e.fieldClass),e.fieldAttrs&&n.attr(e.fieldAttrs),n.find("[data-editor]").add(n).each(function(e,n){var i=r(n),o=i.attr("data-editor");s.isUndefined(o)||i.append(t.render().el)}),this.setElement(n),this},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(e){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this.$("[data-error]").html(e))},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),o.View.prototype.remove.call(this)}},{template:s.template('    <div>      <label for="<%= editorId %>"><%= title %></label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,a.templateSettings),errorClassName:"error"}),a.NestedField=a.Field.extend({template:s.template(r.trim("    <div>      <span data-editor></span>      <% if (help) { %>        <div><%= help %></div>      <% } %>      <div data-error></div>    </div>  "),null,a.templateSettings)}),a.Editor=a.editors.Base=o.View.extend({defaultValue:null,hasFocus:!1,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw new Error("Missing option: 'key'");this.model=e.model,this.value=this.model.get(e.key)}else void 0!==e.value&&(this.value=e.value);void 0===this.value&&(this.value=this.defaultValue),s.extend(this,s.pick(e,"key","form"));var t=this.schema=e.schema||{};this.validators=e.validators||t.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),t.editorClass&&this.$el.addClass(t.editorClass),t.editorAttrs&&this.$el.attr(t.editorAttrs)},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(e){var t=this.validate();return t?t:(this.listenTo(this.model,"invalid",function(e,n){t=n}),this.model.set(this.key,this.getValue(),e),t?t:void 0)},validate:function(){var e=(this.$el,null),t=this.getValue(),n=this.form?this.form.getValue():{},i=this.validators,r=this.getValidator;return i&&s.every(i,function(i){return e=r(i)(t,n),e?!1:!0}),e},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),o.View.prototype.trigger.apply(this,arguments)},getValidator:function(e){var t=a.validators;if(s.isRegExp(e))return t.regexp({regexp:e});if(s.isString(e)){if(!t[e])throw new Error('Validator "'+e+'" not found');return t[e]()}if(s.isFunction(e))return e;if(s.isObject(e)&&e.type){var n=e;return t[n.type](n)}throw new Error("Invalid validator: "+e)}}),a.editors.Text=a.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(){var e=this;setTimeout(function(){e.determineChange()},0)},select:function(){this.trigger("select",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(e){a.editors.Base.prototype.initialize.call(this,e);var t=this.schema,n="text";t&&t.editorAttrs&&t.editorAttrs.type&&(n=t.editorAttrs.type),t&&t.dataType&&(n=t.dataType),this.$el.attr("type",n)},render:function(){return this.setValue(this.value),this},determineChange:function(){var e=this.$el.val(),t=e!==this.previousValue;t&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),a.editors.TextArea=a.editors.Text.extend({tagName:"textarea",initialize:function(e){a.editors.Base.prototype.initialize.call(this,e)}}),a.editors.Password=a.editors.Text.extend({initialize:function(e){a.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),a.editors.Number=a.editors.Text.extend({defaultValue:0,events:s.extend({},a.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(e){a.editors.Text.prototype.initialize.call(this,e);var t=this.schema;this.$el.attr("type","number"),t&&t.editorAttrs&&t.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(e){var t=this,n=function(){setTimeout(function(){t.determineChange()},0)};if(0===e.charCode)return void n();var i=this.$el.val();void 0!=e.charCode&&(i+=String.fromCharCode(e.charCode));var r=/^[0-9]*\.?[0-9]*?$/.test(i);r?n():e.preventDefault()},getValue:function(){var e=this.$el.val();return""===e?null:parseFloat(e,10)},setValue:function(e){e=function(){return s.isNumber(e)?e:s.isString(e)&&""!==e?parseFloat(e,10):null}(),s.isNaN(e)&&(e=null),a.editors.Text.prototype.setValue.call(this,e)}}),a.editors.Hidden=a.editors.Text.extend({defaultValue:"",initialize:function(e){a.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),a.editors.Checkbox=a.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(e){a.editors.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(e){e?this.$el.prop("checked",!0):this.$el.prop("checked",!1)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),a.editors.Select=a.editors.Base.extend({tagName:"select",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(e){if(a.editors.Base.prototype.initialize.call(this,e),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(e){var t=this;if(e instanceof o.Collection){var n=e;n.length>0?this.renderOptions(e):n.fetch({success:function(){t.renderOptions(e)}})}else s.isFunction(e)?e(function(e){t.renderOptions(e)},t):this.renderOptions(e)},renderOptions:function(e){var t,n=this.$el;t=this._getOptionsHtml(e),n.html(t),this.setValue(this.value)},_getOptionsHtml:function(e){var t;if(s.isString(e))t=e;else if(s.isArray(e))t=this._arrayToHtml(e);else if(e instanceof o.Collection)t=this._collectionToHtml(e);else if(s.isFunction(e)){var n;e(function(e){n=e},this),t=this._getOptionsHtml(n)}else t=this._objectToHtml(e);return t},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var n=this._arrayToHtml(t);return n},_objectToHtml:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({val:n,label:e[n]});var i=this._arrayToHtml(t);return i},_arrayToHtml:function(e){var t=[];return s.each(e,function(e){if(s.isObject(e))if(e.group)t.push('<optgroup label="'+e.group+'">'),t.push(this._getOptionsHtml(e.options)),t.push("</optgroup>");else{var n=e.val||0===e.val?e.val:"";t.push('<option value="'+n+'">'+e.label+"</option>")}else t.push("<option>"+e+"</option>")},this),t.join("")}}),a.editors.Radio=a.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("input[type=radio]:focus")[0]||e.trigger("blur",e)},0)}}},getTemplate:function(){return this.schema.template||this.constructor.template},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(e){this.$("input[type=radio]").val([e])},focus:function(){if(!this.hasFocus){var e=this.$("input[type=radio]:checked");return e[0]?void e.focus():void this.$("input[type=radio]").first().focus()}},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(e){var t=this,n=this.getTemplate(),i=t.getName(),r=t.id,o=s.map(e,function(e,t){var n={name:i,id:r+"-"+t};return s.isObject(e)?(n.value=e.val||0===e.val?e.val:"",n.label=e.label):(n.value=e,n.label=e),n});return n({items:o})}},{template:s.template('    <ul>      <% _.each(items, function(item) { %>        <li>          <input type="radio" name="<%= item.name %>" value="<%= item.value %>" id="<%= item.id %>" />          <label for="<%= item.id %>"><%= item.label %></label>        </li>      <% }); %>    </ul>  ',null,a.templateSettings)}),a.editors.Checkboxes=a.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("input[type=checkbox]:focus")[0]||e.trigger("blur",e)},0)}}},getValue:function(){var e=[];return this.$("input[type=checkbox]:checked").each(function(){e.push(r(this).val())}),e},setValue:function(e){s.isArray(e)||(e=[e]),this.$("input[type=checkbox]").val(e)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(e){var t=[],n=this;return s.each(e,function(e,i){var r="<li>",o=!0;if(s.isObject(e))if(e.group){var a=n.id;n.id+="-"+n.groupNumber++,r='<fieldset class="group"> <legend>'+e.group+"</legend>",r+=n._arrayToHtml(e.options),r+="</fieldset>",n.id=a,o=!1}else{var l=e.val||0===e.val?e.val:"";r+='<input type="checkbox" name="'+n.getName()+'" value="'+l+'" id="'+n.id+"-"+i+'" />',r+='<label for="'+n.id+"-"+i+'">'+e.label+"</label>"}else r+='<input type="checkbox" name="'+n.getName()+'" value="'+e+'" id="'+n.id+"-"+i+'" />',r+='<label for="'+n.id+"-"+i+'">'+e+"</label>";o&&(r+="</li>"),t.push(r)}),t.join("")}}),a.editors.Object=a.editors.Base.extend({hasNestedForm:!0,initialize:function(e){if(this.value={},a.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var e=this.form.constructor;return this.nestedForm=new e({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:e.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),o.View.prototype.remove.call(this)},validate:function(){return this.nestedForm.validate()},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var e=s.toArray(arguments);e[1]=this,this.trigger.apply(this,e)},this)}}),a.editors.NestedModel=a.editors.Object.extend({initialize:function(e){if(a.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var e=this.form.constructor,t=this.value||{},n=(this.key,this.schema.model),i=t.constructor===n?t:new n(t);return this.nestedForm=new e({model:i,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var e=this.nestedForm.commit();return e?(this.$el.addClass("error"),e):a.editors.Object.prototype.commit.call(this)}}),a.editors.Date=a.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0)}}},initialize:function(e){e=e||{},a.editors.Base.prototype.initialize.call(this,e);var t=a.editors.Date,n=new Date;if(this.options=s.extend({monthNames:t.monthNames,showMonthNames:t.showMonthNames},e),this.schema=s.extend({yearStart:n.getFullYear()-100,yearEnd:n.getFullYear()},e.schema||{}),this.value&&!s.isDate(this.value)&&(this.value=new Date(this.value)),!this.value){var i=new Date;i.setSeconds(0),i.setMilliseconds(0),this.value=i}this.template=e.template||this.constructor.template},render:function(){var e=this.options,t=this.schema,n=s.map(s.range(1,32),function(e){return'<option value="'+e+'">'+e+"</option>"}),i=s.map(s.range(0,12),function(t){var n=e.showMonthNames?e.monthNames[t]:t+1;return'<option value="'+t+'">'+n+"</option>"}),o=t.yearStart<t.yearEnd?s.range(t.yearStart,t.yearEnd+1):s.range(t.yearStart,t.yearEnd-1,-1),a=s.map(o,function(e){return'<option value="'+e+'">'+e+"</option>"}),l=r(r.trim(this.template({dates:n.join(""),months:i.join(""),years:a.join("")})));return this.$date=l.find('[data-type="date"]'),this.$month=l.find('[data-type="month"]'),this.$year=l.find('[data-type="year"]'),this.$hidden=r('<input type="hidden" name="'+this.key+'" />'),l.append(this.$hidden),this.setValue(this.value),this.setElement(l),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.$year.val(),t=this.$month.val(),n=this.$date.val();return e&&t&&n?new Date(e,t,n):null},setValue:function(e){this.$date.val(e.getDate()),this.$month.val(e.getMonth()),this.$year.val(e.getFullYear()),this.updateHidden()
},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();s.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)}},{template:s.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,a.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),a.editors.DateTime=a.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var e=this;setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0)}}},initialize:function(e){e=e||{},a.editors.Base.prototype.initialize.call(this,e),this.options=s.extend({DateEditor:a.editors.DateTime.DateEditor},e),this.schema=s.extend({minsInterval:15},e.schema||{}),this.dateEditor=new this.options.DateEditor(e),this.value=this.dateEditor.value,this.template=e.template||this.constructor.template},render:function(){function e(e){return 10>e?"0"+e:e}var t=this.schema,n=s.map(s.range(0,24),function(t){return'<option value="'+t+'">'+e(t)+"</option>"}),i=s.map(s.range(0,60,t.minsInterval),function(t){return'<option value="'+t+'">'+e(t)+"</option>"}),o=r(r.trim(this.template({hours:n.join(),mins:i.join()})));return o.find("[data-date]").append(this.dateEditor.render().el),this.$hour=o.find('select[data-type="hour"]'),this.$min=o.find('select[data-type="min"]'),this.$hidden=o.find('input[type="hidden"]'),this.setValue(this.value),this.setElement(o),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.dateEditor.getValue(),t=this.$hour.val(),n=this.$min.val();return e&&t&&n?(e.setHours(t),e.setMinutes(n),e):null},setValue:function(e){s.isDate(e)||(e=new Date(e)),this.dateEditor.setValue(e),this.$hour.val(e.getHours()),this.$min.val(e.getMinutes()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();s.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)},remove:function(){this.dateEditor.remove(),a.editors.Base.prototype.remove.call(this)}},{template:s.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,a.templateSettings),DateEditor:a.editors.Date}),a.VERSION="0.14.0",o.Form=a,"undefined"!=typeof t&&(t.exports=a)}(window||i||this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{backbone:void 0,jquery:void 0,underscore:void 0}],104:[function(e,t){var n=e("backbone"),i=e("underscore"),r=e("jquery");!function(e){e.editors.List=e.editors.Base.extend({events:{'click [data-action="add"]':function(e){e.preventDefault(),this.addItem(null,!0)}},initialize:function(t){t=t||{};var n=e.editors;n.Base.prototype.initialize.call(this,t);var i=this.schema;if(!i)throw new Error("Missing required option 'schema'");this.template=t.template||this.constructor.template,this.Editor=function(){var e=i.itemType;return e?n.List[e]?n.List[e]:n[e]:n.Text}(),this.items=[]},render:function(){var e=this,t=this.value||[],n=r(r.trim(this.template()));return this.$list=n.is("[data-items]")?n:n.find("[data-items]"),t.length?i.each(t,function(t){e.addItem(t)}):this.Editor.isAsync||this.addItem(),this.setElement(n),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},addItem:function(t,n){var r=this,s=e.editors,o=new s.List.Item({list:this,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key}).render(),a=function(){r.items.push(o),r.$list.append(o.el),o.editor.on("all",function(e){if("change"!==e){var t=i.toArray(arguments);t[0]="item:"+e,t.splice(1,0,r),s.List.prototype.trigger.apply(this,t)}},r),o.editor.on("change",function(){o.addEventTriggered||(o.addEventTriggered=!0,this.trigger("add",this,o.editor)),this.trigger("item:change",this,o.editor),this.trigger("change",this)},r),o.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},r),o.editor.on("blur",function(){if(this.hasFocus){var e=this;setTimeout(function(){i.find(e.items,function(e){return e.editor.hasFocus})||e.trigger("blur",e)},0)}},r),(n||t)&&(o.addEventTriggered=!0),n&&(r.trigger("add",r,o.editor),r.trigger("change",r))};return this.Editor.isAsync?o.editor.on("readyToAdd",a,this):(a(),o.editor.focus()),o},removeItem:function(e){var t=this.schema.confirmDelete;if(!t||confirm(t)){var n=i.indexOf(this.items,e);this.items[n].remove(),this.items.splice(n,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem()}},getValue:function(){var e=i.map(this.items,function(e){return e.getValue()});return i.without(e,void 0,"")},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){if(this.hasFocus){var e=i.find(this.items,function(e){return e.editor.hasFocus});e&&e.editor.blur()}},remove:function(){i.invoke(this.items,"remove"),e.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var e=i.map(this.items,function(e){return e.validate()}),t=i.compact(e).length?!0:!1;if(!t)return null;var n={type:"list",message:"Some of the items in the list failed validation",errors:e};return n}},{template:i.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,e.templateSettings)}),e.editors.List.Item=e.editors.Base.extend({events:{'click [data-action="remove"]':function(e){e.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(e){13===e.keyCode&&(e.preventDefault(),this.list.addItem(),this.list.$list.find("> li:last input").focus())}},initialize:function(t){this.list=t.list,this.schema=t.schema||this.list.schema,this.value=t.value,this.Editor=t.Editor||e.editors.Text,this.key=t.key,this.template=t.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=t.errorClassName||this.constructor.errorClassName,this.form=t.form},render:function(){this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form}).render();var e=r(r.trim(this.template()));return e.find("[data-editor]").append(this.editor.el),this.setElement(e),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),n.View.prototype.remove.call(this)},validate:function(){var e=this.getValue(),t=this.list.form?this.list.form.getValue():{},n=this.schema.validators,r=this.getValidator;if(!n)return null;var s=null;return i.every(n,function(n){return s=r(n)(e,t),s?!1:!0}),s?this.setError(s):this.clearError(),s?s:null},setError:function(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{template:i.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,e.templateSettings),errorClassName:"error"}),e.editors.List.Modal=e.editors.Base.extend({events:{click:"openEditor"},initialize:function(t){if(t=t||{},e.editors.Base.prototype.initialize.call(this,t),!e.editors.List.Modal.ModalAdapter)throw new Error("A ModalAdapter is required");if(this.form=t.form,!t.form)throw new Error('Missing required option: "form"');this.template=t.template||this.constructor.template},render:function(){var e=this;return i.isEmpty(this.value)?this.openEditor():(this.renderSummary(),setTimeout(function(){e.trigger("readyToAdd")},0)),this.hasFocus&&this.trigger("blur",this),this},renderSummary:function(){this.$el.html(r.trim(this.template({summary:this.getStringValue()})))},itemToString:function(t){var n=function(t){var n={key:t};return e.Field.prototype.createTitle.call(n)};t=t||{};var r=[];return i.each(this.nestedSchema,function(e,s){var o=e.title?e.title:n(s),a=t[s];(i.isUndefined(a)||i.isNull(a))&&(a=""),r.push(o+": "+a)}),r.join("<br />")},getStringValue:function(){var e=this.schema,t=this.getValue();return i.isEmpty(t)?"[Empty]":e.itemToString?e.itemToString(t):this.itemToString(t)},openEditor:function(){var t=this.form.constructor,n=this.modalForm=new t({schema:this.nestedSchema,data:this.value}),r=this.modal=new e.editors.List.Modal.ModalAdapter({content:n,animate:!0});r.open(),this.trigger("open",this),this.trigger("focus",this),r.on("cancel",this.onModalClosed,this),r.on("ok",i.bind(this.onModalSubmitted,this))},onModalSubmitted:function(){var e=this.modal,t=this.modalForm,n=!this.value,i=t.validate();return i?e.preventClose():(this.value=t.getValue(),this.renderSummary(),n&&this.trigger("readyToAdd"),this.trigger("change",this),void this.onModalClosed())},onModalClosed:function(){this.modal=null,this.modalForm=null,this.trigger("close",this),this.trigger("blur",this)},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){this.hasFocus||this.openEditor()},blur:function(){this.hasFocus&&this.modal&&this.modal.trigger("cancel")}},{template:i.template("      <div><%= summary %></div>    ",null,e.templateSettings),ModalAdapter:n.BootstrapModal,isAsync:!0}),e.editors.List.Object=e.editors.List.Modal.extend({initialize:function(){e.editors.List.Modal.prototype.initialize.apply(this,arguments);var t=this.schema;if(!t.subSchema)throw new Error('Missing required option "schema.subSchema"');this.nestedSchema=t.subSchema}}),e.editors.List.NestedModel=e.editors.List.Modal.extend({initialize:function(){e.editors.List.Modal.prototype.initialize.apply(this,arguments);var t=this.schema;if(!t.model)throw new Error('Missing required option "schema.model"');var n=t.model.prototype.schema;this.nestedSchema=i.isFunction(n)?n():n},getStringValue:function(){var e=this.schema,t=this.getValue();return i.isEmpty(t)?null:e.itemToString?e.itemToString(t):new e.model(t).toString()}})}(n.Form),t.exports=n.Form.editors.List},{backbone:void 0,jquery:void 0,underscore:void 0}],105:[function(e,t,n){(function(i){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof i?r=i:"undefined"!=typeof self&&(r=self),r.jade=e()}}(function(){return function t(n,i,r){function s(a,l){if(!i[a]){if(!n[a]){var c="function"==typeof e&&e;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return s(t?t:e)},u,u.exports,t,n,i,r)}return i[a].exports}for(var o="function"==typeof e&&e,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,n){"use strict";function i(e){return null!=e&&""!==e}function r(e){return Array.isArray(e)?e.map(r).filter(i).join(" "):e}n.merge=function s(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=s(n,e[r]);return n}var o=e["class"],a=t["class"];(o||a)&&(o=o||[],a=a||[],Array.isArray(o)||(o=[o]),Array.isArray(a)||(a=[a]),e["class"]=o.concat(a).filter(i));for(var l in t)"class"!=l&&(e[l]=t[l]);return e},n.joinClasses=r,n.cls=function(e,t){for(var i=[],s=0;s<e.length;s++)i.push(t&&t[s]?n.escape(r([e[s]])):r(e[s]));var o=r(i);return o.length?' class="'+o+'"':""},n.attr=function(e,t,i,r){return"boolean"==typeof t||null==t?t?" "+(r?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof t?" "+e+"='"+JSON.stringify(t).replace(/'/g,"&apos;")+"'":i?" "+e+'="'+n.escape(t)+'"':" "+e+'="'+t+'"'},n.attrs=function(e,t){var i=[],s=Object.keys(e);if(s.length)for(var o=0;o<s.length;++o){var a=s[o],l=e[a];"class"==a?(l=r(l))&&i.push(" "+a+'="'+l+'"'):i.push(n.attr(a,l,!1,t))}return i.join("")},n.escape=function(e){var t=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return t===""+e?e:t},n.rethrow=function o(t,n,i,r){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&n||r))throw t.message+=" on line "+i,t;try{r=r||e("fs").readFileSync(n,"utf8")}catch(s){o(t,null,i)}var a=3,l=r.split("\n"),c=Math.max(i-a,0),u=Math.min(l.length,i+a),a=l.slice(c,u).map(function(e,t){var n=t+c+1;return(n==i?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+i+"\n"+a+"\n\n"+t.message,t}},{fs:2}],2:[function(){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{fs:4}],106:[function(e,t){e("../select2/select2.js"),t.exports=window.Select2},{"../select2/select2.js":107}],107:[function(){!function(e){"undefined"==typeof e.fn.each2&&e.extend(e.fn,{each2:function(t){for(var n=e([0]),i=-1,r=this.length;++i<r&&(n.context=n[0]=this[i])&&t.call(n[0],i,n)!==!1;);return this}})}(jQuery),function(e,t){"use strict";function n(e){var t,n,i,r;if(!e||e.length<1)return e;for(t="",n=0,i=e.length;i>n;n++)r=e.charAt(n),t+=A[r]||r;return t}function i(e,t){for(var n=0,i=t.length;i>n;n+=1)if(s(e,t[n]))return n;return-1}function r(){var t=e(D);t.appendTo("body");var n={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),n}function s(e,n){return e===n?!0:e===t||n===t?!1:null===e||null===n?!1:e.constructor===String?e+""==n+"":n.constructor===String?n+""==e+"":!1}function o(t,n){var i,r,s;if(null===t||t.length<1)return[];for(i=t.split(n),r=0,s=i.length;s>r;r+=1)i[r]=e.trim(i[r]);return i}function a(e){return e.outerWidth(!1)-e.width()}function l(n){var i="keyup-change-value";n.on("keydown",function(){e.data(n,i)===t&&e.data(n,i,n.val())}),n.on("keyup",function(){var r=e.data(n,i);r!==t&&n.val()!==r&&(e.removeData(n,i),n.trigger("keyup-change"))})}function c(n){n.on("mousemove",function(n){var i=I;(i===t||i.x!==n.pageX||i.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function u(e,n,i){i=i||t;var r;return function(){var t=arguments;window.clearTimeout(r),r=window.setTimeout(function(){n.apply(i,t)},e)}}function p(e){var t,n=!1;return function(){return n===!1&&(t=e(),n=!0),t}}function h(e,t){var n=u(e,function(e){t.trigger("scroll-debounced",e)});t.on("scroll",function(e){i(e.target,t.get())>=0&&n(e)})}function d(e){e[0]!==document.activeElement&&window.setTimeout(function(){var t,n=e[0],i=e.val().length;e.focus(),e.is(":visible")&&n===document.activeElement&&(n.setSelectionRange?n.setSelectionRange(i,i):n.createTextRange&&(t=n.createTextRange(),t.collapse(!1),t.select()))},0)}function f(t){t=e(t)[0];var n=0,i=0;if("selectionStart"in t)n=t.selectionStart,i=t.selectionEnd-n;else if("selection"in document){t.focus();var r=document.selection.createRange();i=document.selection.createRange().text.length,r.moveStart("character",-t.value.length),n=r.text.length-i}return{offset:n,length:i}}function m(e){e.preventDefault(),e.stopPropagation()}function g(e){e.preventDefault(),e.stopImmediatePropagation()}function v(t){if(!V){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);V=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),V.attr("class","select2-sizer"),e("body").append(V)}return V.text(t.val()),V.width()}function y(t,n,i){var r,s,o=[];r=t.attr("class"),r&&(r=""+r,e(r.split(" ")).each2(function(){0===this.indexOf("select2-")&&o.push(this)})),r=n.attr("class"),r&&(r=""+r,e(r.split(" ")).each2(function(){0!==this.indexOf("select2-")&&(s=i(this),s&&o.push(s))})),t.attr("class",o.join(" "))}function b(e,t,i,r){var s=n(e.toUpperCase()).indexOf(n(t.toUpperCase())),o=t.length;return 0>s?void i.push(r(e)):(i.push(r(e.substring(0,s))),i.push("<span class='select2-match'>"),i.push(r(e.substring(s,s+o))),i.push("</span>"),void i.push(r(e.substring(s+o,e.length))))}function w(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})}function _(n){var i,r=null,s=n.quietMillis||100,o=n.url,a=this;return function(l){window.clearTimeout(i),i=window.setTimeout(function(){var i=n.data,s=o,c=n.transport||e.fn.select2.ajaxDefaults.transport,u={type:n.type||"GET",cache:n.cache||!1,jsonpCallback:n.jsonpCallback||t,dataType:n.dataType||"json"},p=e.extend({},e.fn.select2.ajaxDefaults.params,u);i=i?i.call(a,l.term,l.page,l.context):null,s="function"==typeof s?s.call(a,l.term,l.page,l.context):s,r&&r.abort(),n.params&&(e.isFunction(n.params)?e.extend(p,n.params.call(a)):e.extend(p,n.params)),e.extend(p,{url:s,dataType:n.dataType,data:i,success:function(e){var t=n.results(e,l.page);l.callback(t)}}),r=c.call(a,p)},s)}}function S(t){var n,i,r=t,s=function(e){return""+e.text};e.isArray(r)&&(i=r,r={results:i}),e.isFunction(r)===!1&&(i=r,r=function(){return i});var o=r();return o.text&&(s=o.text,e.isFunction(s)||(n=o.text,s=function(e){return e[n]})),function(t){var n,i=t.term,o={results:[]};return""===i?void t.callback(r()):(n=function(r,o){var a,l;if(r=r[0],r.children){a={};for(l in r)r.hasOwnProperty(l)&&(a[l]=r[l]);a.children=[],e(r.children).each2(function(e,t){n(t,a.children)}),(a.children.length||t.matcher(i,s(a),r))&&o.push(a)}else t.matcher(i,s(r),r)&&o.push(r)},e(r().results).each2(function(e,t){n(t,o.results)}),void t.callback(o))}}function x(n){var i=e.isFunction(n);return function(r){var s=r.term,o={results:[]};e(i?n():n).each(function(){var e=this.text!==t,n=e?this.text:this;(""===s||r.matcher(s,n))&&o.results.push(e?this:{id:this,text:this})}),r.callback(o)}}function T(t,n){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error(n+" must be a function or a falsy value")}function C(t){return e.isFunction(t)?t():t}function k(t){var n=0;return e.each(t,function(e,t){t.children?n+=k(t.children):n++}),n}function O(e,n,i,r){var o,a,l,c,u,p=e,h=!1;if(!r.createSearchChoice||!r.tokenSeparators||r.tokenSeparators.length<1)return t;for(;;){for(a=-1,l=0,c=r.tokenSeparators.length;c>l&&(u=r.tokenSeparators[l],a=e.indexOf(u),!(a>=0));l++);if(0>a)break;if(o=e.substring(0,a),e=e.substring(a+u.length),o.length>0&&(o=r.createSearchChoice.call(this,o,n),o!==t&&null!==o&&r.id(o)!==t&&null!==r.id(o))){for(h=!1,l=0,c=n.length;c>l;l++)if(s(r.id(o),r.id(n[l]))){h=!0;break}h||i(o)}}return p!==e?e:void 0}function R(t,n){var i=function(){};return i.prototype=new t,i.prototype.constructor=i,i.prototype.parent=t.prototype,i.prototype=e.extend(i.prototype,n),i}if(window.Select2===t){var E,j,M,N,P,V,$,F,I={x:0,y:0},E={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case E.LEFT:case E.RIGHT:case E.UP:case E.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case E.SHIFT:case E.CTRL:case E.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},D="<div class='select2-measure-scrollbar'></div>",A={"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z"};$=e(document),P=function(){var e=1;return function(){return e++}}(),$.on("mousemove",function(e){I.x=e.pageX,I.y=e.pageY}),j=R(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var i,s,o=".select2-results";this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&null!==n.element.data("select2")&&n.element.data("select2").destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+P()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=p(function(){return n.element.closest("body")}),y(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",n.element.attr("style")),this.container.css(C(n.containerCss)),this.container.addClass(C(n.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",m),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(C(n.dropdownCssClass)),this.dropdown.data("select2",this),this.dropdown.on("click",m),this.results=i=this.container.find(o),this.search=s=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",m),c(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",o,this.bind(this.highlightUnderEvent)),h(80,this.results),this.dropdown.on("scroll-debounced",o,this.bind(this.loadMoreIfNeeded)),e(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),e(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),e.fn.mousewheel&&i.mousewheel(function(e,t,n,r){var s=i.scrollTop();r>0&&0>=s-r?(i.scrollTop(0),m(e)):0>r&&i.get(0).scrollHeight-i.scrollTop()+r<=i.height()&&(i.scrollTop(i.get(0).scrollHeight-i.height()),m(e))}),l(s),s.on("keyup-change input paste",this.bind(this.updateResults)),s.on("focus",function(){s.addClass("select2-focused")}),s.on("blur",function(){s.removeClass("select2-focused")}),this.dropdown.on("mouseup",o,this.bind(function(t){e(t.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(t),this.selectHighlighted(t))})),this.dropdown.on("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==n.maximumInputLength&&this.search.attr("maxlength",n.maximumInputLength);var a=n.element.prop("disabled");a===t&&(a=!1),this.enable(!a);var u=n.element.prop("readonly");u===t&&(u=!1),this.readonly(u),F=F||r(),this.autofocus=n.element.prop("autofocus"),n.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.nextSearchTerm=t},destroy:function(){var e=this.opts.element,n=e.data("select2");this.close(),this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),n!==t&&(n.container.remove(),n.dropdown.remove(),e.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:s(e.attr("locked"),"locked")||s(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(n){var i,r,a,l,c=this;if(i=n.element,"select"===i.get(0).tagName.toLowerCase()&&(this.select=r=n.element),r&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(i,r,s){var o,a=this.opts.id;(o=function(i,r,l){var u,p,h,d,f,m,g,v,y,b;for(i=n.sortResults(i,r,s),u=0,p=i.length;p>u;u+=1)h=i[u],f=h.disabled===!0,d=!f&&a(h)!==t,m=h.children&&h.children.length>0,g=e("<li></li>"),g.addClass("select2-results-dept-"+l),g.addClass("select2-result"),g.addClass(d?"select2-result-selectable":"select2-result-unselectable"),f&&g.addClass("select2-disabled"),m&&g.addClass("select2-result-with-children"),g.addClass(c.opts.formatResultCssClass(h)),v=e(document.createElement("div")),v.addClass("select2-result-label"),b=n.formatResult(h,v,s,c.opts.escapeMarkup),b!==t&&v.html(b),g.append(v),m&&(y=e("<ul></ul>"),y.addClass("select2-result-sub"),o(h.children,y,l+1),g.append(y)),g.data("select2-data",h),r.append(g)})(r,i,0)}},e.fn.select2.defaults,n),"function"!=typeof n.id&&(a=n.id,n.id=function(e){return e[a]}),e.isArray(n.element.data("select2Tags"))){if("tags"in n)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+n.element.attr("id");n.tags=n.element.data("select2Tags")}if(r?(n.query=this.bind(function(e){var n,r,s,o={results:[],more:!1},a=e.term;s=function(t,n){var i;t.is("option")?e.matcher(a,t.text(),t)&&n.push(c.optionToData(t)):t.is("optgroup")&&(i=c.optionToData(t),t.children().each2(function(e,t){s(t,i.children)}),i.children.length>0&&n.push(i))},n=i.children(),this.getPlaceholder()!==t&&n.length>0&&(r=this.getPlaceholderOption(),r&&(n=n.not(r))),n.each2(function(e,t){s(t,o.results)}),e.callback(o)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?(l=n.element.data("ajax-url"),l&&l.length>0&&(n.ajax.url=l),n.query=_.call(n.element,n.ajax)):"data"in n?n.query=S(n.data):"tags"in n&&(n.query=x(n.tags),n.createSearchChoice===t&&(n.createSearchChoice=function(t){return{id:e.trim(t),text:e.trim(t)}
}),n.initSelection===t&&(n.initSelection=function(t,i){var r=[];e(o(t.val(),n.separator)).each(function(){var t={id:this,text:this},i=n.tags;e.isFunction(i)&&(i=i()),e(i).each(function(){return s(this.id,t.id)?(t=this,!1):void 0}),r.push(t)}),i(r)}))),"function"!=typeof n.query)throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){var e,n,i=this.opts.element;i.on("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),e=this.bind(function(){var e=i.prop("disabled");e===t&&(e=!1),this.enable(!e);var n=i.prop("readonly");n===t&&(n=!1),this.readonly(n),y(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(C(this.opts.containerCssClass)),y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(C(this.opts.dropdownCssClass))}),i.on("propertychange.select2",e),this.mutationCallback===t&&(this.mutationCallback=function(t){t.forEach(e)}),n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n!==t&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new n(this.mutationCallback),this.propertyObserver.observe(i.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(t){var n=e.Event("select2-selecting",{val:this.id(t),object:t});return this.opts.element.trigger(n),!n.isDefaultPrevented()},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){e===t&&(e=!0),this._enabled!==e&&(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(e){return e===t&&(e=!1),this._readonly===e?!1:(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,n,i,r,s,o=this.dropdown,a=this.container.offset(),l=this.container.outerHeight(!1),c=this.container.outerWidth(!1),u=o.outerHeight(!1),p=e(window),h=p.width(),d=p.height(),f=p.scrollLeft()+h,m=p.scrollTop()+d,g=a.top+l,v=a.left,y=m>=g+u,b=a.top-u>=this.body().scrollTop(),w=o.outerWidth(!1),_=f>=v+w,S=o.hasClass("select2-drop-above");S?(n=!0,!b&&y&&(i=!0,n=!1)):(n=!1,!y&&b&&(i=!0,n=!0)),i&&(o.hide(),a=this.container.offset(),l=this.container.outerHeight(!1),c=this.container.outerWidth(!1),u=o.outerHeight(!1),f=p.scrollLeft()+h,m=p.scrollTop()+d,g=a.top+l,v=a.left,w=o.outerWidth(!1),_=f>=v+w,o.show()),this.opts.dropdownAutoWidth?(s=e(".select2-results",o)[0],o.addClass("select2-drop-auto-width"),o.css("width",""),w=o.outerWidth(!1)+(s.scrollHeight===s.clientHeight?0:F.width),w>c?c=w:w=c,_=f>=v+w):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(t=this.body().offset(),g-=t.top,v-=t.left),_||(v=a.left+c-w),r={left:v,width:c},n?(r.bottom=d-a.top,r.top="auto",this.container.addClass("select2-drop-above"),o.addClass("select2-drop-above")):(r.top=g,r.bottom="auto",this.container.removeClass("select2-drop-above"),o.removeClass("select2-drop-above")),r=e.extend(r,C(this.opts.dropdownCss)),o.css(r)},shouldOpen:function(){var t;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(t=e.Event("select2-opening"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),!0):!1},opening:function(){var t,n=this.containerId,i="scroll."+n,r="resize."+n,s="orientationchange."+n;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),t=e("#select2-drop-mask"),0==t.length&&(t=e(document.createElement("div")),t.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),t.hide(),t.appendTo(this.body()),t.on("mousedown touchstart click",function(t){var n,i=e("#select2-drop");i.length>0&&(n=i.data("select2"),n.opts.selectOnBlur&&n.selectHighlighted({noFocus:!0}),n.close({focus:!0}),t.preventDefault(),t.stopPropagation())})),this.dropdown.prev()[0]!==t[0]&&this.dropdown.before(t),e("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),t.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var o=this;this.container.parents().add(window).each(function(){e(this).on(r+" "+i+" "+s,function(){o.positionDropdown()})})},close:function(){if(this.opened()){var t=this.containerId,n="scroll."+t,i="resize."+t,r="orientationchange."+t;this.container.parents().add(window).each(function(){e(this).off(n).off(i).off(r)}),this.clearDropdownAlignmentPreference(),e("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(e.Event("select2-close"))}},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return C(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var t,n,i,r,s,o,a,l=this.results;if(n=this.highlight(),!(0>n)){if(0==n)return void l.scrollTop(0);t=this.findHighlightableChoices().find(".select2-result-label"),i=e(t[n]),r=i.offset().top+i.outerHeight(!0),n===t.length-1&&(a=l.find("li.select2-more-results"),a.length>0&&(r=a.offset().top+a.outerHeight(!0))),s=l.offset().top+l.outerHeight(!0),r>s&&l.scrollTop(l.scrollTop()+(r-s)),o=i.offset().top-l.offset().top,0>o&&"none"!=i.css("display")&&l.scrollTop(l.scrollTop()+o)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled, .select2-selected)")},moveHighlight:function(t){for(var n=this.findHighlightableChoices(),i=this.highlight();i>-1&&i<n.length;){i+=t;var r=e(n[i]);if(r.hasClass("select2-result-selectable")&&!r.hasClass("select2-disabled")&&!r.hasClass("select2-selected")){this.highlight(i);break}}},highlight:function(t){var n,r,s=this.findHighlightableChoices();return 0===arguments.length?i(s.filter(".select2-highlighted")[0],s.get()):(t>=s.length&&(t=s.length-1),0>t&&(t=0),this.removeHighlight(),n=e(s[t]),n.addClass("select2-highlighted"),this.ensureHighlightVisible(),r=n.data("select2-data"),void(r&&this.opts.element.trigger({type:"select2-highlight",val:this.id(r),choice:r})))},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var i=this.findHighlightableChoices();this.highlight(i.index(n))}else 0==n.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var e,t=this.results,n=t.find("li.select2-more-results"),i=this.resultsPage+1,r=this,s=this.search.val(),o=this.context;0!==n.length&&(e=n.offset().top-t.offset().top-t.height(),e<=this.opts.loadMorePadding&&(n.addClass("select2-active"),this.opts.query({element:this.opts.element,term:s,page:i,context:o,matcher:this.opts.matcher,callback:this.bind(function(e){r.opened()&&(r.opts.populateResults.call(this,t,e.results,{term:s,page:i,context:o}),r.postprocessResults(e,!1,!1),e.more===!0?(n.detach().appendTo(t).text(r.opts.formatLoadMore(i+1)),window.setTimeout(function(){r.loadMoreIfNeeded()},10)):n.remove(),r.positionDropdown(),r.resultsPage=i,r.context=e.context,this.opts.element.trigger({type:"select2-loaded",items:e}))})})))},tokenize:function(){},updateResults:function(n){function i(){c.removeClass("select2-active"),h.positionDropdown()}function r(e){u.html(e),i()}var o,a,l,c=this.search,u=this.results,p=this.opts,h=this,d=c.val(),f=e.data(this.container,"select2-last-term");if((n===!0||!f||!s(d,f))&&(e.data(this.container,"select2-last-term",d),n===!0||this.showSearchInput!==!1&&this.opened())){l=++this.queryCount;var m=this.getMaximumSelectionSize();if(m>=1&&(o=this.data(),e.isArray(o)&&o.length>=m&&T(p.formatSelectionTooBig,"formatSelectionTooBig")))return void r("<li class='select2-selection-limit'>"+p.formatSelectionTooBig(m)+"</li>");if(c.val().length<p.minimumInputLength)return r(T(p.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+p.formatInputTooShort(c.val(),p.minimumInputLength)+"</li>":""),void(n&&this.showSearch&&this.showSearch(!0));if(p.maximumInputLength&&c.val().length>p.maximumInputLength)return void r(T(p.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+p.formatInputTooLong(c.val(),p.maximumInputLength)+"</li>":"");p.formatSearching&&0===this.findHighlightableChoices().length&&r("<li class='select2-searching'>"+p.formatSearching()+"</li>"),c.addClass("select2-active"),this.removeHighlight(),a=this.tokenize(),a!=t&&null!=a&&c.val(a),this.resultsPage=1,p.query({element:p.element,term:c.val(),page:this.resultsPage,context:null,matcher:p.matcher,callback:this.bind(function(o){var a;if(l==this.queryCount){if(!this.opened())return void this.search.removeClass("select2-active");if(this.context=o.context===t?null:o.context,this.opts.createSearchChoice&&""!==c.val()&&(a=this.opts.createSearchChoice.call(h,c.val(),o.results),a!==t&&null!==a&&h.id(a)!==t&&null!==h.id(a)&&0===e(o.results).filter(function(){return s(h.id(this),h.id(a))}).length&&o.results.unshift(a)),0===o.results.length&&T(p.formatNoMatches,"formatNoMatches"))return void r("<li class='select2-no-results'>"+p.formatNoMatches(c.val())+"</li>");u.empty(),h.opts.populateResults.call(this,u,o.results,{term:c.val(),page:this.resultsPage,context:null}),o.more===!0&&T(p.formatLoadMore,"formatLoadMore")&&(u.append("<li class='select2-more-results'>"+h.opts.escapeMarkup(p.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){h.loadMoreIfNeeded()},10)),this.postprocessResults(o,n),i(),this.opts.element.trigger({type:"select2-loaded",items:o})}})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){d(this.search)},selectHighlighted:function(e){var t=this.highlight(),n=this.results.find(".select2-highlighted"),i=n.closest(".select2-result").data("select2-data");i?(this.highlight(t),this.onSelect(i,e)):e&&e.noFocus&&this.close()},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==t?e.text():t)},getPlaceholderOption:function(){if(this.select){var e=this.select.children("option").first();if(this.opts.placeholderOption!==t)return"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===e.text()&&""===e.val())return e}},initContainerWidth:function(){function n(){var n,i,r,s,o,a;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(n=this.opts.element.attr("style"),n!==t)for(i=n.split(";"),s=0,o=i.length;o>s;s+=1)if(a=i[s].replace(/\s/g,""),r=a.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==r&&r.length>=1)return r[1];return"resolve"===this.opts.width?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var i=n.call(this);null!==i&&this.container.css("width",i)}}),M=R(j,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow'><b></b></span>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var n,i,r;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.search.focus(),n=this.search.get(0),n.createTextRange?(i=n.createTextRange(),i.collapse(!1),i.select()):n.setSelectionRange&&(r=this.search.val().length,n.setSelectionRange(r,r)),""===this.search.val()&&this.nextSearchTerm!=t&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(e.Event("select2-open"))},close:function(e){this.opened()&&(this.parent.close.apply(this,arguments),e=e||{focus:!0},this.focusser.removeAttr("disabled"),e.focus&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},destroy:function(){e("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var t,n=this.container,i=this.dropdown;this.showSearch(this.opts.minimumResultsForSearch<0?!1:!0),this.selection=t=n.find(".select2-choice"),this.focusser=n.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+P()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){if(e.which===E.PAGE_UP||e.which===E.PAGE_DOWN)return void m(e);switch(e.which){case E.UP:case E.DOWN:return this.moveHighlight(e.which===E.UP?-1:1),void m(e);case E.ENTER:return this.selectHighlighted(),void m(e);case E.TAB:return void this.selectHighlighted({noFocus:!0});case E.ESC:return this.cancel(e),void m(e)}}})),this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==E.TAB&&!E.isControl(e)&&!E.isFunctionKey(e)&&e.which!==E.ESC){if(this.opts.openOnEnter===!1&&e.which===E.ENTER)return void m(e);if(e.which==E.DOWN||e.which==E.UP||e.which==E.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void m(e)}return e.which==E.DELETE||e.which==E.BACKSPACE?(this.opts.allowClear&&this.clear(),void m(e)):void 0}})),l(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}})),t.on("mousedown","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),g(e),this.close(),this.selection.focus())})),t.on("mousedown",this.bind(function(t){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),m(t)})),i.on("mousedown",this.bind(function(){this.search.focus()})),t.on("focus",this.bind(function(e){m(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(e.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(t){var n=this.selection.data("select2-data");if(n){var i=e.Event("select2-clearing");if(this.opts.element.trigger(i),i.isDefaultPrevented())return;var r=this.getPlaceholderOption();this.opts.element.val(r?r.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),t!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(n),choice:n}),this.triggerChange({removed:n}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var e;return this.getPlaceholder()?(e=this.getPlaceholderOption())!==t&&e.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===t||null===this.opts.element.val():!1},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=e.find("option").filter(function(){return this.selected});t(n.optionToData(i))}:"data"in t&&(t.initSelection=t.initSelection||function(n,i){var r=n.val(),o=null;t.query({matcher:function(e,n,i){var a=s(r,t.id(i));return a&&(o=i),a},callback:e.isFunction(i)?function(){i(o)}:e.noop})}),t},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===t?t:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&e!==t){if(this.select&&this.getPlaceholderOption()===t)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,n){var i=0,r=this;if(this.findHighlightableChoices().each2(function(e,t){return s(r.id(t.data("select2-data")),r.opts.element.val())?(i=e,!1):void 0}),n!==!1&&this.highlight(t===!0&&i>=0?i:0),t===!0){var o=this.opts.minimumResultsForSearch;o>=0&&this.showSearch(k(e.results)>=o)}},showSearch:function(t){this.showSearchInput!==t&&(this.showSearchInput=t,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!t),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!t),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",t))},onSelect:function(e,t){if(this.triggerSelect(e)){var n=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.nextSearchTerm=this.opts.nextSearchTerm(e,this.search.val()),this.close(),t&&t.noFocus||this.focusser.focus(),s(n,this.id(e))||this.triggerChange({added:e,removed:i})}},updateSelection:function(e){var n,i,r=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),r.empty(),null!==e&&(n=this.opts.formatSelection(e,r,this.opts.escapeMarkup)),n!==t&&r.append(n),i=this.opts.formatSelectionCssClass(e,r),i!==t&&r.addClass(i),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.container.addClass("select2-allowclear")},val:function(){var e,n=!1,i=null,r=this,s=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],arguments.length>1&&(n=arguments[1]),this.select)this.select.val(e).find("option").filter(function(){return this.selected}).each2(function(e,t){return i=r.optionToData(t),!1}),this.updateSelection(i),this.setPlaceholder(),n&&this.triggerChange({added:i,removed:s});else{if(!e&&0!==e)return void this.clear(n);if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){r.opts.element.val(e?r.id(e):""),r.updateSelection(e),r.setPlaceholder(),n&&r.triggerChange({added:e,removed:s})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e){var n,i=!1;return 0===arguments.length?(n=this.selection.data("select2-data"),n==t&&(n=null),n):(arguments.length>1&&(i=arguments[1]),void(e?(n=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),i&&this.triggerChange({added:e,removed:n})):this.clear(i)))}}),N=R(j,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=[];e.find("option").filter(function(){return this.selected}).each2(function(e,t){i.push(n.optionToData(t))}),t(i)}:"data"in t&&(t.initSelection=t.initSelection||function(n,i){var r=o(n.val(),t.separator),a=[];t.query({matcher:function(n,i,o){var l=e.grep(r,function(e){return s(e,t.id(o))}).length;return l&&a.push(o),l},callback:e.isFunction(i)?function(){for(var e=[],n=0;n<r.length;n++)for(var o=r[n],l=0;l<a.length;l++){var c=a[l];if(s(o,t.id(c))){e.push(c),a.splice(l,1);break}}i(e)}:e.noop})}),t},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},destroy:function(){e("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var t,n=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=t=this.container.find(n);var i=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(){i.search[0].focus(),i.selectChoice(e(this))}),this.search.attr("id","s2id_autogen"+P()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var n=t.find(".select2-search-choice-focus"),i=n.prev(".select2-search-choice:not(.select2-locked)"),r=n.next(".select2-search-choice:not(.select2-locked)"),s=f(this.search);if(n.length&&(e.which==E.LEFT||e.which==E.RIGHT||e.which==E.BACKSPACE||e.which==E.DELETE||e.which==E.ENTER)){var o=n;return e.which==E.LEFT&&i.length?o=i:e.which==E.RIGHT?o=r.length?r:null:e.which===E.BACKSPACE?(this.unselect(n.first()),this.search.width(10),o=i.length?i:r):e.which==E.DELETE?(this.unselect(n.first()),this.search.width(10),o=r.length?r:null):e.which==E.ENTER&&(o=null),this.selectChoice(o),m(e),void(o&&o.length||this.open())}if((e.which===E.BACKSPACE&&1==this.keydowns||e.which==E.LEFT)&&0==s.offset&&!s.length)return this.selectChoice(t.find(".select2-search-choice:not(.select2-locked)").last()),void m(e);if(this.selectChoice(null),this.opened())switch(e.which){case E.UP:case E.DOWN:return this.moveHighlight(e.which===E.UP?-1:1),void m(e);case E.ENTER:return this.selectHighlighted(),void m(e);case E.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case E.ESC:return this.cancel(e),void m(e)}if(e.which!==E.TAB&&!E.isControl(e)&&!E.isFunctionKey(e)&&e.which!==E.BACKSPACE&&e.which!==E.ESC){if(e.which===E.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),(e.which===E.PAGE_UP||e.which===E.PAGE_DOWN)&&m(e),e.which===E.ENTER&&m(e)}}})),this.search.on("keyup",this.bind(function(){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(t){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),t.stopImmediatePropagation(),this.opts.element.trigger(e.Event("select2-blur"))})),this.container.on("click",n,this.bind(function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),this.focusSearch(),t.preventDefault()))})),this.container.on("focus",n,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder(),n=this.getMaxSearchWidth();e!==t&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.search.width(n>0?n:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger(e.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],r=[],s=this;e(t).each(function(){i(s.id(this),n)<0&&(n.push(s.id(this)),r.push(this))}),t=r,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){s.addSelectedChoice(this)}),s.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts),null!=e&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e,t){this.triggerSelect(e)&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(e,!1,this.opts.closeOnSelect===!0),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),t&&t.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(n){var i,r,s=!n.locked,o=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),a=e("<li class='select2-search-choice select2-locked'><div></div></li>"),l=s?o:a,c=this.id(n),u=this.getVal();i=this.opts.formatSelection(n,l.find("div"),this.opts.escapeMarkup),i!=t&&l.find("div").replaceWith("<div>"+i+"</div>"),r=this.opts.formatSelectionCssClass(n,l.find("div")),r!=t&&l.addClass(r),s&&l.find(".select2-search-choice-close").on("mousedown",m).on("click dblclick",this.bind(function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),m(t))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),l.data("select2-data",n),l.insertBefore(this.searchContainer),u.push(c),this.setVal(u)},unselect:function(t){var n,r,s=this.getVal();if(t=t.closest(".select2-search-choice"),0===t.length)throw"Invalid argument: "+t+". Must be .select2-search-choice";if(n=t.data("select2-data")){for(;(r=i(this.id(n),s))>=0;)s.splice(r,1),this.setVal(s),this.select&&this.postprocessResults();var o=e.Event("select2-removing");o.val=this.id(n),o.choice=n,this.opts.element.trigger(o),o.isDefaultPrevented()||(t.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(n),choice:n}),this.triggerChange({removed:n}))}},postprocessResults:function(e,t,n){var r=this.getVal(),s=this.results.find(".select2-result"),o=this.results.find(".select2-result-with-children"),a=this;s.each2(function(e,t){var n=a.id(t.data("select2-data"));i(n,r)>=0&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),o.each2(function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")}),-1==this.highlight()&&n!==!1&&a.highlight(0),!this.opts.createSearchChoice&&!s.filter(".select2-result:not(.select2-selected)").length>0&&(!e||e&&!e.more&&0===this.results.find(".select2-no-results").length)&&T(a.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+a.opts.formatNoMatches(a.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-a(this.search)},resizeSearch:function(){var e,t,n,i,r,s=a(this.search);e=v(this.search)+10,t=this.search.offset().left,n=this.selection.width(),i=this.selection.offset().left,r=n-(t-i)-s,e>r&&(r=n-s),40>r&&(r=n-s),0>=r&&(r=e),this.search.width(Math.floor(r))
},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),o(e,this.opts.separator))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){i(this,n)<0&&n.push(this)}),this.opts.element.val(0===n.length?"":n.join(this.opts.separator)))},buildChangeDetails:function(e,t){for(var t=t.slice(0),e=e.slice(0),n=0;n<t.length;n++)for(var i=0;i<e.length;i++)s(this.opts.id(t[n]),this.opts.id(e[i]))&&(t.splice(n,1),n>0&&n--,e.splice(i,1),i--);return{added:t,removed:e}},val:function(n,i){var r,s=this;if(0===arguments.length)return this.getVal();if(r=this.data(),r.length||(r=[]),!n&&0!==n)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(i&&this.triggerChange({added:this.data(),removed:r}));if(this.setVal(n),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),i&&this.triggerChange(this.buildChangeDetails(r,this.data()));else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e.map(t,s.id);s.setVal(n),s.updateSelection(t),s.clearSearch(),i&&s.triggerChange(s.buildChangeDetails(r,s.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t,n){var i,r,s=this;return 0===arguments.length?this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get():(r=this.data(),t||(t=[]),i=e.map(t,function(e){return s.opts.id(e)}),this.setVal(i),this.updateSelection(t),this.clearSearch(),n&&this.triggerChange(this.buildChangeDetails(r,this.data())),void 0)}}),e.fn.select2=function(){var n,r,s,o,a,l=Array.prototype.slice.call(arguments,0),c=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],u=["opened","isFocused","container","dropdown"],p=["val","data"],h={search:"externalSearch"};return this.each(function(){if(0===l.length||"object"==typeof l[0])n=0===l.length?{}:e.extend({},l[0]),n.element=e(this),"select"===n.element.get(0).tagName.toLowerCase()?a=n.element.prop("multiple"):(a=n.multiple||!1,"tags"in n&&(n.multiple=a=!0)),r=a?new N:new M,r.init(n);else{if("string"!=typeof l[0])throw"Invalid arguments to select2 plugin: "+l;if(i(l[0],c)<0)throw"Unknown method: "+l[0];if(o=t,r=e(this).data("select2"),r===t)return;if(s=l[0],"container"===s?o=r.container:"dropdown"===s?o=r.dropdown:(h[s]&&(s=h[s]),o=r[s].apply(r,l.slice(1))),i(l[0],u)>=0||i(l[0],p)&&1==l.length)return!1}}),o===t?this:o},e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n,i){var r=[];return b(e.text,n.term,r,i),r.join("")},formatSelection:function(e,n,i){return e?i(e.text):t},sortResults:function(e){return e},formatResultCssClass:function(){return t},formatSelectionCssClass:function(){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var n=t-e.length;return"Please enter "+n+" more character"+(1==n?"":"s")},formatInputTooLong:function(e,t){var n=e.length-t;return"Please delete "+n+" character"+(1==n?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return n(""+t).toUpperCase().indexOf(n(""+e).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:O,escapeMarkup:w,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(){return null},nextSearchTerm:function(){return t}},e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:_,local:S,tags:x},util:{debounce:u,markMatch:b,escapeMarkup:w,stripDiacritics:n},"class":{"abstract":j,single:M,multi:N}}}}(jQuery)},{}],108:[function(e,t){var n,i,r,s,o={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),s=e("underscore"),i=e("../models/relation"),t.exports=r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.model=i,t.prototype.showable=function(){return this.where({accepted:!0})},t.prototype.removeRelation=function(e){var t;return t=this.at(e),t.isNew()&&t.destroy(),t.markDeleted()},t.prototype.toJSON=function(){var e,t,n,i,r;for(e=[],r=this.models,n=0,i=r.length;i>n;n++)t=r[n],null!==t.getTarget()&&(t.needsDeletion()?e.push(t.deletedVersion().toJSON()):(t.isNew()||t.hasChanged())&&e.push(t.toJSON()));return e},t}(n.Collection)},{"../models/relation":113,backbone:void 0,underscore:void 0}],109:[function(e,t){var n,i,r,s,o,a,l,c,u;n=e("backbone"),u=e("underscore"),i=n.Model,i.schema={url:"Text",label:"Text"},c={String:"Text","boolean":"Radio",Link:"Link"},o=function(e){return 0===e.indexOf("List")},a=function(e){return-1!==e.indexOf("Person.Names")},s=function(e){return e in c?c[e]:o(e)?"List":"Text"},r=function(e){var t,n,i,r,l,c,u;return c=e.type,n={type:s(c)},a(c)?n.type="Names":o(c)||null==e.value?"boolean"===c?n.options=[{label:"Yes",val:!0},{label:"No",val:!1}]:o(c)?(u=c.match(/\((\w+)\)/),t=u[0],i=u[1],r=s(i),null!=e.value&&(r="Select",n.options=e.value),n.itemType=r):"Link"===e&&(l={schema:{label:{type:"Text"},url:{type:"Text"}}},n.model=l):(n.type="Select",n.options=e.value),n},l=function(e,t){var n,i,r,s;for(null==t&&(t=[]),s=null!=t?t:[],i=0,r=s.length;r>i;i++){if(n=s[i],u.isRegExp(n)&&e.match(n))return!0;if(e===n)return!0}return!1},t.exports={createTimbuctooSchema:function(e,t){var n,i,s,o,a,c,p;for(null==t&&(t={}),o=function(e){return l(e,t.exclude)},n=function(e){return l(e,t.readonly)},s={},p=u.keys(e),a=0,c=p.length;c>a;a++)i=p[a],o(i)||(s[i]=n(i)?{type:"ReadOnly"}:r(e[i]));return s}}},{backbone:void 0,underscore:void 0}],110:[function(e,t){var n,i,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("./dynamic-relation-type-helper"),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.getName=function(e){return e.inverseName},t.prototype.getRelatedType=function(e){return e.derivedSourceType},t.prototype.createRelation=function(e,t,n,i,r,s){var o;return o=this.createBaseRelation(e,i,r,s),o["^sourceId"]=n,o["^targetId"]=t,o},t.prototype.setRelatedModel=function(e,t){return e.setSource(t)},t}(i),t.exports=n},{"./dynamic-relation-type-helper":111}],111:[function(e,t){var n;n=function(){function e(e,t){this.template=t,this.createSearchFunction=function(t){return e(t)}}return e.prototype.createAutoComplete=function(e){return this.createSearchFunction(this.getRelatedType(e))},e.prototype.getName=function(e){return e.regularName},e.prototype.getRelatedType=function(e){return e.derivedTargetType},e.prototype.getTemplate=function(){return this.template},e.prototype.createRelation=function(e,t,n,i,r,s){var o;return o=this.createBaseRelation(e,i,r,s),o["^sourceId"]=t,o["^targetId"]=n,o},e.prototype.createBaseRelation=function(e,t,n,i){var r;return r={"^sourceType":e.baseSourceType,"^targetType":e.baseTargetType,"^typeId":e.typeId,"^typeType":"relationType","@type":n,accepted:!0},null!=t&&t>0&&(r["^rev"]=t),null!=i&&(r._id=i),r},e.prototype.setRelatedModel=function(e,t){return e.setTarget(t)},e}(),t.exports=n},{}],112:[function(e,t){t.exports={datable:function(){return function(e){var t,n;return n=String(e),t={type:"datable"},n.match(/^\d\d-\d\d-\d\d\d\d/)?t.message="Proper dates are not supported yet. Please only specify a year":n.length&&!n.match(/^\d+$/)&&(t.message="Not a year: should contain only numbers"),t.message?t:void 0}}}},{}],113:[function(e,t){var n,i,r,s={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),r=e("underscore"),t.exports=i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.idAttribute="_id",t.prototype.defaults=function(){return{accepted:!0,"^typeType":"relationtype"}},t.prototype.initialize=function(){return this.originalRelationId=this.get(this.idAttribute),this.originalTargetId=this.get("^targetId")},t.prototype.needsDeletion=function(){return this.getTarget()!==this.originalTargetId&&this.originalRelationId},t.prototype.markDeleted=function(){return this.set({accepted:!1})},t.prototype.setTarget=function(e){return!this.isNew()&&this.get(this.idAttribute)&&this.unset(this.idAttribute),this.set("^targetId",e)},t.prototype.getTarget=function(){return this.get("^targetId")},t.prototype.setSource=function(e){return!this.isNew()&&this.get(this.idAttribute)&&this.unset(this.idAttribute),this.set("^sourceId",e)},t.prototype.deletedVersion=function(){var e;return e=this.clone(),e.setTarget(this.originalTargetId),e.markDeleted(),e.set(this.idAttribute,this.originalRelationId),e},t.prototype.setDisplayName=function(e){return this.displayName=e},t.prototype.getDisplayName=function(){return this.displayName},t}(n.Model)},{backbone:void 0,underscore:void 0}],114:[function(e,t){var n,i,r,s,o,a,l,c,u,p={}.hasOwnProperty,h=function(e,t){function n(){this.constructor=e}for(var i in t)p.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),u=e("underscore"),n=i.$,s=e("backbone-forms/distribution/backbone-forms"),o=e("../models/relation"),l=e("../collections/relations.coffee"),a=e("./relation-autocomplete-item"),c=e("../../templates/dynamic-relations.jade"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return h(t,e),t.prototype.tagName="span",t.prototype.template=c,t.prototype.className="dynamic-relations-editor",t.prototype.events={"click .add-new button":"toggleAddButton","click .add-new li":"selectRelationType",'click button[data-action="remove"]':"clickRemoveRelation",updateRelationEvent:"updateRelation"},t.prototype.initialize=function(e){var n,i,r,s,o;for(t.__super__.initialize.apply(this,arguments),this.schema=e.schema,s=this.schema,this.relationTypes=s.relationTypes,this.relationName=s.relationName,this.relationTypeVariation=this.schema.relationTypeVariation,this.relationTypeHelper=this.schema.relationTypeHelper,this.typeMap={},o=this.relationTypes,i=0,r=o.length;r>i;i++)n=o[i],this.typeMap[this.relationTypeHelper.getName(n)]=n;return this.relationViews=[],this.initRelations()},t.prototype.toggleAddButton=function(e){return this.$(".add-new").hasClass("selection-box")?this.hideSelectionBox():this.showSelectionBox(),e.preventDefault()},t.prototype.initRelations=function(){var e,t,n,i,r;if(this.relations=new l,this.model.has("@relations")){i=this.model.get("@relations"),r=[];for(n in i)t=i[n],r.push(function(){var i,r,s;for(s=[],i=0,r=t.length;r>i;i++)e=t[i],n in this.typeMap&&s.push(e.accepted?this.addRelation(this.typeMap[n],e.relationId,e.id,e.displayName,e.rev):void 0);return s}.call(this));return r}},t.prototype.selectRelationType=function(e){var t,n;return n=this.$(e.currentTarget).attr("data-type"),t=this.typeMap[n],this.hideSelectionBox(),this.addRelation(t),e.preventDefault()},t.prototype.addRelation=function(e,t,n,i,r){var s;return s=new o(this.relationTypeHelper.createRelation(e,this.model.id,n,r,this.relationTypeVariation)),null!=t&&s.set({_id:t}),null!=i&&s.setDisplayName(i),this.relations.add(s),this.addRelationView(s,e)},t.prototype.addRelationView=function(e,t){var n,i;return n=this.relationTypeHelper.createAutoComplete(t),i=new a({label:this.relationTypeHelper.getName(t),type:this.relationTypeHelper.getRelatedType(t),autocomplete:n,model:e,relationTypeHelper:this.relationTypeHelper}),i.render(),this.relationViews.push(i),this.$(".relations").append(i.el)},t.prototype.clickRemoveRelation=function(e){var t;return t=this.$(e.currentTarget),this.removeRelation(t.closest(".timbuctoo-list-item").parent().index())},t.prototype.removeRelation=function(e){return this.relations.removeRelation(e),this.removeRelationView(this.relationViews[e]),this.relationViews.splice(e,1)},t.prototype.removeRelationView=function(e){return e.$el.fadeOut(150,function(){return function(){return e.remove()}}(this)),this.render()},t.prototype.showSelectionBox=function(){var e;return this.$(".add-new").addClass("selection-box"),e=this.$(".add-new"),n(document).on("click.outsideBox",function(t){return function(n){return 0!==e.has(n.target).length||e.is(n.target)?void 0:t.hideSelectionBox()}}(this))},t.prototype.hideSelectionBox=function(){return this.$(".add-new").removeClass("selection-box"),n(document).off("click.outsideBox")},t.prototype.renderRelations=function(){var e,t,n,i,r,s,o,a,l,c;for(n={},a=this.relationTypes,i=0,s=a.length;s>i;i++)t=a[i],n[t.typeId]=t;for(l=this.relations.showable(),c=[],r=0,o=l.length;o>r;r++)e=l[r],c.push(this.addRelationView(e,n[e.get("^typeId")]));return c},t.prototype.render=function(){return this.$el.html(this.template({relationTypeHelper:this.relationTypeHelper,relationTypes:this.relationTypes,relationName:this.relationName,humanizeRelationName:function(e){return e.replace(/([a-z](?=[A-Z]))/g,"$1 ").toLowerCase()}})),this.renderRelations(),this},t.prototype.getValue=function(){var e;return e=this.relations.toJSON()},t.prototype.updateRelation=function(e,t){var n,i,r,s,o,a,l,c;return o=this.$(t.currentTarget),n=o.closest(".timbuctoo-list-item").parent().index(),r=t.added,s=this.relations.at(n),l=s.get("^typeId"),a=function(){var e,t;e=this.typeMap,t=[];for(i in e)c=e[i],c.typeId===l&&t.push(c);return t}.call(this),this.removeRelation(n),this.addRelation(a[0],null,r.id,r.text,null)},t}(s.Editor),t.exports=r},{"../../templates/dynamic-relations.jade":126,"../collections/relations.coffee":108,"../models/relation":113,"./relation-autocomplete-item":121,backbone:void 0,"backbone-forms/distribution/backbone-forms":103,underscore:void 0}],115:[function(e,t){(function(n){var i,r,s,o,a,l,c,u,p=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},h={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var i in t)h.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=e("backbone"),u=e("underscore"),n.jQuery=e("jquery"),n._=u,n.Backbone=i,i.Form=e("backbone-forms/distribution/backbone-forms"),i.Form.editors.Link=e("./link-editor"),i.Form.editors.Names=e("./person-names-editor"),i.Form.editors.ReadOnly=e("./read-only-editor"),i.Form.editors.Relation=e("./relation-editor"),i.Form.editors.DynamicRelations=e("./dynamic-relations-editor"),i.Form.editors.List=e("backbone-forms/distribution/editors/list"),i.BootstrapModal=e("backbone-forms/distribution/adapters/backbone.bootstrap-modal"),i.Form.editors.List.Modal.ModalAdapter=i.BootstrapModal,i.Form.Field.template=e("../../templates/field.jade"),i.Form.Fieldset.template=e("../../templates/fieldset.jade"),i.Form.editors.List.template=e("../../templates/list.jade"),i.Form.editors.List.Item.template=e("../../templates/list-item.jade"),u.extend(i.Form.validators,e("../helpers/validators")),c=/^timbuctoo-relation\./,o=e("../models/relation"),l=function(e){var t,n,i,r,s;for(n=function(e){return"@type"!==e&&"_id"!==e&&"^rev"!==e&&e.match(/^[@_^]/)},s=[],i=0,r=e.length;r>i;i++)t=e[i],n(t)||s.push(t);return s},a=function(){var e,t,n,r;n=i.Model.prototype.toJSON.call(this,arguments),t=l(u.keys(n));for(e in n)r=n[e],p.call(t,e)<0&&delete n[e];return n},s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype.relationPrefix=c,t.prototype.getAllValues=function(e){return t.__super__.getValue.call(this,e)},t.prototype.getRelations=function(){var e,t,n,i;i=this.getAllValues(),t={};for(e in i)n=i[e],e.match(this.relationPrefix)&&(t[e]=n);return t},t.prototype.getValue=function(e){var n,i,r,s;s=t.__super__.getValue.call(this,e),n={};for(i in s)r=s[i],i.match(this.relationPrefix)||(n[i]=r);return n},t}(i.Form),t.exports=r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype.initialize=function(e){var t;return this.options=null!=e?e:{},this.listenTo(this.model,"sync",function(e){return function(){return e.render()}}(this)),t=this.options,this.authToken=t.authToken,this.VRE_ID=t.VRE_ID,this.relationsUrl=t.relationsUrl,this.model.VRE_ID=this.VRE_ID,this.form=new s(e),this.render()},t.prototype.saveRelation=function(e){var t;return t=new o(e),t.save(null,{url:t.id?""+this.relationsUrl+"/"+t.id:this.relationsUrl,dataType:"text",contentType:"application/json; charset=utf-8",headers:{Authorization:this.authToken,VRE_ID:this.VRE_ID}})},t.prototype.resolveRelations=function(e){var t,n,i,r,s;for(s=[],i=0,r=e.length;r>i;i++)n=e[i],s.push(function(){var e,i,r;for(r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(this.saveRelation(t));return r}.call(this));return s},t.prototype.save=function(){var e,t,n,r,s,o;return n=function(){var e,n;e=this.form.getRelations(),n=[];for(t in e)o=e[t],n.push(o);return n}.call(this),this.resolveRelations(n),e=this.form.commit(),e?{errors:e,result:null}:(s=function(){return a.call(this,arguments)},this.model.toJSON=u.bind(s,this.model),r=this.model.save(null,{dataType:"text",beforeSend:function(e){return function(t){return t.setRequestHeader("Authorization",e.authToken),t.setRequestHeader("VRE_ID",e.VRE_ID)}}(this)}).always(function(e){return function(){return s=function(){return i.Model.prototype.toJSON.call(this,arguments)},e.model.toJSON=u.bind(s,e.model)}}(this)),{errors:null,result:r})},t.prototype.renderForm=function(){var e;return e=this.form.render().el,this.$el.html(e),this.$("fieldset.collapsed .fields").hide(),this.$("fieldset legend").click(function(e){var t;return t=jQuery(e.currentTarget).parent(),t.toggleClass("collapsed"),t.hasClass("collapsed")?t.find(".fields").slideUp(150):t.find(".fields").slideDown(150)})},t.prototype.render=function(){return this.$el.empty(),this.renderForm()},t}(i.View)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../templates/field.jade":127,"../../templates/fieldset.jade":128,"../../templates/list-item.jade":130,"../../templates/list.jade":131,"../helpers/validators":112,"../models/relation":113,"./dynamic-relations-editor":114,"./link-editor":116,"./person-names-editor":119,"./read-only-editor":120,"./relation-editor":122,backbone:void 0,"backbone-forms/distribution/adapters/backbone.bootstrap-modal":102,"backbone-forms/distribution/backbone-forms":103,"backbone-forms/distribution/editors/list":104,jquery:void 0,underscore:void 0}],116:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),o=e("underscore"),i=e("backbone-forms/distribution/backbone-forms"),s=e("../../templates/link.jade"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.tagName="div",t.prototype.className="link-editor",t.prototype.template=s,t.prototype.events={"change .label-field input":"changeLabel","change .url-field   input":"changeUrl"},t.prototype.changeLabel=function(e){return this.value.label=e.currentTarget.value},t.prototype.changeUrl=function(e){return this.value.url=e.currentTarget.value},t.prototype.initialize=function(e){return null==e&&(e={}),t.__super__.initialize.apply(this,arguments),this.setValue(e.value),this.render},t.prototype.getValue=function(){return this.value},t.prototype.setValue=function(e){return null==e&&(e={}),this.value=e},t.prototype.render=function(){return this.$el.html(this.template()),this.$(".label-field input").val(this.value.label),this.$(".url-field input").val(this.value.url),this},t.prototype.focus=function(){},t.prototype.blur=function(){},t}(i.Editor),t.exports=r},{"../../templates/link.jade":129,backbone:void 0,"backbone-forms/distribution/backbone-forms":103,underscore:void 0}],117:[function(e,t){var n,i,r,s,o,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var i in t)l.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),a=e("underscore"),i=e("backbone-forms/distribution/backbone-forms"),o=e("../../templates/person-name-component.jade"),s=e("../../data/personnamecomponent.json"),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.tagName="span",t.prototype.className="person-name-component-editor",t.prototype.template=o,t.prototype.events={"change select":"changeType","change input[type=text]":"changeValue"},t.prototype.changeType=function(e){return this.value.type=e.currentTarget.value,this.$(".remove-name-component span").text(this.value.type)},t.prototype.changeValue=function(e){return this.value.value=e.currentTarget.value},t.prototype.initialize=function(e){return null==e&&(e={}),this.setValue(e)},t.prototype.getValue=function(){return this.value},t.prototype.setValue=function(e){return null==e&&(e={}),this.value=e},t.prototype.focus=function(){return this.$("input").focus()},t.prototype.remove=function(){var e;return e=function(e){return function(){return t.__super__.remove.apply(e,arguments)}}(this),this.$el.addClass("removing"),a.delay(e,250)},t.prototype.render=function(){var e,t;return this.$el.html(this.template({type:null!=(t=this.value)?t.type:void 0})),e=this.$el.find("select"),this.setUpSelect(e),e.val(this.value.type),this.$el.find("input").val(this.value.value),this},t.prototype.setUpSelect=function(){},t}(i.Editor),t.exports=r},{"../../data/personnamecomponent.json":124,"../../templates/person-name-component.jade":132,backbone:void 0,"backbone-forms/distribution/backbone-forms":103,underscore:void 0}],118:[function(e,t){var n,i,r,s,o,a,l,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),l=e("underscore"),i=e("backbone-forms/distribution/backbone-forms"),r=e("./person-name-component-editor"),a=e("../../templates/person-name-editor.jade"),o=e("../../data/personnamecomponent.json"),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.tagName="span",t.prototype.className="person-name-editor",t.prototype.template=a,t.prototype.events={"change .add-name-component-editor":"addComponentEditor","click .remove-name-component":"removeComponentEditor","click span.name":"toggleNameEditor"},t.prototype.removeComponentEditor=function(e){var t,n,i;return i=this.$(e.currentTarget),n=i.closest(".timbuctoo-list-item").parent(),t=this.nameComponentEditors.splice(n.index(),1)[0],t.remove()},t.prototype.addComponentEditor=function(e){var t,n;return n=e.currentTarget.value,t=new r({type:n}),this.nameComponentEditors.push(t),this.renderComponentEditor(t),t.focus(),this.$(".add-name-component-editor")[0].selectedIndex=0},t.prototype.toggleRemovable=function(e){return n.$(e.currentTarget).prev().toggleClass("removable")},t.prototype.toggleNameEditor=function(){return this.$el.toggleClass("editing")},t.prototype.initialize=function(e){var n,i,s,o,a;for(this.name=null!=e?e:{},t.__super__.initialize.apply(this,arguments),this.nameComponentEditors=[],o=this.name.components||[],a=[],i=0,s=o.length;s>i;i++)n=o[i],a.push(this.nameComponentEditors.push(new r(n)));return a},t.prototype.render=function(){var e,t,n,i;for(console.log(o),this.$el.html(this.template({name:this.name,componentTypes:o.type.value})),this.renderName(),i=this.nameComponentEditors,t=0,n=i.length;n>t;t++)e=i[t],this.renderComponentEditor(e);return this},t.prototype.renderName=function(){var e,t,n,i;return t=(null!=(i=this.name)?i.components:void 0)||[],n=function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(e.value);return r}(),n.length?this.$(".name").text(n.join(" ")):this.$(".name").html("<i>New name</i>")},t.prototype.renderComponentEditor=function(e){return e.render(),this.$(".name-component-editors .add-name-component-editor").before(e.$el)},t.prototype.getValue=function(){var e,t,n,i,r,s;for(t=[],s=this.nameComponentEditors,i=0,r=s.length;r>i;i++)e=s[i],t.push(e.getValue());return n={components:t}},t.prototype.focus=function(){},t.prototype.blur=function(){},t}(i.Editor),t.exports=s},{"../../data/personnamecomponent.json":124,"../../templates/person-name-editor.jade":133,"./person-name-component-editor":117,backbone:void 0,"backbone-forms/distribution/backbone-forms":103,underscore:void 0}],119:[function(e,t){var n,i,r,s,o,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var i in t)l.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),a=e("underscore"),i=e("backbone-forms/distribution/backbone-forms"),r=e("./person-name-editor"),o=e("../../templates/person-names-editor.jade"),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return c(t,e),t.prototype.tagName="span",t.prototype.className="person-names-editor",t.prototype.template=o,t.prototype.events={"click button.add-name-editor":"addNameEditor","click button.remove-name":"removeNameEditor","mouseenter button.remove-name":"toggleRemovable","mouseleave button.remove-name":"toggleRemovable"},t.prototype.addNameEditor=function(){var e;return e=new r,this.nameEditors.push(e),this.renderNameEditor(e)},t.prototype.removeNameEditor=function(e){var t,n;return n=this.$(e.currentTarget),t=n.closest(".timbuctoo-list-item").parent(),this.nameEditors.splice(t.index(),1),t.remove(),0===this.nameEditors.length?this.addNameEditor(e):void 0},t.prototype.toggleRemovable=function(e){return n.$(e.currentTarget).prev().toggleClass("removable")},t.prototype.initialize=function(e){var n,i,s,o,a;if(null==e&&(e={}),i=e.model.attributes[e.key],t.__super__.initialize.call(this,i),this.nameEditors=[],0===i.length)return this.nameEditors.push(new r);for(a=[],s=0,o=i.length;o>s;s++)n=i[s],a.push(this.nameEditors.push(new r(n)));return a},t.prototype.render=function(){var e,t,n,i;for(this.$el.html(this.template()),i=this.nameEditors,t=0,n=i.length;n>t;t++)e=i[t],this.renderNameEditor(e);return this},t.prototype.renderNameEditor=function(e){return e.render(),this.$el.find("div.person-name-editors").append(e.$el)},t.prototype.getValue=function(){var e,t,n,i,r;for(t=[],r=this.nameEditors,n=0,i=r.length;i>n;n++)e=r[n],t.push(e.getValue());return t},t.prototype.focus=function(){},t.prototype.blur=function(){},t}(i.Editor),t.exports=s},{"../../templates/person-names-editor.jade":134,"./person-name-editor":118,backbone:void 0,"backbone-forms/distribution/backbone-forms":103,underscore:void 0}],120:[function(e,t){var n,i,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone-forms/distribution/backbone-forms"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.tagName="span",t.prototype.className="readonly-editor",t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments)},t.prototype.render=function(){return this.setValue(this.value),this},t.prototype.getValue=function(){return this.value},t.prototype.setValue=function(e){return this.value=e,this.$el.text(this.value)},t.prototype.focus=function(){},t.prototype.blur=function(){},t}(n.Editor),t.exports=i},{"backbone-forms/distribution/backbone-forms":103}],121:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),o=e("underscore"),s=e("select2-browserify"),r=e("./relation-item"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.minimumInputLength=3,t.prototype.events={"change input":"setValue"},t.prototype.initialize=function(e){var n,i;return this.options=null!=e?e:{},t.__super__.initialize.apply(this,arguments),n=this.options,this.autocomplete=n.autocomplete,this.label=n.label,this.type=n.type,i=this.options,this.relationTypeHelper=i.relationTypeHelper,this.placeholderString=i.placeholderString,null!=this.type?this.type:this.type="object"},t.prototype.setValue=function(e){var t;return t=this.$(e.currentTarget),this.model.isNew()?(this.value=t.val(),this.updateModel(this.model,this.value),this.trigger("change:value",this.value)):t.trigger("updateRelationEvent",e)},t.prototype.updateModel=function(e,t){return null!==this.relationTypeHelper&&void 0!==this.relationTypeHelper?this.relationTypeHelper.setRelatedModel(this.model,t):this.model.setTarget(t)},t.prototype.transformResults=function(e){var t,n,i,r,s;for(n={results:[]},s=e.refs,i=0,r=s.length;r>i;i++)t=s[i],n.results.push({id:t.id,text:t.displayName});return n},t.prototype.render=function(){var e,t,i,r,s,o;return this.$el.html(this.template()),t=document.createElement("input"),t.setAttribute("type","hidden"),e=this.$("span[data-editor]"),this.label&&(s=this.label.replace(/([a-z](?=[A-Z]))/g,"$1 ").toLowerCase(),i=n.$("<label>").addClass("timbuctoo-relation-type").text(s),e.append(i)),e.append(t),r={allowClear:!0,dropdownAutoWidth:!0,placeholder:null!=(o=this.placeholderString)?o:"Find "+this.type+"...",minimumInputLength:this.minimumInputLength,query:function(e){return function(t){return e.autocomplete(t.term).done(function(n){var i;return i=e.transformResults(n),t.callback(i)})}}(this)},this.$("input").select2(r),null!=this.model.getDisplayName()?this.$("input").select2("data",{id:this.model.getTarget(),text:this.model.getDisplayName()}):void 0},t}(r),t.exports=i},{"./relation-item":123,backbone:void 0,"select2-browserify":106,underscore:void 0}],122:[function(e,t){var n,i,r,s,o,a,l,c,u={}.hasOwnProperty,p=function(e,t){function n(){this.constructor=e}for(var i in t)u.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),c=e("underscore"),a=e("../collections/relations.coffee"),i=e("backbone-forms/distribution/backbone-forms"),l=e("../../templates/list.jade"),o=e("./relation-item"),r=e("./relation-autocomplete-item"),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.tagName="div",t.prototype.className="relation-editor",t.prototype.template=l,t.prototype.relationViewClass=o,t.prototype.events={'click button[data-action="add"]':"clickAddRelation",'click button[data-action="remove"]':"clickRemoveRelation",updateRelationEvent:"updateRelation"},t.prototype.initialize=function(e){var i,s,o,l,u,p,h,d,f,m;for(null==e&&(e={}),t.__super__.initialize.apply(this,arguments),c.extend(this,n.Events),this.relationName=this.key.replace(/^timbuctoo-relation\./,""),this.schema=e.schema,this.listOptions=null!=(l=this.schema.options)?l:[],this.relationTypeDescription=this.schema.relationTypeDescription,u=this.relationTypeDescription,this.relationTypeId=u.relationTypeId,this.relationTypeVariation=u.relationTypeVariation,this.relationTypeHelper=this.schema.relationTypeHelper,this.placeholderString=this.schema.placeholderString,p=this.relationTypeDescription,this.sourceType=p.sourceType,this.targetType=p.targetType,null==this.sourceType&&(this.sourceType=this.model.get("@type")),null!=this.schema.autocomplete&&(this.relationViewClass=r),this.relationViews=[],this.relations=new a,f=null!=(h=null!=(d=this.model.get("@relations"))?d[this.relationName]:void 0)?h:[],m=[],s=0,o=f.length;o>s;s++)i=f[s],m.push(i.accepted?this.addRelation(i.id,i.relationId,i.displayName,i.rev,i.accepted):void 0);
return m},t.prototype.clickAddRelation=function(){return this.addRelation()},t.prototype.clickRemoveRelation=function(e){var t;return t=this.$(e.currentTarget),this.removeRelation(t.closest(".timbuctoo-list-item").parent().index())},t.prototype.addRelation=function(e,t,n,i,r){var s;return null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),null==i&&(i=null),null==r&&(r=!0),s=this.relations.add(this.relationTypeHelper.createRelation(this.relationTypeDescription,this.model.id,e,i,this.relationTypeVariation,t)),null!=n&&s.setDisplayName(n),this.addRelationView(s)},t.prototype.addRelationView=function(e){var t;return t=new this.relationViewClass({model:e,options:this.listOptions,relationTypeHelper:this.relationTypeHelper,placeholderString:this.placeholderString}),null!=this.schema.autocomplete&&(t.autocomplete=this.schema.autocomplete),t.render(),this.relationViews.push(t),this.$("div[data-items]").append(t.el)},t.prototype.removeRelationView=function(e){return e.$el.fadeOut(150,function(){return function(){return e.remove()}}(this))},t.prototype.removeRelation=function(e){return this.relations.removeRelation(e),this.removeRelationView(this.relationViews[e]),this.relationViews.splice(e,1)},t.prototype.renderRelations=function(){var e,t,n,i,r,s,o,a;for(this.$("div[data-items]").empty(),o=this.relationViews,n=0,r=o.length;r>n;n++)t=o[n],t.remove();for(this.relationViews=[],this.schema.onlyOne&&0===this.relations.length&&this.relations.add(this.relationTypeHelper.createRelation(this.relationTypeDescription,this.model.id,null,null,this.relationTypeVariation)),a=this.relations.showable(),i=0,s=a.length;s>i;i++)e=a[i],this.addRelationView(e);return this.schema.onlyOne?this.$("button[data-action=remove]").hide():void 0},t.prototype.render=function(){return this.$el.html(this.template()),this.schema.onlyOne&&(this.$el.addClass("only-one-relation"),this.$("button[data-action=add]").hide()),this.$list=this.$("div[data-items]"),this.renderRelations(),this},t.prototype.relationData=function(e,t,n,i){var r;return null==t&&(t=null),null==n&&(n=null),null==i&&(i=!0),r={"@type":this.relationTypeVariation,accepted:i,"^sourceType":this.sourceType,"^sourceId":this.model.id,"^typeType":"relationtype","^typeId":this.relationTypeId,"^targetType":this.targetType,"^targetId":e},null!=t&&(r._id=t),null!=n&&(r["^rev"]=n),r},t.prototype.getValue=function(){var e;return e=this.relations.toJSON()},t.prototype.setValue=function(e){var t;return this.relations.reset(function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(this.relationData(t));return r}.call(this))},t.prototype.updateRelation=function(e,t){var n,i,r;return r=this.$(t.currentTarget),n=this.getIndexOf(r),this.removeRelation(n),i=t.added,this.addRelation(i.id,null,i.text,null,!0)},t.prototype.getIndexOf=function(e){var t;return t=e.closest(".timbuctoo-list-item").parent().index()},t.prototype.focus=function(){},t.prototype.blur=function(){},t}(i.Editor),t.exports=s},{"../../templates/list.jade":131,"../collections/relations.coffee":108,"./relation-autocomplete-item":121,"./relation-item":123,backbone:void 0,"backbone-forms/distribution/backbone-forms":103,underscore:void 0}],123:[function(e,t){var n,i,r,s,o,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};n=e("backbone"),o=e("underscore"),s=e("../../templates/list-item.jade"),r=e("../../templates/dropdown.jade"),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.template=s,t.prototype.editorTemplate=r,t.prototype.tagName="div",t.prototype.events={"change select":"setValue"},t.prototype.initialize=function(e){return this.options=null!=e?e:{},o.extend(this,n.Events),this.value=this.model.getTarget(),this.listOptions=this.options.options},t.prototype.getValue=function(){return this.value},t.prototype.setValue=function(e){return this.value=this.$(e.currentTarget).val(),this.model.setTarget(this.value),this.trigger("change:value",this.value)},t.prototype.render=function(){return this.$el.html(this.template()),this.$("span[data-editor]").html(this.editorTemplate({options:this.listOptions,defaultValue:this.value})),this},t}(n.View),t.exports=i},{"../../templates/dropdown.jade":125,"../../templates/list-item.jade":130,backbone:void 0,underscore:void 0}],124:[function(e,t){t.exports={value:{type:"String"},type:{value:["SURNAME","FORENAME","ROLE_NAME","ADD_NAME","NAME_LINK","GEN_NAME"],type:"String"}}},{}],125:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{},r=i.options,s=i.defaultValue;return t.push('<span class="loading"></span><select><option disabled="disabled" selected="selected"></option>'),function(){var e=r;if("number"==typeof e.length)for(var i=0,o=e.length;o>i;i++){var a=e[i];t.push("<option"+n.attr("value",a.value,!0,!1)+n.attr("selected",s==a.value,!0,!1)+">"+n.escape(null==(n.interp=null!==a.label?a.label:a.value)?"":n.interp)+"</option>")}else{var o=0;for(var i in e){o++;var a=e[i];t.push("<option"+n.attr("value",a.value,!0,!1)+n.attr("selected",s==a.value,!0,!1)+">"+n.escape(null==(n.interp=null!==a.label?a.label:a.value)?"":n.interp)+"</option>")}}}.call(this),t.push("</select>"),t.join("")}},{"jade/runtime":105}],126:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{},r=i.relationTypes,s=i.relationTypeHelper,o=i.humanizeRelationName,a=i.relationName;return t.push('<div class="relations"></div><div class="add-new"><h5>Select type</h5><ul data-items="data-items">'),function(){var e=r;if("number"==typeof e.length)for(var i=0,a=e.length;a>i;i++){var l=e[i];t.push("<li"+n.attr("data-type",s.getName(l),!0,!1)+">"+n.escape(null==(n.interp=o(s.getName(l)))?"":n.interp)+"</li>")}else{var a=0;for(var i in e){a++;var l=e[i];t.push("<li"+n.attr("data-type",s.getName(l),!0,!1)+">"+n.escape(null==(n.interp=o(s.getName(l)))?"":n.interp)+"</li>")}}}.call(this),t.push('</ul><button class="btn">'+n.escape(null==(n.interp="Add "+a)?"":n.interp)+"</button></div>"),t.join("")}},{"jade/runtime":105}],127:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{},r=i.key,s=i.editorId,o=i.title,a=i.help;return t.push("<div"+n.cls(["field field-"+r],[!0])+"><div"+n.attr("for",s,!0,!1)+' class="field-label">'+n.escape(null==(n.interp=o)?"":n.interp)+'</div><span data-editor="data-editor"></span><div class="error"><i class="fa fa-times"></i><span data-error="data-error"></span></div><div class="help">'+n.escape(null==(n.interp=a)?"":n.interp)+"</div></div>"),t.join("")}},{"jade/runtime":105}],128:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{},r=i.collapsed,s=i.legend;return t.push("<fieldset"+n.cls([r?"collapsed":""],[!0])+">"),s&&t.push("<legend>"+n.escape(null==(n.interp=s)?"":n.interp)+"</legend>"),t.push('<div data-fields="data-fields" class="fields"></div></fieldset>'),t.join("")}},{"jade/runtime":105}],129:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<span class="loading"></span><div class="timbuctoo-link-editor"><div class="label-field"><span>label</span><input type="text" name="label"/></div><div class="url-field"><span>URL</span><input type="text" name="url"/></div></div>'),e.join("")}},{"jade/runtime":105}],130:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="timbuctoo-list-item"><span data-editor="data-editor"></span><button type="button" data-action="remove" title="Remove this item"><i class="fa fa-minus"></i><span>Remove</span></button></div>'),e.join("")}},{"jade/runtime":105}],131:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="timbuctoo-list-editor"><div data-items="data-items"></div><button type="button" data-action="add" title="Add another item"><i class="fa fa-plus"></i><span>Add</span></button></div>'),e.join("")}},{"jade/runtime":105}],132:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{},r=i.type;return t.push('<div class="timbuctoo-list-item"><div class="name-component-editor"><div class="component-header"><label class="type"><span>'+n.escape(null==(n.interp=r)?"":n.interp)+"</span></label><span"+n.attr("title",r?"Remove this "+r:"Remove this component",!0,!1)+' class="remove-name-component link">Remove</span></div><input type="text" name="value"/></div></div>'),t.join("")}},{"jade/runtime":105}],133:[function(e,t){var n=e("jade/runtime");t.exports=function(e){var t=[],i=e||{},r=i.componentTypes;return t.push('<div class="timbuctoo-list-item"><span class="name input-field"></span><button type="button" data-action="remove" title="Remove this name" class="remove-name"><i class="fa fa-minus"></i><span>Name</span></button><div class="timbuctoo-list-editor"><div data-items="data-items" class="name-component-editors"><select class="add-name-component-editor"><option disabled="disabled" selected="selected">Add component</option>'),function(){var e=r;if("number"==typeof e.length)for(var i=0,s=e.length;s>i;i++){var o=e[i];t.push("<option"+n.attr("value",o,!0,!1)+">"+n.escape(null==(n.interp=o)?"":n.interp)+"</option>")}else{var s=0;for(var i in e){s++;var o=e[i];t.push("<option"+n.attr("value",o,!0,!1)+">"+n.escape(null==(n.interp=o)?"":n.interp)+"</option>")}}}.call(this),t.push("</select></div></div></div>"),t.join("")}},{"jade/runtime":105}],134:[function(e,t){e("jade/runtime");t.exports=function(){var e=[];return e.push('<div class="timbuctoo-list-editor"><div data-items="data-items" class="person-name-editors"></div><button type="button" data-action="add" title="Add another name" class="add-name-editor"><i class="fa fa-plus"></i><span>Name</span></button></div>'),e.join("")}},{"jade/runtime":105}]},{},[1]);